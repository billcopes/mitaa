!function(global){"use strict";var FormEvents={wrapperSelector:".preview-container",dispatchFormEvent:function(e,additionalData){if(LIVE_SHARE&&LIVE_SHARE.eventDispatcher)try{LIVE_SHARE.eventDispatcher.handleEvent(e,_.extend({selector:this.getElementUniqueSelector(e.target),time:+new Date},additionalData||{}))}catch(e){return void console.error(e)}},getElementUniqueSelector:function(el){var path=[];do{if(el.id){/^el[0-9]+\_/.test(el.id)?path.unshift("[id^=el"+this.getIdByElement(el)+"_]"):path.unshift("#"+el.id);break}path.unshift(el.nodeName.toLowerCase()+(el.className?"."+el.className.replace(" ","."):""))}while("html"!==el.nodeName.toLowerCase()&&(el=el.parentNode));return path.join(">")}};LIVE_SHARE&&(FormEvents=_.extend(LIVE_SHARE.FormEvents,FormEvents)),global.FormEvents=FormEvents}(window),function(global){"use strict";var Interactions=function(){return{ori_styles:{},active_node_id:"canvas-wrapper",els:{},events:[],scrolls:[],scrollable_els:null,scroll_offset_prev:0,scroll_offset:0,on_scroll_ref:null,loading_el:null,attachScrollEvent:function(){var i;if(this.scrollable_els&&this.scrollable_els instanceof Array){if(this.on_scroll_ref){for(i=0;i<this.scrollable_els.length;i++)this.scrollable_els[i].removeEventListener("scroll",this.on_scroll_ref),this.scrollable_els[i].scrollTop&&(this.scroll_offset=this.scrollable_els[i].scrollTop);this.on_scroll_ref=null}for(this.scroll_offset_prev=0,this.on_scroll_ref=this.onContentScrolled.bind(this),i=0;i<this.scrollable_els.length;i++)this.scrollable_els[i].addEventListener("scroll",this.on_scroll_ref)}},getLoadElement:function(){return this.loading_el||(this.loading_el=document.createElement("img"),this.loading_el.style.opacity=0),this.loading_el},onContentLoaded:function(loadEvents){_.forEach(loadEvents,function(event){"function"==typeof event&&event("load")})},onContentScrolled:function(e){this.scroll_offset_prev=this.scroll_offset,this.scroll_offset=0;for(var i=0;i<this.scrollable_els.length;i++)this.scroll_offset+=this.scrollable_els[i].scrollTop;this.scrolls.forEach(function(callback){"function"==typeof callback&&callback(e)})},getIdByElement:function(el){var id=null;return _.forEach(Preview.mElements.mIndex,function(value,key){return value.mEl===el?(id=key,!1):void 0}),id},shouldBeFired:function(e){if("load"===e)return!0;var target_node_name=e.target.nodeName.toLowerCase();return!(e.keyCode&&["input","textarea","select"].indexOf(target_node_name)>-1)},handleEvent:function(e,processed){if("load"!==e&&"scroll"!==e.type){var id=this.getIdByElement(e.currentTarget);if(LIVE_SHARE&&LIVE_SHARE.eventDispatcher){var selector=id?"[id^=el"+id+"_]":"window";try{LIVE_SHARE.eventDispatcher.handleEvent(e,{selector:selector})}catch(e){return void console.error(e)}}var target_node_name=e.target.nodeName.toLowerCase(),notProcessedCallback=function(pValue){return!1===pValue};if(!e.keyCode||!(["input","textarea","select"].indexOf(target_node_name)>-1||processed.every(notProcessedCallback))){if("click"===e.type){if("label"===target_node_name)return;if("input"===target_node_name&&["checkbox","radio"].indexOf(e.target.getAttribute("type").toLowerCase())>-1)return}e.preventDefault()}}},getSetElRef:function(id){var node_id=Interactions.active_node_id;return"undefined"==typeof Interactions.els[node_id]&&(Interactions.els[node_id]={}),"object"!=typeof Interactions.els[node_id][id]&&(Interactions.els[node_id][id]=document.getElementById(node_id).querySelector("*[id^=el"+id+"_]"),Interactions.els[node_id][id].classList.contains("ElTooltip")?Interactions.els[node_id][id]=Interactions.els[node_id][id].parentNode:Interactions.els[node_id][id].classList.contains("ElTableContainer")&&(Interactions.els[node_id][id]=Interactions.els[node_id][id].querySelector(".ElTable"))),Interactions.els[node_id][id]},ifFireOneTimeScroll:function(id,action,offset,reverse){var return_value=0;return this.scroll_offset>=offset&&this.scroll_offset_prev<offset?return_value=1:this.scroll_offset<offset&&this.scroll_offset_prev>=offset&&(return_value=-1),reverse&&(return_value*=-1),return_value}}}();global.MD5=md5,global.Interactions=_.extend(Interactions,FormEvents)}(window),function(global){"use strict";var Preview=function(){var FADE_IN_DURATION=.5,FADE_OUT_DURATION=.5,HIGHLIGHT_DURATION=1.5,isHighlighted=!1,onScroll=function(e){for(var scrollTop=0,scrollLeft=0,i=0,l=Interactions.scrollable_els.length;l>i;i++)scrollTop+=Interactions.scrollable_els[i].scrollTop,scrollLeft+=Interactions.scrollable_els[i].scrollLeft;_.forEach(this.mFixedElems,function(fixed){fixed.style.top=scrollTop+parseInt(fixed.originalTop)+"px",fixed.style.left=scrollLeft+parseInt(fixed.originalLeft)+"px"}.bind(this))},parseLinks=function(hrefs){var pages;_.forEach(hrefs,function(href){pages=/\/([\d]+)c?d?m?$/g.exec(href.href),pages&&pages.length&&(href.onclick=function(pageId){return function(e){e.preventDefault(),Preview.gotoPage(pageId)}}(pages[1]))})},copyStyle=function(companion,interactive){var interactiveDomElement=interactive.view.domElement,interactiveTransform=getInteractiveDomElementTransform(interactive),border=parseInt(interactiveDomElement.style.borderWidth),width="canvas"===interactive.id?interactiveDomElement.style.width:interactive.width+"px",height="canvas"===interactive.id?interactiveDomElement.style.height:interactive.height+"px";companion.style.transform=interactiveTransform,companion.style.transformOrigin="inherit",companion.style.width=width,companion.style.height=height,companion.style.position="absolute",border&&(companion.style.width=parseInt(interactiveDomElement.style.width)+2*border+"px",companion.style.height=parseInt(interactiveDomElement.style.height)+2*border+"px")},getInteractiveDomElementTransform=function(interactive){var interactiveDomElement=interactive.view.domElement,interactiveDomElementTransform=document.defaultView.getComputedStyle(interactiveDomElement).transform;return(interactive.parent&&interactive.parent.isMultistate()||!interactiveDomElementTransform||"none"===interactiveDomElementTransform)&&(interactiveDomElementTransform="translate("+interactive.x+"px, "+interactive.y+"px) rotate("+interactive.angle+"deg)"),interactiveDomElementTransform},animate=function(container,companion){TweenLite.to(companion,FADE_IN_DURATION,{className:"+=visible-highlighted"}),TweenLite.to(companion,FADE_OUT_DURATION,{className:"-=visible-highlighted",delay:HIGHLIGHT_DURATION,onComplete:removeHighlight.bind(this,container,companion)})},removeHighlight=function(container,companion){isHighlighted=!1,container.removeChild(companion)},getElementsWithInteractions=function(elements,elementsWithInteractions){var interactives=elementsWithInteractions||[];return _.each(elements,function(element){_.isEmpty(element.actions)||interactives.push(element),_.isEmpty(element.children)||getElementsWithInteractions(element.children,interactives)}),interactives},highlight=function(page){if(!isHighlighted){var companion,interactives=getElementsWithInteractions([page.getCanvas()]),canvasNode=document.querySelector(".ng-canvas");isHighlighted=!0,_.forEach(interactives,function(interactive){companion=document.createElement("DIV"),companion.className="interactive highlighted companion",copyStyle(companion,interactive),animate(canvasNode,companion),canvasNode.appendChild(companion)})}},clearTimeouts=function(){if(Interactions.timeouts)for(;Interactions.timeouts.length;)clearTimeout(Interactions.timeouts.pop())},initFixed=function(){if(this.mFixedElems=document.querySelectorAll(".FixedPos"),_.forEach(this.mFixedElems,function(fixed){fixed.originalTop=fixed.style.top,fixed.originalLeft=fixed.style.left}),!this.onScroll&&Interactions.scrollable_els){this.onScroll=onScroll.bind(this);for(var i=0,l=Interactions.scrollable_els.length;l>i;i++)Interactions.scrollable_els[i].addEventListener("scroll",this.onScroll)}},parseNavigationHrefs=function(){parseLinks(document.querySelector("section.preview-container").querySelectorAll("a"))},parsePageLinks=function(){var arr,hrefs=document.querySelectorAll('[onclick^="location"]');_.forEach(hrefs,function(href){"function"==typeof href.onclick&&(arr=/\/([\d]+)c?d?m?\'/g.exec(href.onclick.toString()),arr&&arr.length>1&&(href.onclick=function(pageId){return function(e){e.preventDefault(),Preview.gotoPage(pageId)}}(arr[1])))})},initDocument=function(container,cb){if("W"!==ApplicationConfiguration.project.type){_.forEach(container.querySelectorAll("textarea, input"),function(el){el.setAttribute("readonly","readonly"),el.removeAttribute("placeholder")});var margin;_.forEach(container.querySelectorAll("textarea"),function(el){margin=el.classList.contains("type-text")||"quote"===el.id?15:el.classList.contains("block")?13:0,autoGrow(el,{margin:margin})})}},autoGrow=function(el,options){options.minHeight=0,options.maxHeight=0;var style=window.getComputedStyle(el),dummy=document.createElement("div");dummy.style.overflowX="hidden",dummy.style.position="absolute",dummy.style.top=0,dummy.style.left="-9999px",dummy.style.whiteSpace="pre-wrap",dummy.style.fontSize=style.fontSize,dummy.style.fontFamily=style.fontFamily,dummy.style.fontStyle=style.fontStyle,dummy.style.fontVariant=style.fontVariant,dummy.style.fontWeight=style.fontWeight,dummy.style.width=style.width,dummy.style.lineHeight=style.lineHeight,dummy.style.padding=style.padding,document.body.appendChild(dummy);var html=el.value.replace(/\n|\r\n/g,"<br>X")+"X";if(dummy&&dummy.innerHTML.toLowerCase()!==html.toLowerCase()){dummy.innerHTML=html;var triggerHeight=dummy.getBoundingClientRect().height+options.margin,newHeight=Math.max(options.minHeight,triggerHeight);options.maxHeight&&newHeight>options.maxHeight&&(newHeight=options.maxHeight),el.clientHeight!==newHeight&&(el.style.height=newHeight+"px")}};return{mElements:new Preview_Elements,mFixedElems:null,onScroll:null,highlightInteractive:function(page){highlight(page)},onLoadPage:function(container,cb){initDocument(container,cb),initFixed.call(this),parseNavigationHrefs(),parsePageLinks()},onChangePage:function(){clearTimeouts();var i;if(Interactions.loading_el=null,this.onScroll&&Interactions.scrollable_els){for(i=0;i<Interactions.scrollable_els.length;i++)Interactions.scrollable_els[i].removeEventListener("scroll",this.onScroll);this.onScroll=null}if(Interactions.scrolls)for(;Interactions.scrolls.length;)for(i=0;i<Interactions.scrollable_els.length;i++)Interactions.scrollable_els[i].removeEventListener("scroll",Interactions.scrolls.pop())},gotoPage:function(pageUrl){if(pageUrl.match(/^http/))window.location=pageUrl;else{var pageId=parseInt(pageUrl.replace(/.*\/(\d+)c?d?m?$/,"$1"));angular.element(document.getElementById("page-controller")).scope().gotoPage(pageId)}}}}();global.Preview=Preview}(window),function(global){"use strict";global.SocketServiceHelper=function(socketUrl,$rootScope){if("undefined"==typeof io)return{on:angular.noop,emit:angular.noop};var socket=io(socketUrl);return{on:function(eventName,callback){socket.on(eventName,function(){var args=arguments;$rootScope.$apply(function(){"function"==typeof callback&&callback.apply(socket,args)})})},emit:function(eventName,data,callback){socket.emit(eventName,data,function(){var args=arguments;$rootScope.$apply(function(){"function"==typeof callback&&callback.apply(socket,args)})})}}}}(window),function(global){"use strict";var configuration=function(){var applicationModuleName="uxpin-preview",applicationModuleVendorDependencies=["restangular","ui.router","pascalprecht.translate","LocalStorageModule","ngClipboard","custom.ui.bootstrap","youtube-embed","ngSanitize","angulartics","angulartics.google.analytics","angulartics.kissmetrics","ngCookies"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule,project:{hash:0},extension:{id:"bgibmbhbcdfckbcbdkihlclfildbaehc",isInstalled:!1}}}();global.ApplicationConfiguration=_.defaults(global.ApplicationConfiguration||{},configuration),"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.sendMessage(global.ApplicationConfiguration.extension.id,global.ApplicationConfiguration,function(response){response&&(global.ApplicationConfiguration.extension.isInstalled=!0)})}(window),function(angular){"use strict";angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])})}(window.angular),ApplicationConfiguration.registerModule("core"),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){"use strict";"W"===ApplicationConfiguration.project.type?$urlRouterProvider.otherwise("/pages").when("/pages","/pages/{pageId}").when("/pages/{pageId}/usability-test/","/pages/{pageId}/usability-test/1"):$urlRouterProvider.otherwise("/documents").when("/documents","/documents/{documentId}");var isHostSession=function($state,$stateParams,LiveShareService){LiveShareService.isSession()&&!LiveShareService.isHostSession()&&$state.go($state.current.name,$stateParams)};$stateProvider.state("home",{url:"","abstract":!0,views:{"":{templateUrl:"/scripts/modules/core/views/home.view.html",controller:function($scope){}},comments:{templateUrl:"/scripts/modules/core/views/comments-notes.view.html",controller:"CommentsNotesController"},sitemap:{templateUrl:"/scripts/modules/core/views/sidebar.view.html",controller:"SidebarController"},nav:{templateUrl:"/scripts/modules/core/views/nav.view.html",controller:"NavController"},canvas:{templateUrl:"/scripts/modules/core/views/canvas.view.html",controller:"CanvasController"},breakpoints:{templateUrl:"/scripts/modules/core/views/breakpoints.view.html",controller:"BreakpointsController"},breadcrumbs:{templateUrl:"/scripts/modules/core/views/breadcrumbs.view.html",controller:"BreadcrumbsController"},settings:{templateUrl:"/scripts/modules/core/views/settingsBar/settings.view.html",controller:"SettingsBarController"}},resolve:{pages:function($q,PagesService,ProjectsService){var d=$q.defer();return ProjectsService.isDocument()?d.resolve(null):PagesService.getPages().then(function(pages){d.resolve(pages)},function(error){d.reject(error)}),d.promise},breakpoints:function($q,BreakpointsService,ProjectsService){var d=$q.defer();return ProjectsService.isDocument()?d.resolve(null):BreakpointsService.getBreakpoints().then(function(breakpoints){d.resolve(breakpoints)},function(error){d.reject(error)}),d.promise},collaborators:function($q,UsersService){var d=$q.defer();return UsersService.getCollaborators().then(function(collaborators){d.resolve(collaborators)},function(error){d.reject(error)}),d.promise},documents:function($q,DocumentsService,ProjectsService){var d=$q.defer();return ProjectsService.isDocument()?DocumentsService.getDocuments().then(function(documents){d.resolve(documents)},function(error){d.reject(error)}):d.resolve(null),d.promise},isMobile:function(){return"mobile"===new UAParser(navigator.userAgent).getDevice().type}}}).state("home.page",{url:"/pages/{pageId}?mode",template:'<div id="page-controller" ui-view></div>',controller:"PageController"}).state("home.page.nosidebar",{url:"/nosidebar"}).state("home.page.panel",{url:"/panel"}).state("home.page.panel.nosidebar",{url:"/nosidebar"}).state("home.page.sitemap",{url:"/sitemap",resolve:{isHostSession:isHostSession}}).state("home.page.sitemap.nosidebar",{url:"/nosidebar"}).state("home.page.comment",{url:"/comments/{commentId}",controller:"CommentController"}).state("home.page.comment.nosidebar",{url:"/nosidebar"}).state("home.page.comment.panel",{url:"/panel"}).state("home.page.comment.panel.nosidebar",{url:"/nosidebar"}).state("home.page.comment.sitemap",{url:"/sitemap",resolve:{isHostSession:isHostSession}}).state("home.page.comment.sitemap.nosidebar",{url:"/nosidebar",resolve:{isHostSession:isHostSession}}).state("home.page.add-comment",{url:"/add-comment",resolve:{isHostSession:isHostSession}}).state("home.page.add-comment.nosidebar",{url:"/nosidebar"}).state("home.page.panel.add-comment",{url:"/add-comment",resolve:{isHostSession:isHostSession}}).state("home.page.panel.add-comment.nosidebar",{url:"/nosidebar"}).state("home.page.sitemap.add-comment",{url:"/add-comment",resolve:{isHostSession:isHostSession}}).state("home.page.sitemap.add-comment.nosidebar",{url:"/nosidebar",resolve:{isHostSession:isHostSession}}).state("home.page.comment.add-comment",{url:"/add-comment",resolve:{isHostSession:isHostSession}}).state("home.page.comment.panel.add-comment",{url:"/add-comment",resolve:{isHostSession:isHostSession}}).state("home.page.comment.panel.add-comment.nosidebar",{url:"/nosidebar",resolve:{isHostSession:isHostSession}}).state("home.page.comment.sitemap.add-comment",{url:"/add-comment",resolve:{isHostSession:isHostSession}}).state("home.page.comment.sitemap.add-comment.nosidebar",{url:"/nosidebar",resolve:{isHostSession:isHostSession}}).state("home.document",{url:"/documents/{documentId}?mode",template:'<div id="document-controller" ui-view></div>',controller:"DocumentController"}).state("home.document.panel",{url:"/panel"}).state("home.document.comment",{url:"/comments/{commentId}",controller:"CommentController"}).state("home.document.comment.panel",{url:"/panel"}).state("home.document.add-comment",{url:"/add-comment"}).state("home.document.panel.add-comment",{url:"/add-comment"}).state("home.document.comment.add-comment",{url:"/add-comment"}).state("home.document.comment.panel.add-comment",{url:"/add-comment"});var isAuthenticated=function(UsersService,$location){return UsersService.me.is_anonymous?$location.path("/"):void 0};$stateProvider.state("home.page.live-share-configuration",{url:"/live-presentation-configuration",controller:function($modal,$state,$stateParams){var dialog=$modal.open({templateUrl:"/scripts/modules/core/views/liveShare/configuration.view.html",controller:"LiveShareConfigurationController"});dialog.result["finally"](function(){$state.go("home.page",$stateParams)})},resolve:{isAuthenticated:isAuthenticated}}).state("home.page.live-share-start",{url:"/live-presentation-start?options&type",templateUrl:"/scripts/modules/core/views/liveShare/initialize.view.html",controller:"LiveShareInitializeController",resolve:{isAuthenticated:isAuthenticated}}).state("home.page.live-share-join",{url:"/live-presentation-join/{sessionId}?type",templateUrl:"/scripts/modules/core/views/liveShare/initialize.view.html",controller:"LiveShareInitializeController"}).state("home.page.live-share-finish",{url:"/live-presentation-finish/{type}/",templateUrl:"/scripts/modules/core/views/liveShare/finish.view.html",controller:"LiveShareFinishController"}).state("home.page.usability-test",{url:"/usability-test/{step:[1-5]{1}}",controller:"UsabilityTestController",resolve:{isAuthenticated:isAuthenticated}})}]),angular.module("core").config(["$translateProvider",function($translateProvider){"use strict";$translateProvider.preferredLanguage("en"),$translateProvider.translations("en",{BTN_REPLY:"Reply",BTN_RESOLVE:"Resolve",BTN_UNRESOLVE:"Unresolve",BTN_DELETE:"Delete",BTN_ADD_COMMENT:"Add comment",BTN_NOTIFY:"Notify those people",BTN_ADD_USER:"Notify also",BTN_SEND_NOTIFICATION:"Send notification",BTN_UNDO:"Undo",LBL_COMMENTS:"Comments",LBL_NOTES:"Notes",LBL_SHOW_RESOLVED:"Show resolved",LBL_CURRENT_PAGE:"Current page only",LBL_SEARCH:"Search",LBL_RESOLVED:"Resolved",INFO_DELETED:"You've deleted this comment.",INFO_NO_COMMENTS:"There are no comments yet.",INFO_ADD_FIRST:"Add first comment",INFO_ENTER_COMMENT_MODE:"Enter comment mode",INFO_ADD_FIRST_NOTE:"Add your first note",INFO_NO_NOTES:"This is your private notepad.\nNo one can see it.",INFO_SEARCH:"Search in comments",INFO_SEARCH_SITEMAP:"Search for page",INFO_FEEDBACK:"Put your feedback",TIP_COMMENT_MODE:"Comment mode",TIP_ADD_NEW_COMMENT:"Add new comment",TIP_COLLABORATION:"Collaboration",TIP_COMMENTS_NOTES:"Comments / Notes",TIP_SITEMAP:"Sitemap",TIP_LIVE_SHARE:"Start Live Presentation",TIP_USABILITY_TEST:"Create usability test",TIP_RESOLVE:"Resolve",TIP_DELETE:"Delete",TIP_CANT_DELETE:"Only owner can delete his comments",TIP_FINISH_SESSION:"Finish session",LOVE_IT:"Love it",DONT_LOVE_IT:"Love it not",RESOLVED_BY:"Resolved by {{name}}",LS_OPTION_CAN_COMMENT:"Viewers can comment during session",LS_OPTION_SHOW_CURSOR:"Show viewers' cursors",LS_OPTION_FOLLOW_CURSOR:"Viewers always follow my cursor",LS_OPTION_DISABLE_VOICE:"Disable voice calls",LS_SESSION_QUIT:"You left {{projectName}} session. Redirecting to preview...",LS_SESSION_BANNED:"You've been banned from {{projectName}}.",LS_SESSION_OVER:"{{projectName}} session is over.",LS_SESSION_404:"No session found.",LS_USERS:"Live Presentation users",LS_FOLLOW_CURSOR:"Follow cursor",LS_SETTINGS:"Live Presentation settings",LS_SESSION_SETTINGS:"Session settings",LS_LINK_TO_SESSION:"Link to session",LS_LINK_HAS_BEEN_COPIED:"Link has been copied to your clipboard!",LS_TOGGLE_MUTE:"Toggle mute",LS_COPY:"Copy",LS_LEAVE_SESSION:"Leave session",LS_NAME_SHARING:"Live Presentation session",LS_NAME_TESTING:"usability test",LS_BACK_TO_PREVIEW:"Back to preview",UT_INTRODUCTION_TEXT:"Hello {Name of the participant}, thank you for coming. My name is {your name} and I’m a researcher for {name of the product} – I’m going to walk you through the session today.\n\nBefore we’ll start I have some information for you.\n\nWe’re currently testing {name of the product} to learn as much as we can about the way people use it. Every product is intended to work in a certain way by its creators, but as you know – the reality might be quite different. The goal of this research is to get us as close to the reality as possible.\n\nThe session will take about an hour.\n\nPlease remember, during the next hour, that we’re testing {name of the product} not you. Don’t worry at all about mistakes. If they happen, it’s the fault of the product. Finding about it is absolutely fantastic and gets us closer to creating a great product.\n\nDuring the whole test, please try to think out loud. Share anything that’s in your head. Tell me what you are looking at on the screen, what your thoughts are, what you like and what don’t you like, et cetera. We want to learn about your honest reactions to {name of the product}.\n\nIf you have any doubts during the test, feel free to ask me any questions. However, please remember that I might not be able to answer them during the test. We want to learn about your experience with {name of the product}, so I can’t guide you. I’ll be glad to answer all your questions after the test.\n\nWith your permission, we’re going to record the session. We’ll record your voice, face and actions on the screen – that will give us the full picture of the session for further analysis. We’re not going to share these recordings outside of the team directly working on {name of the product}.\n\nIf you don’t mind, I’d like to ask you to sign this permission form. It simply states that you give us the permission to record the session and that we’re going to secure this data and make it available only to the team working on {name of the product}.\n\nAlso, I hope you don’t mind, but I’m going to take notes. It helps me with analyzing the session.",UT_OPTION_CAN_CLOSE_TASK:"Participants can close tasks themselves",UT_OPTION_SEE_SITEMAP:"Participants can see sitemap",UT_THANKS_FOR_CONTRIBUTION:"This session is over, thank you for your contribution.",UT_SETTINGS:"Usability test settings",UT_USERS:"Usability test users",UM_CLOSE_MOVIE:"Close movie",UM_MODAL_HEADER:"Show your design,\nshare your screen and allow others to follow your actions!",UM_MODAL_TEXT:"With Live Presentation you'll be able to create an outstanding real-time presentation for your team. By means of voice calls, collaboration will be smooth and easy.",UM_CLOSE_MODAL:"Close modal",UM_HOW_IT_WORKS:"Show me how it works",UM_UPGRADE_NOW:"Upgrade now!",UM_PRO_PLUS_TEXT:"Live Presentation is available in Pro+ Plan.",UM_PRO_PLUS:"Pro+"})}]),angular.module("core").config(["localStorageServiceProvider",function(localStorageServiceProvider){"use strict";localStorageServiceProvider.setPrefix("Preview"),localStorageServiceProvider.setStorageCookieDomain(ApplicationConfiguration.cookieDomain)}]),angular.module("core").config(["ngClipProvider",function(ngClipProvider){"use strict";ngClipProvider.setPath("/node_modules/zeroclipboard/dist/ZeroClipboard.swf")}]),angular.module("core").config(["RestangularProvider",function(RestangularProvider){"use strict";RestangularProvider.setDefaultHttpFields({timeout:2e4})}]),angular.module("core").controller("UsabilityTestController",["$rootScope","$scope","$state","$stateParams","$modal","UsabilityTestService","ChromeExtensionService",function($rootScope,$scope,$state,$stateParams,$modal,UsabilityTestService,ChromeExtensionService){"use strict";var onStateChangeSuccess,openWizard=function(){var dialog=$modal.open({controller:"UsabilityTestWizardController",templateUrl:"/scripts/modules/core/views/usabilityTest/wizard.view.html",keyboard:!1});UsabilityTestService.isWizardOpen=!0,dialog.result["finally"](function(){$state.includes("**.usability-test.**")&&$state.go("home.page",{pageId:$stateParams.pageId}),UsabilityTestService.isWizardOpen=!1}),onStateChangeSuccess=$rootScope.$on("$stateChangeSuccess",function(e,toState,toParams){toParams.step||dialog.close()})},openChromeExtensionPromoModal=function(){$modal.open({controller:"ChromeExtensionDownloadController",templateUrl:"/scripts/modules/core/views/usabilityTest/chromeExtensionDownload.view.html"});$state.go("home.page",{pageId:$stateParams.pageId})};UsabilityTestService.isWizardOpen||(ChromeExtensionService.isInstalled()?openWizard():openChromeExtensionPromoModal()),$scope.$on("destroy",function(){"function"==typeof onStateChangeSuccess&&onStateChangeSuccess()})}]),angular.module("core").controller("BreadcrumbsController",["$rootScope","$scope","$sce","PagesService","BreakpointsService","LiveSessionInstanceService",function($rootScope,$scope,$sce,PagesService,BreakpointsService,LiveSessionInstanceService){"use strict";var LiveSessionInstance=LiveSessionInstanceService.get();$scope.breadcrumbs=[],$scope.breakpoint=null;var getBreadcrumbs=function(){var id=PagesService.currentPageId,breadcrumbs=[];do breadcrumbs.unshift(getPageName(id)),id=PagesService.pagesMap[id].parent;while(id);return breadcrumbs},getPageName=function(id){return PagesService.pagesMap[id].name},getBreakpointName=function(id){return $sce.trustAsHtml(BreakpointsService.breakpointsMap[PagesService.currentBreakpointId].name)};LiveSessionInstance.isSession()&&(LiveSessionInstance.getType()===LiveShare.enums.SESSION_TYPES.TESTING&&LiveSessionInstance.isHostSession()||!LiveSessionInstance.isHostSession())&&($scope.breadcrumbs=getBreadcrumbs(),$scope.breakpoint=getBreakpointName()),LiveSessionInstance.registerObserverCallback("finish",function(){$scope.breadcrumbs=[],$scope.breakpoint=null});$rootScope.$on(PreviewEnums.ON_CONTENT_LOADED,function(e,id){$scope.breadcrumbs=getBreadcrumbs(),$scope.breakpoint=getBreakpointName()})}]),angular.module("core").controller("BreakpointsController",["$rootScope","$scope","$state","PagesService","BreakpointsService","ProjectsService","UsabilityTestService",function($rootScope,$scope,$state,PagesService,BreakpointsService,ProjectsService,UsabilityTestService){"use strict";var lockedBreakpoints=[];$scope.params={},$scope.isActive=function(id){return id===PagesService.currentBreakpointId},$scope.onClick=function(e,id){PagesService.changePageBreakpoint(id)},$scope.isUnlocked=function(breakpointId){return-1===lockedBreakpoints.indexOf(breakpointId)};var lockBreakpoints=($rootScope.$on(PreviewEnums.ON_CHANGE_PAGE,function(e,id){$scope.params.breakpoints=PagesService.getPageBreakpoints(id)}),function(){var availableBreakpoints=UsabilityTestService.getTestData().project.available_breakpoints;lockedBreakpoints=[],_.forEach(availableBreakpoints,function(breakpoint){breakpoint.value||lockedBreakpoints.push(breakpoint.id)})}),testerJoined=function(){UsabilityTestService.isHostSession()||lockBreakpoints()},hostStarted=function(){UsabilityTestService.isHostSession()&&lockBreakpoints()};UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.TESTER_JOINED,testerJoined.bind(this)),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,hostStarted.bind(this)),$scope.params.breakpoints=ProjectsService.isDocument()?null:PagesService.getPageBreakpoints(PagesService.currentPageId)}]),angular.module("core").controller("CanvasController",["$rootScope","$scope","$state","$timeout","$q","PagesService","DocumentsService","CommentsService","BreakpointsService","ProjectsService","Settings","animate","socket","editorSocket","UsersService","LiveSessionInstanceService","UsabilityTestService","LiveShareService","AnalyticsService","Engine",function($rootScope,$scope,$state,$timeout,$q,PagesService,DocumentsService,CommentsService,BreakpointsService,ProjectsService,Settings,animate,socket,editorSocket,UsersService,LiveSessionInstanceService,UsabilityTestService,LiveShareService,AnalyticsService,Engine){"use strict";$scope.addingComment=!1,$scope.commentMode=!1,$scope.isLoading=!1,$scope.dimensions=null,$scope.overflow=null,$scope.onClick=null,$scope.clickX=0,$scope.clickY=0,$scope.list={},$scope.isDocument=ProjectsService.isDocument(),$scope.isUXTestDocument=ProjectsService.isUXTestDocument();var container=null,containerPadded=null,content=null,containerDimensions={width:0,height:0,paddingLeft:0,paddingRight:0},contentDimensions={width:0,height:0},contentCropping={x:!1,y:!1};$scope.$on("$destroy",function(){onAddComment(),onSelectComment(),onStateChangeSuccess(),onChangePage(),onComments(),onShowCommentsChanged(),onShowCommentsResolvedChanged(),onModeChanged()}),$scope.onContentLoaded=function(){var LiveSessionService=LiveSessionInstanceService.get();LiveSessionService&&LiveSessionService.isSession()?LiveSessionService.executeEventsQueue().then(function(){onContentLoaded(),$scope.$apply()})["catch"](function(e){onContentLoaded(),$scope.$apply()}):onContentLoaded()},$scope.onAddCommentClick=function(e){if(UsersService.isAnonymous()&&!UsersService.isAnonymousNameSet())return void $rootScope.$emit(PreviewEnums.ANONYMOUS_ADD_COMMENT);$rootScope.$emit(PreviewEnums.SELECT_COMMENT,null);var bb=content.getBoundingClientRect();$scope.clickX=Math.round(e.clientX-PreviewEnums.PIN_RADIUS-bb.left),$scope.clickY=Math.round(e.clientY-PreviewEnums.PIN_RADIUS-bb.top),addComment(!0)};var onContentLoaded=function(){$rootScope.$emit(PreviewEnums.LOADING,!1),$rootScope.$emit(PreviewEnums.ON_CONTENT_LOADED),Preview.onLoadPage(document.querySelector(".canvas-content"),ProjectsService.isDocument()?function(rect){$scope.$apply(function(){contentDimensions.height=rect.height,$scope.dimensions.height=contentDimensions.height+"px"})}:null),$timeout(function(){$scope.isLoading=!1},0),AnalyticsService.finishPageSwitchTrack(PagesService.currentPageId)},onAddComment=$rootScope.$on(PreviewEnums.ADD_COMMENT,function(e,id){addComment(!1)}),onSelectComment=$rootScope.$on(PreviewEnums.SELECT_COMMENT,function(e,id,type){addComment(!1),scrollToComment(id,type,.7)}),onStateChangeSuccess=$scope.$on("$stateChangeSuccess",function(e,toState,toParams,fromState,fromParams){toState.name.indexOf("add-comment")>=0&&fromState.name.indexOf("add-comment")<0?($scope.commentMode=!0,Settings.showComments||update()):toState.name.indexOf("add-comment")<0&&fromState.name.indexOf("add-comment")>=0&&($scope.commentMode=!1,addComment(!1),Settings.showComments||update())}),onChangePage=$rootScope.$on(PreviewEnums.ON_CHANGE_PAGE,function(e){$scope.isDocument=ProjectsService.isDocument(),AnalyticsService.startPageSwitchTrack(PagesService.currentPageId),
addComment(!1),update(),ProjectsService.isDocument()?getContent().then(function(){scrollToCommentDelayed()}):($scope.isLoading=!0,$rootScope.$emit(PreviewEnums.LOADING,!0),loadPage(PagesService.currentPageId),scrollToCommentDelayed()),Preview.onChangePage()}),scrollToCommentDelayed=function(){container.scrollLeft=0,container.scrollTop=0,$timeout(function(){scrollToComment(CommentsService.selectedCommentId,"panel",0)},0)},updateCurrentPage=function(){PagesService.getCanvasData(PagesService.currentPageId).then(function(data){var page=Engine.getPage();$timeout(function(){var width=PagesService.currentPageProperties.size.width,height=PagesService.currentPageProperties.size.height;Engine.updateOffset(),page.clear(),page.load(data,function(){page.on(window.uxpinEngine.Events.LOAD_FUNCTION_FINISHED,function(){setTimeout(function(){disableContextMenuForInteractives(),setNgCanvasDimensions(page.ElementsManager.elements,height,width)},0)})}())})})},loadPage=function(pageId){PagesService.getCanvasData(pageId).then(function(data){var page=Engine.getPage()||Engine.initPage(container,content);data.pageId=parseInt(pageId),$timeout(function(){if(data.pageId!==page.pageId){var width=PagesService.currentPageProperties.size.width,height=PagesService.currentPageProperties.size.height;Engine.updateOffset(),page.clear(),page.load(data,function(){page.on(window.uxpinEngine.Events.LOAD_FUNCTION_FINISHED,function(){setTimeout(function(){disableContextMenuForInteractives(),setNgCanvasDimensions(page.ElementsManager.elements,height,width)},0)})}()),$scope.dimensions={width:width+"px",height:height+"px"},$scope.overflow={"overflow-x":PagesService.currentPageProperties.size.scrollx?"auto":"hidden","overflow-y":PagesService.currentPageProperties.size.scrolly?"auto":"hidden"},$scope.onContentLoaded()}},0)})},onComments=$scope.$watchCollection("comments",function(value){value&&update()}),addComment=function(value){$scope.addingComment=value,$rootScope.$emit(PreviewEnums.ADDING_COMMENT,$scope.addingComment)},getContent=function(silent){var content,d=$q.defer(),isDocument=ProjectsService.isDocument();return isDocument?($scope.isLoading=!0,silent||$rootScope.$emit(PreviewEnums.LOADING,!0),content=DocumentsService.getDocument(DocumentsService.currentDocumentId),content.then(function(content){contentDimensions.width=content.size.width,contentDimensions.height=content.size.height,contentCropping=PagesService.getContentCropping(),$scope.contentPath=content.content+"?"+(new Date).getTime(),$scope.dimensions={width:contentDimensions.width+"px",height:contentDimensions.height+"px"},$scope.overflow={"overflow-x":contentCropping.x?"auto":"hidden","overflow-y":contentCropping.y?"auto":"hidden"},$scope.isUXTestDocument&&($scope.dimensions=null),d.resolve(content)}),d.promise):(d.resolve(),d.promise)},canScrollToComment=function(id,type){var comment=CommentsService.commentsMap[id];return id&&"panel"===type&&comment.id_page===PagesService.currentPageId&&Settings.showComments&&(Settings.showResolvedComments||!comment.resolved.is)},scrollToComment=function(id,type,delay){if(canScrollToComment(id,type)){computeSize();var commentPosition=CommentsService.commentsMap[id].position,left=commentPosition.x-containerDimensions.width/2,top=commentPosition.y-containerDimensions.height/2,contentDimensionsWidth=contentDimensions.width+containerDimensions.paddingLeft+containerDimensions.paddingRight;0>left?left=0:left>contentDimensionsWidth-containerDimensions.width&&(left=contentDimensionsWidth-containerDimensions.width),0>top?top=0:top>contentDimensions.height-containerDimensions.height&&(top=contentDimensions.height-containerDimensions.height),delay>0?animate(container,delay,{ease:"easeInOutPower2",scrollLeft:left,scrollTop:top}):(container.scrollLeft=left,container.scrollTop=top)}},computeSize=function(){var style;style=window.getComputedStyle(container),containerDimensions.width=parseInt(style.width),containerDimensions.height=parseInt(style.height),style=window.getComputedStyle(containerPadded),containerDimensions.paddingLeft=parseInt(style.paddingLeft),containerDimensions.paddingRight=parseInt(style.paddingRight)},canDisplayComment=function(comment){return!comment._parent_comment&&comment.id_page===PagesService.currentPageId&&(Settings.showComments||$state.includes("**.add-comment.**"))&&!Settings.disableComments&&(Settings.showResolvedComments||!comment.resolved.is)},update=function(){$scope.list=[],_.forEach($scope.comments,function(comment){canDisplayComment(comment)&&$scope.list.push(comment)})},onProjectUpdate=function(data){var dataObject;try{dataObject="string"==typeof data?JSON.parse(data):data}catch(e){}var LiveSessionInstance=LiveSessionInstanceService.get();LiveSessionInstance&&LiveSessionInstance.isSession()||Settings.disableLiveChanges||dataObject&&PagesService.currentPageId===parseInt(dataObject.id_page)&&updateCurrentPage()},disableContextMenuForInteractives=($scope.$on("$viewContentLoaded",function(){return ProjectsService.isDocument()?void getContent():void loadPage(PagesService.currentPageId)}),function(){for(var classNameToHandle=".interactive",elementList=document.querySelectorAll(classNameToHandle),i=0,len=elementList.length;len>i;i++)elementList[i].addEventListener("contextmenu",function(e){e.preventDefault()},!1)}),setNgCanvasDimensions=function(elements,canvasContainerHeight,canvasContainerWidth){var ngCanvas=document.querySelector(".ng-canvas"),maxVerticalElementPoint=getMaxVerticalElementPoint(elements),maxHorizontalElementPoint=getMaxHorizontalElementPoint(elements);ngCanvas.style.height=maxVerticalElementPoint>canvasContainerHeight?maxVerticalElementPoint+"px":canvasContainerHeight+"px",ngCanvas.style.width=maxHorizontalElementPoint>canvasContainerWidth?maxHorizontalElementPoint+"px":canvasContainerWidth+"px"},getMaxVerticalElementPoint=function(elements){return _.max(_.map(elements,function(element){return parseFloat(element.y)+parseFloat(element.height)}))},getMaxHorizontalElementPoint=function(elements){return _.max(_.map(elements,function(element){return parseFloat(element.x)+parseFloat(element.width)}))},onShowCommentsChanged=$rootScope.$on(PreviewEnums.ON_SHOW_COMMENTS_SETTINGS_CHANGED,update.bind(this)),onShowCommentsResolvedChanged=$rootScope.$on(PreviewEnums.ON_SHOW_COMMENTS_RESOLVED_SETTINGS_CHANGED,update.bind(this)),onModeChanged=$rootScope.$on(PreviewEnums.ON_MODE_CHANGED,update.bind(this));container=document.querySelector("main > section.scrolled-container > section.scrolled-content"),containerPadded=document.querySelector("main > section.scrolled-container > section.scrolled-content > section.canvas-container"),content=document.querySelector("main > section.scrolled-container > section.scrolled-content > section.canvas-container > section.preview-container"),CommentsService.getComments().then(function(comments){getContent().then(function(){$scope.comments=comments,$timeout(function(){scrollToComment(CommentsService.selectedCommentId,"panel",0)},0)})}),LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.START,function(){$scope.isLiveSession=!0}),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,function(){$scope.isLiveSession=!0,$scope.isUTSession=!0}),editorSocket.on(PreviewEnums.SOCKET.ON_CHANGE_PROPERTIES,onProjectUpdate.bind(this)),editorSocket.on(PreviewEnums.SOCKET.ON_DELETE_COMPONENT,onProjectUpdate.bind(this)),socket.on(PreviewEnums.SOCKET.ON_COMMENT_CREATE,function(data){CommentsService.applyAddComment(data)}),socket.on(PreviewEnums.SOCKET.ON_COMMENT_UPDATE,function(data){CommentsService.applyUpdateComment(data._id,data)}),socket.on(PreviewEnums.SOCKET.ON_COMMENT_DELETE,function(data){CommentsService.applyDeleteComment(data)})}]),angular.module("core").controller("CommentController",["$rootScope","$scope","$state","$stateParams","CommentsService",function($rootScope,$scope,$state,$stateParams,CommentsService){"use strict";var selectComment=function(commentId,redirect){CommentsService.selectedCommentId=commentId,$rootScope.$emit(PreviewEnums.SELECT_COMMENT,CommentsService.selectedCommentId,null,redirect),commentId&&redirect&&CommentsService.groupToOpen.push(commentId)},onStateChangeSuccess=$rootScope.$on("$stateChangeSuccess",function(){$state.includes("**.comment.**")||CommentsService.selectedCommentId&&selectComment(null)});$scope.$on("$destroy",function(){onStateChangeSuccess()}),$stateParams.commentId&&CommentsService.selectedCommentId!==$stateParams.commentId&&CommentsService.getComments().then(function(){var id=CommentsService.getRedirectId($stateParams.commentId);selectComment(id,id!==$stateParams.commentId)})}]),angular.module("core").controller("CommentsNotesController",["$rootScope","$scope","$state","$timeout","$sce","CommentsService","PagesService","BreakpointsService","ProjectsService","Settings","localStorageService","animate",function($rootScope,$scope,$state,$timeout,$sce,CommentsService,PagesService,BreakpointsService,ProjectsService,Settings,localStorageService,animate){"use strict";$scope.showResolved=Settings.showResolvedComments,$scope.isDocument=ProjectsService.isDocument(),$scope.showCurrentPageOnly=Settings.showCurrentPageOnly||$scope.isDocument,$scope.focused=!1,$scope.searchFor=CommentsService.searchFor,$scope.loading=!1,$scope.pageHidden=[],$scope.tree={},$scope.list={};var commentIdsInPage,pagesBreakpoints,breakpoints,scrollContainer=null,scrollContent=null;$scope.isVisible=function(){return $state.includes("**.panel.**")},$scope.addNewComment=function(){$state.includes("**.add-comment.**")||$state.go($state.current.name+".add-comment")},$scope.addNewNote=function(){},$scope.onShowCurrentPageOnly=function(){getComments()},$scope.onShowResolved=function(){Settings.setShowResolvedComments(!Settings.showResolvedComments)},$scope.getPageName=function(id){var page=PagesService.pagesMap[id];return null===page.version_of?page.name:PagesService.pagesMap[page.version_of].name},$scope.getBreakpointName=function(id){return $sce.trustAsHtml(BreakpointsService.breakpointsMap[id].name)},$scope.isPageHidden=function(id){return id=parseInt(id),-1!==$scope.pageHidden.indexOf(id)},$scope.togglePageHidden=function(e,id){id=parseInt(id);var index=$scope.pageHidden.indexOf(id);-1!==index?$scope.pageHidden.splice(index,1):$scope.pageHidden.push(id)},$scope.keyDown=function(e){e.stopPropagation(),27===e.which&&(""!==$scope.searchFor?$scope.searchFor="":$scope.focused=!1)},$scope.onSearchClick=function(e){$scope.focused=!0},$scope.showBreakpoints=function(){return breakpoints.length>1},$scope.$on("$destroy",function(){onSearchFor(),onLoadingComments(),onSelectComment(),onComments(),onShowCommentsResolvedChanged()});var onComments=$scope.$watchCollection("comments",function(value){value&&update()}),onSearchFor=$scope.$watch("searchFor",function(newValue,oldValue){newValue!==oldValue&&(CommentsService.searchFor=newValue,$rootScope.$emit("searchComments"),update())}),onLoadingComments=$rootScope.$on(PreviewEnums.LOADING_COMMENTS,function(e,value){$scope.showCurrentPageOnly&&($scope.loading=value)}),onSelectComment=$rootScope.$on(PreviewEnums.SELECT_COMMENT,function(e,id,type){id&&"canvas"===type&&$timeout(function(){var element=document.getElementById("group-"+id+"-panel"),position=getElementPositionRelatedToAncestor(element,scrollContent);animate(scrollContent,.5,{ease:"easeInOutPower2",scrollTop:position.top-10})},0)}),onShowCommentsResolvedChanged=$rootScope.$on(PreviewEnums.ON_SHOW_COMMENTS_RESOLVED_SETTINGS_CHANGED,function(e,value){$scope.showResolved=value,update()}),resetPageHidden=function(){for(;$scope.pageHidden.length;)$scope.pageHidden.pop()},getElementPositionRelatedToAncestor=function(element,ancestor){return{top:element.getBoundingClientRect().top-ancestor.getBoundingClientRect().top+ancestor.scrollTop,left:element.getBoundingClientRect().left-ancestor.getBoundingClientRect().left+ancestor.scrollLeft}},search=function(where,what){return-1!==where.toLocaleLowerCase().indexOf(what.toLocaleLowerCase())},testResolved=function(comment){return $scope.showResolved||!comment.resolved.is},testBreakpoint=function(comment){return $scope.isDocument||!$scope.showCurrentPageOnly||PagesService.pagesMap[comment.id_page].version_type===PagesService.currentBreakpointId},testSearch=function(comment){if(!$scope.searchFor)return!0;var child,id=comment._id,showChild=!1,found=!1,comments=CommentsService.commentsTree[id];if(comments&&comments.forEach(function(childId){return child=CommentsService.commentsMap[childId],search(child.comment,$scope.searchFor)?(showChild=!0,!1):void 0}),found=search(comment.comment,$scope.searchFor)||showChild||!$scope.showCurrentPageOnly&&search($scope.getPageName(comment.id_page),$scope.searchFor),showChild&&$rootScope.$emit(PreviewEnums.OPEN_GROUP,id,"panel",!0),!$scope.showCurrentPageOnly){var pageId=PagesService.pagesMap[comment.id_page].version_of||comment.id_page;found&&$scope.isPageHidden(pageId)&&$scope.togglePageHidden(null,pageId)}return found},canDisplayComment=function(comment){return!comment._parent_comment&&testResolved(comment)&&testBreakpoint(comment)&&testSearch(comment)},update=function(){$scope.showCurrentPageOnly?buildList():buildTree()},buildList=function(){$scope.list=[],_.forEach($scope.comments,function(comment){canDisplayComment(comment)&&$scope.list.push(comment)})},buildTree=function(){$scope.tree={};var page,pageBreakpoint,comment;_.forEach(pagesBreakpoints,function(breakpointIds,pageId){page={},_.forEach(breakpointIds,function(breakpointPageId,breakpointId){pageBreakpoint=[],_.forEach(commentIdsInPage[breakpointPageId],function(commentId){comment=CommentsService.commentsMap[commentId],canDisplayComment(comment)&&pageBreakpoint.push(comment)}),_.isEmpty(pageBreakpoint)||(page[breakpointId]=pageBreakpoint)}),_.isEmpty(page)||($scope.tree[pageId]=page)})},getComments=function(){resetPageHidden(),$scope.loading=!0,CommentsService.getComments($scope.showCurrentPageOnly).then(function(comments){$scope.loading=!1,$scope.comments=comments,commentIdsInPage=CommentsService.commentIdsInPage,pagesBreakpoints=PagesService.pagesBreakpoints,breakpoints=PagesService.breakpointIds,scrollContainer=document.querySelector("section.left-panel > #comments-panel > section.scrolled-container"),scrollContent=scrollContainer.querySelector("section.scrolled-content")})};$scope.loading=!0,$timeout(function(){getComments()},700)}]),angular.module("core").controller("DocumentController",["$rootScope","$scope","$state","$stateParams","DocumentsService","Settings",function($rootScope,$scope,$state,$stateParams,DocumentsService,Settings){"use strict";Settings.setMode($stateParams.mode),$stateParams.documentId||$state.go($state.current.name,{documentId:DocumentsService.currentDocumentId})}]),angular.module("core").controller("HomeController",["$rootScope","$scope","$state","$timeout","$window","animate","LayoutStates","LiveShareService","UsabilityTestService","ProjectsService","PagesService","UsersService","AnalyticsService","Settings","socket","editorSocket","deviceDetectorHelper","Engine",function($rootScope,$scope,$state,$timeout,$window,animate,LayoutStates,LiveShareService,UsabilityTestService,ProjectsService,PagesService,UsersService,AnalyticsService,Settings,socket,editorSocket,deviceDetectorHelper,Engine){"use strict";AnalyticsService.startDesignLoadTrack(),AnalyticsService.event("Opened preview"),socket.emit("addCollaborator",{socketRoomId:ProjectsService.currentProjectHash}),editorSocket.emit("addCollaborator",{socketRoomId:ProjectsService.currentProjectHash});LiveShare.enums.SESSION_TYPES;$scope.panelVisible=!1,$scope.sitemapVisible=!1,$scope.panelFadeIn=!1,$scope.sitemapFadeIn=!1,$scope.isVisible=$scope.panelVisible||$scope.sitemapVisible,$scope.breakpointsVisible=!0,$scope.breadcrumbsVisible=!1,$scope.isLiveSession=!1,$scope.dragging=!1,$scope.isLoading=!0,$scope.isParticipant=!1,$scope.noToolbar=Settings.disableComments&&Settings.disableSitemap,$scope.isAddingComment=!1,$scope.showCrosshairCursor=!1,$scope.canShowLoginToolbar=UsersService.isAnonymous(),$scope.showLoginToolbar=!1,$scope.isAppViewAvailable=deviceDetectorHelper.isAppViewAvailable(),$scope.sidebarVisible=!1;var ANIM_TIME=.3,ANIM_EASE="easeInOutPower2";$scope.keyDown=function(e){var rx=/INPUT|SELECT|TEXTAREA/i;8===e.which&&(!rx.test(e.target.tagName)||e.target.disabled||e.target.readOnly)&&e.preventDefault(),$rootScope.$emit("keyDown",e)},$scope.showToolbar=function(e){LayoutStates.removeState("nosidebar")},$scope.isToolbarVisible=function(){return LayoutStates.isToolbarVisible()};var isSidebarOpen=function(state){return-1===state.indexOf(".nosidebar")},isSitemapOpen=function(state){return-1!==state.indexOf(".sitemap")},isPanelOpen=function(state){return-1!==state.indexOf(".panel")},isOpen=function(state){return isPanelOpen(state)||isSitemapOpen(state)},change=function(panelOpen,sitemapOpen){var sitemap=document.querySelector("section.left-panel#sitemap"),panel=document.querySelector("section.left-panel#comments-notes");panel.style.left=panelOpen?"0px":"-326px",sitemap.style.left=sitemapOpen?"0px":"-326px",animate(panel,ANIM_TIME,{ease:ANIM_EASE,opacity:panelOpen?1:0,visibility:"visible",onComplete:function(){$scope.$apply(function(){$scope.panelVisible=panelOpen,$scope.sitemapVisible=sitemapOpen})}}),animate(sitemap,ANIM_TIME,{ease:ANIM_EASE,opacity:sitemapOpen?1:0,visibility:"visible"})},open=function(value,panelOpen,sitemapOpen){var panelToMove,mainToolbar=document.querySelector("#main-toolbar"),sitemap=document.querySelector("section.left-panel#sitemap"),panel=document.querySelector("section.left-panel#comments-notes");panelToMove=value?sitemapOpen?sitemap:panel:$scope.sitemapVisible?sitemap:panel,animate(panelToMove,ANIM_TIME,{ease:ANIM_EASE,left:value?"0px":"-365px",visibility:"visible",opacity:value?1:0,onComplete:function(){$scope.$apply(function(){$scope.sitemapVisible=sitemapOpen,$scope.panelVisible=panelOpen,$scope.isVisible=$scope.panelVisible||$scope.sitemapVisible}),Engine.updateOffset()},onUpdate:function(){Engine.updateOffset()}}),animate(mainToolbar,ANIM_TIME,{ease:ANIM_EASE,left:value?"326px":"0px"})},updateCrosshairCursor=($rootScope.$on(PreviewEnums.LOADING,function(e,value){$scope.isLoading=value,value||($scope.firstTimeLoaded=!0)}),$rootScope.$on(PreviewEnums.SET_ANONYMOUS_NAME,function(e,name){$scope.showLoginToolbar=!1,name&&(UsersService.setAnonymousName(name),updateCrosshairCursor())}),$rootScope.$on(PreviewEnums.ANONYMOUS_ADD_COMMENT,function(e){onAddingComment(!0)}),$rootScope.$on(PreviewEnums.ON_MODE_CHANGED,function(e){$scope.noToolbar=Settings.disableComments&&Settings.disableSitemap}),function(){$scope.showCrosshairCursor=$scope.isAddingComment&&(!UsersService.isAnonymous()||UsersService.isAnonymousNameSet())}),handlePanelAnimations=($rootScope.$on("$stateChangeSuccess",function(e,toState,toParams,fromState,fromParams){return $scope.isAddingComment=$state.includes("**.add-comment.**"),-1===fromState.name.indexOf("add-comment")&&-1!==toState.name.indexOf("add-comment")?onAddingComment(!0):-1!==fromState.name.indexOf("add-comment")&&-1===toState.name.indexOf("add-comment")&&onAddingComment(!1),$scope.sidebarVisible=!$state.includes("**.nosidebar.**"),""===fromState.name?($scope.panelVisible=$state.includes("**.panel.**"),$scope.sitemapVisible=$state.includes("**.sitemap.**"),void($scope.isVisible=$scope.panelVisible||$scope.sitemapVisible)):void handlePanelAnimations(toState,fromState)}),function(toState,fromState){isOpen(toState.name)&&!isOpen(fromState.name)?open(!0,isPanelOpen(toState.name),isSitemapOpen(toState.name)):!isOpen(toState.name)&&isOpen(fromState.name)?open(!1,isPanelOpen(toState.name),isSitemapOpen(toState.name)):isOpen(toState.name)&&isOpen(fromState.name)&&isPanelOpen(toState.name)!==isPanelOpen(fromState.name)?change(isPanelOpen(toState.name),isSitemapOpen(toState.name)):isOpen(toState.name)&&isOpen(fromState.name)&&isSidebarOpen(toState.name)!==isSidebarOpen(fromState.name)&&open(isSidebarOpen(toState.name),isPanelOpen(toState.name),isSitemapOpen(toState.name))}),onAddingComment=($rootScope.$on(PreviewEnums.DRAGGING_COMMENT,function(e,value){$scope.dragging=value}),function(value){updateCrosshairCursor(),$scope.showLoginToolbar=value&&UsersService.isAnonymous()&&!UsersService.isAnonymousNameSet()}),liveShareSessionstarted=function(SessionService){$scope.isLiveSession=!0,LayoutStates.setStateById("isLiveShareSession",!0),SessionService.isHostSession()||($scope.breakpointsVisible=!1,$scope.breadcrumbsVisible=!0)},usabilityTestSessionStarted=function(SessionService){$scope.isLiveSession=!0,$scope.isVisible=!0,$scope.sitemapVisible=!0,$scope.isParticipant=!SessionService.isHostSession(),LayoutStates.setStateById("isUserTestingSession",!0),LayoutStates.setStateById("isHostSession",SessionService.isHostSession()),open(!0,!1,!0)};LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.START,liveShareSessionstarted.bind(this,LiveShareService)),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,usabilityTestSessionStarted.bind(this,UsabilityTestService));var liveSessionfinished=function(){$scope.breakpointsVisible=!0,$scope.breadcrumbsVisible=!1,$scope.isLiveSession=!1,$scope.isParticipant=!1};LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,liveSessionfinished.bind(this)),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,liveSessionfinished.bind(this)),angular.element($window).bind("resize",function(){Settings.isResponsive&&PagesService.setPageResponsive($window.innerWidth)}),$rootScope.$on(PreviewEnums.ON_APP_VIEW_PROMO_CLOSE,function(){$scope.isAppViewAvailable=!1})}]),angular.module("core").controller("LiveShareConfigurationController",["$scope","$state","$translate","$modal","$modalInstance","LiveShareService",function($scope,$state,$translate,$modal,$modalInstance,LiveShareService){"use strict";function getConfigurationOptions(){var options=[];return $scope.liveShareOptions.forEach(function(option){option.value&&options.push(option.param)}),options.join(",")}LiveShareService.getConfigurationOptions().then(function(options){$scope.liveShareOptions=options}),$scope.contributors=[],$scope.inviteUrl=null,LiveShareService.roomId()?$scope.inviteUrl=LiveShareService.getInviteURL(LiveShareService.roomId):LiveShareService.makeRoomReservation().then(function(roomId){$scope.inviteUrl=LiveShareService.getInviteURL(roomId)},function(){$modalInstance.close(),$state.reload()}),$scope.start=function(){LiveShareService.startInitializing({options:getConfigurationOptions()}),$modalInstance.close()},$scope.onClickLink=function($event){$event.target.select()}}]),angular.module("core").controller("LiveShareFinishController",["$scope","$state","$stateParams","$timeout","PagesService","ProjectsService","LiveSessionInstanceService","ChromeExtensionService",function($scope,$state,$stateParams,$timeout,PagesService,ProjectsService,LiveSessionInstanceService,ChromeExtensionService){"use strict";var TYPES=LiveShare.enums.SESSION_STATUS,LiveSessionInstance=LiveSessionInstanceService.get();$scope.backUrl=document.URL.split("#")[0],$scope.projectName=ProjectsService.currentProjectName,$scope.onClickBackToPreview=function($event){$event.preventDefault(),window.location.replace($scope.backUrl)};var isLiveShareSession;if(LiveSessionInstance.getType()===LiveShare.enums.SESSION_TYPES.TESTING){isLiveShareSession=!1;try{ChromeExtensionService.postMessage({stop:!0})}catch(e){window.console.error(e.stack)}LiveSessionInstance.finishTestingSession()}else isLiveShareSession=!0;switch($stateParams.type){case TYPES.QUIT:var REDIRECT_AFTER=3e3;$scope.message="LS_SESSION_QUIT",$timeout(function(){window.location.replace($scope.backUrl)},REDIRECT_AFTER);break;case TYPES.BANNED:$scope.message="LS_SESSION_BANNED";break;case TYPES.OVER:isLiveShareSession?$scope.message="LS_SESSION_OVER":($scope.backUrl=!1,$scope.message="UT_THANKS_FOR_CONTRIBUTION");break;default:$scope.message="LS_SESSION_404"}}]),angular.module("core").controller("LiveShareInitializeController",["$q","$rootScope","$scope","$state","$stateParams","$timeout","$modal","ProjectsService","LiveSessionInstanceService","UsersService","UsabilityTestService","LiveShareService","ChromeExtensionService",function($q,$rootScope,$scope,$state,$stateParams,$timeout,$modal,ProjectsService,LiveSessionInstanceService,UsersService,UsabilityTestService,LiveShareService,ChromeExtensionService){"use strict";function updateProgress(progress){$scope.loadingProgress=progress}function setName(){var d=$q.defer();return""!==$scope.userName.trim()&&d.resolve($scope.userName),$scope.$watch("userName",function(newValue){newValue&&""!==newValue.trim()&&d.resolve(newValue)}),d.promise}function generateSessionConfiguration(options,roomId){var settings;return settings=isLiveShareSession?{leadCursor:"host",triggerEvents:"host"}:{triggerEvents:"all",showCursor:"tester",leadCursor:"tester",toggleFollow:!1},options&&options.split(",").forEach(function(optionName){var option=LiveSessionInstance.translateOption(optionName,!0),key=Object.keys(option)[0];settings[key]=option[key]}),settings}function createSession(){var roomData={roomID:LiveSessionInstance.roomId(),url:LiveSessionInstance.getDestinationUrl(),name:ProjectsService.currentProjectName,roomSettings:generateSessionConfiguration($stateParams.options),type:LiveSessionInstance.getType()};if(myData=_.extend(myData,{sessionId:UsersService.me.id_session,name:$scope.userName}),isLiveShareSession)LiveSessionInstance.create(roomData,myData).then(sessionInitialized,sessionInitializationFailed);else{LiveSessionInstance.getTestData();LiveSessionInstance.save().then(function(testData){LiveSessionInstance.setDataId(testData._id),roomData.testDataId=testData._id,LiveSessionInstance.create(roomData,myData).then(function(roomData){sessionInitialized(roomData);try{ChromeExtensionService.postMessage({canRecord:!0,testId:roomData.testDataId})}catch(e){window.console.error(e.stack)}},sessionInitializationFailed)})}}function joinToSession(){var onContentLoaded=$rootScope.$on(PreviewEnums.ON_CONTENT_LOADED,function(){onContentLoaded(),setName().then(function(name){LiveSessionInstance!==UsabilityTestService||UsabilityTestService.getTestData()?LiveSessionInstance.join($stateParams.sessionId,myData).then(sessionInitialized,sessionInitializationFailed):(myData=_.extend(myData,{type:LiveShare.enums.USER_TYPES.TESTER}),LiveSessionInstance.join($stateParams.sessionId,myData).then(function(roomData){UsabilityTestService.setDataId(roomData.testDataId),UsabilityTestService.fetch().then(sessionInitialized.bind(this,roomData),sessionInitializationFailed)},sessionInitializationFailed))})})}function sessionInitialized(roomData){var DELAY_AFTER_PROGRESS_BAR_ANIMATION=800;LiveSessionInstance.roomId(roomData.roomID),updateProgress(100),$timeout(function(){$state.go("home.page",{pageId:$stateParams.pageId}),isLiveShareSession||LiveSessionInstance.isHostSession()||$modal.open({templateUrl:"/scripts/modules/core/views/usabilityTest/introduction.view.html",controller:"UsabilityTestIntroductionController",keyboard:!1})},DELAY_AFTER_PROGRESS_BAR_ANIMATION)}function sessionInitializationFailed(e){$state.go("home.page.live-share-finish",{type:LiveShare.enums.SESSION_STATUS.OVER}),window.console.error(e.stack)}LiveSessionInstanceService.get()||($stateParams.type===LiveShare.enums.SESSION_TYPES.TESTING?LiveSessionInstanceService.set(UsabilityTestService):LiveSessionInstanceService.set(LiveShareService));var LiveSessionInstance=LiveSessionInstanceService.get(),isLiveShareSession=LiveSessionInstance===LiveShareService;if(LiveSessionInstance.isSession())return $state.go("home.page");var myData={settings:{muted:LiveSessionInstance.muted}};$scope.sessionTypeName=isLiveShareSession?"LS_NAME_SHARING":"LS_NAME_TESTING",$scope.loadingProgress=0,$scope.projectName=ProjectsService.currentProjectName,$scope.userName="",$scope.loginUrl=null,UsersService.isAnonymous()?($scope.name=UsersService.isAnonymousNameSet()?UsersService.me.name:"",$scope.loginUrl=ApplicationConfiguration.loginPageURL+"?cb="+encodeURIComponent(document.URL)):($scope.userName=UsersService.me.name||"",myData.customData={avatar:UsersService.me.avatar||null,uxpin_id:UsersService.me.id_user,id_session:UsersService.me.id_session}),$scope.onFormSubmit=function(name){$scope.working=!0,$scope.userName=name,UsersService.setAnonymousName(name)},$stateParams.sessionId?joinToSession():createSession()}]),angular.module("core").controller("LoginToolbarController",["$rootScope","$scope","$state","$timeout","UsersService",function($rootScope,$scope,$state,$timeout,UsersService){"use strict";var isValid=function(name){return name&&name.match(/\w+/)},setName=function(){var HIDE_TOOLBAR_TIMEOUT=1e3,name=$scope.anonymousName.trim();isValid(name)&&($scope.nameSet=!0,$timeout(function(){$scope.setFocus(!1),$scope.showNameForm=!1,$rootScope.$emit(PreviewEnums.SET_ANONYMOUS_NAME,name)},HIDE_TOOLBAR_TIMEOUT))},hide=function(){$scope.setFocus(!1),$scope.showNameForm=!1,$scope.disabled=!0,$rootScope.$emit(PreviewEnums.SET_ANONYMOUS_NAME)},getReferer=function(){return ApplicationConfiguration.loginPageURL+"/?cb="+encodeURIComponent(window.location.href)};$scope.showNameForm=!1,$scope.disabled=!0,$scope.nameSet=!1,$scope.referer=getReferer(),$scope.anonymousName="",$scope.focused=!1,$scope.setFocus=function(value,delay){delay>0?$timeout(function(){$scope.focused=value},delay):$scope.focused=value},$scope.onClickShowNameForm=function(e){$scope.anonymousName="",$scope.showNameForm=!0,$scope.setFocus(!0,300)},$scope.onClickSetName=function(e){setName()},$scope.onChange=function(){$scope.disabled=!isValid($scope.anonymousName.trim())},$scope.updateReferer=function(){$scope.referer=getReferer()},$scope.onKeyDown=function(e){13===e.which?(e.stopPropagation(),e.preventDefault(),setName()):27===e.which&&($state.includes("**.add-comment.**")||(e.stopPropagation(),hide()))};$rootScope.$on(PreviewEnums.SELECT_COMMENT,function(e,id){$state.includes("**.add-comment.**")||hide()}),$rootScope.$on(PreviewEnums.ANONYMOUS_ADD_COMMENT,function(e){$scope.showNameForm&&$scope.setFocus(!0,1)}),$rootScope.$on("$stateChangeSuccess",function(e,toState,toParams,fromState,fromParams){-1!==fromState.name.indexOf("add-comment")&&-1===toState.name.indexOf("add-comment")&&hide()})}]),angular.module("core").controller("NavController",["$rootScope","$scope","$state","$stateParams","$modal","CommentsService","LiveShareService","UsabilityTestService","UsersService","ProjectsService","UXPinService","Settings","LayoutStates",function($rootScope,$scope,$state,$stateParams,$modal,CommentsService,LiveShareService,UsabilityTestService,UsersService,ProjectsService,UXPinService,Settings,LayoutStates){"use strict";var originalItems,ITEMS_MAP={comments:{section:1,classes:"add-comment icon-font-comment-mode",tooltip:"TIP_COMMENT_MODE",state:"add-comment",parentState:"*",toggle:!0},collaboration:{section:2,classes:"collaboration icon-font-user",tooltip:"TIP_COLLABORATION",state:"home.page.collab",toggle:!1},commentsNotes:{section:2,classes:"comments-notes icon-font-comment-notes",tooltip:"TIP_COMMENTS_NOTES",state:"panel",parentState:["home.page","home.page.comment","home.document","home.document.comment"],toggle:!0,toggleWith:["sitemap"]},sitemap:{section:2,classes:"sitemap icon-font-sitemap",tooltip:"TIP_SITEMAP",state:"sitemap",parentState:["home.page","home.page.comment"],toggle:!0,toggleWith:["panel"]},liveShare:{section:3,classes:"icon-font-live-share",tooltip:"TIP_LIVE_SHARE",state:"live-share-start",parentState:"*",toggle:!0},usabilityTesting:{section:3,classes:"icon-font-usability-testing",tooltip:"TIP_USABILITY_TEST",state:"usability-test",parentState:"*",toggle:!0}},generateMenu=function(items){var index;originalItems=items,$scope.items=_.clone(originalItems),Settings.disableComments&&(index=$scope.items.indexOf(ITEMS_MAP.comments),-1!==index&&$scope.items.splice(index,1),index=$scope.items.indexOf(ITEMS_MAP.commentsNotes),-1!==index&&$scope.items.splice(index,1)),
Settings.disableSitemap&&(index=$scope.items.indexOf(ITEMS_MAP.sitemap),-1!==index&&$scope.items.splice(index,1)),$scope.params.toolbarEnabled=!(Settings.disableSitemap&&Settings.disableComments)};$scope.itemsMap={},$scope.isUserTestingSession=!1,$scope.isLiveShareSession=!1,$scope.isHostSession=!1,$scope.sessionStartTime=null,$scope.params={isLogged:!(UsersService.me.is_anonymous||Settings.isExport()),isDocument:ProjectsService.isDocument(),isUXTestDocument:ProjectsService.isUXTestDocument(),isOwner:UsersService.me.is_owner,features:Settings.isExport()?{}:ProjectsService.currentProjectFeatures,toolbarEnabled:null,isExport:Settings.isExport()},UsersService.me.is_owner?($scope.params.currentDocumentURL=UXPinService.getCurrentDocumentURL(),$scope.params.dashboardURL=UXPinService.getCurrentCollectionURL()):($scope.params.currentDocumentURL=null,$scope.params.dashboardURL=UXPinService.getDashboardURL());var liveSessionStarted=function(SessionService){$scope.isLiveShareSession=!0,SessionService===UsabilityTestService?($scope.isUserTesting=!0,SessionService.isHostSession()&&($scope.isHostSession=!0),$scope.onClickFinishSession=function($event){$event.preventDefault(),UsabilityTestService.quit()}):SessionService.isHostSession()||generateMenu([ITEMS_MAP.commentsNotes])},liveSessionFinished=function(){$scope.isUserTestingSession=!1,$scope.isHostSession=!1,generateMenu([ITEMS_MAP.comments,ITEMS_MAP.commentsNotes,ITEMS_MAP.sitemap,ITEMS_MAP.liveShare,ITEMS_MAP.usabilityTesting])},plans=function(){$scope.upgradePlanURL=ApplicationConfiguration.upgradePlanURL,$scope.onClickPlanUpgrade=function($event){$event.preventDefault(),$modal.open({templateUrl:"/scripts/modules/core/views/planUpgrade/modal.view.html",controller:"PlanUpgradeController"})}};LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.START,liveSessionStarted.bind(this,LiveShareService)),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,liveSessionStarted.bind(this,UsabilityTestService)),LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,liveSessionFinished),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,liveSessionFinished),$scope.isActive=function(state){return hasState(state)},$scope.testerJoined=!1;var testerJoinedDate,testerJoined=function(data){$scope.$apply(function(){testerJoinedDate=data.started_at,$scope.testerJoined=!0})};UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.TESTER_JOINED,testerJoined),LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.TESTER_JOINED,testerJoined);var allowStart=function(){var startTime=function(){$scope.testerJoined&&($scope.sessionStartTime=String(new Date))};$scope.testerJoined?startTime():$scope.$watch("testerJoined",startTime)};UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.ALLOW_START,allowStart),LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.ALLOW_START,allowStart),$scope.onClick=function(item){item.toggle===!0?toggleState(item.state):enterState(item.state)},$scope.$on("$destroy",function(){onSelectComment(),onDeleteComment(),onKeyDown(),onModeChanged()}),$scope.onConfigureLiveShareSession=function($event){$event.preventDefault(),$scope.params.settingsOpen=!1,$modal.open({templateUrl:"/scripts/modules/core/views/liveShare/configuration.view.html",controller:"LiveShareConfigurationController"})},$scope.onClickUsabilityTestSession=function(){$state.go("home.page.usability-test",$stateParams)},$scope.closeToolbar=function(){LayoutStates.enterState("nosidebar")},$scope.isToolbarVisible=function(){return LayoutStates.isToolbarVisible()};var onKeyDown=$rootScope.$on("keyDown",function(e,kE){if(27===kE.which)if(hasState("comment")&&!CommentsService.selectedCommentShowNotificationPanel){kE.stopPropagation();var newState=$state.current.name.replace("home.page.comment","home.page");enterState(newState)}else hasState("add-comment")&&!CommentsService.selectedCommentShowNotificationPanel&&(kE.stopPropagation(),toggleState("add-comment"))}),onModeChanged=$rootScope.$on(PreviewEnums.ON_MODE_CHANGED,function(e){generateMenu(originalItems)}),onSelectComment=$rootScope.$on(PreviewEnums.SELECT_COMMENT,function(e,id,type,redirect){var newState,currentState=$state.current.name,options=function(){return redirect?{location:"replace"}:null}();if(id=CommentsService.getRedirectId(id)){UsersService.isAnonymous()||CommentsService.markAsRead(id);var pageId=CommentsService.commentsMap[id].id_page;if(hasState("comment")){if($state.includes("**.comment.**",{commentId:id}))return;CommentsService.selectedCommentId=id,enterState(currentState,{pageId:pageId,commentId:id},options)}else newState=currentState.replace("home.page","home.page.comment"),CommentsService.selectedCommentId=id,enterState(newState,{pageId:pageId,commentId:id},options)}else hasState("comment")&&(newState=currentState.replace("home.page.comment","home.page"),CommentsService.selectedCommentId=null,enterState(newState,null,options))}),onDeleteComment=$rootScope.$on(PreviewEnums.DELETE_COMMENT,function(e,id,isReply){if(!isReply){var newState,currentState=$state.current.name;hasState("comment")&&(newState=currentState.replace("home.page.comment","home.page"),enterState(newState))}}),toggleState=($rootScope.$on(PreviewEnums.DELETING_COMMENT,function(e,id,value){var newState,currentState=$state.current.name;value&&hasState("comment")&&(newState=currentState.replace("home.page.comment","home.page"),enterState(newState))}),function(state){var newState,currentState=$state.current.name;hasState(state)?(newState=currentState.replace("."+state,""),enterState(newState)):enterState(0===state.indexOf("home.")?state:getState(currentState,state))}),enterState=function(state,params,options){$state.go(state,params,options)},hasState=function(state){return $state.includes("**."+state+".**")},getState=function(fromState,toState){var state,item=$scope.itemsMap[toState];if(_.isArray(item.toggleWith)&&(_.forEach(item.toggleWith,function(value){return hasState(value)?(state=fromState.replace("."+value,"."+toState),!1):void 0}),state))return state;if(_.isArray(item.parentState)){if(_.forEachRight(item.parentState,function(value){return-1!==fromState.indexOf(value)?(state=fromState.replace(value,value+"."+toState),!1):void 0}),state)return state}else if("*"===item.parentState)return fromState+"."+toState;return fromState};generateMenu(Settings.isExport()?[ITEMS_MAP.sitemap]:[ITEMS_MAP.comments,ITEMS_MAP.commentsNotes,ITEMS_MAP.sitemap,ITEMS_MAP.liveShare,ITEMS_MAP.usabilityTesting]),_.forEach(ITEMS_MAP,function(value,key){$scope.itemsMap[value.state]=value}),plans($scope,$modal)}]),angular.module("core").controller("PageController",["$rootScope","$scope","$state","$stateParams","PagesService","CommentsService","Settings","pages","isMobile","$modal",function($rootScope,$scope,$state,$stateParams,PagesService,CommentsService,Settings,pages,isMobile,$modal){"use strict";if(isMobile||Settings.isExport()&&!Settings.isMenuEnabled()?Settings.setMode("cm"):Settings.setMode($stateParams.mode),$scope.gotoPage=function(id,redirect){var options=function(){return redirect?{location:"replace"}:null}();$state.go($state.current.name,{pageId:id},options)},$scope.previousPageId=PagesService.currentPageId,$stateParams.pageId){var pageId=parseInt($stateParams.pageId),changePage=!!PagesService.currentPageId;if(PagesService.pagesMap[pageId]&&null===PagesService.pagesMap[pageId].version_type){var page=_.find(pages,function(page){return page.version_type===PagesService.defaultBreakpointId&&page.version_of===pageId});return PagesService.setCurrentPageId(page.id_page),$scope.gotoPage(page.id_page,!0)}PagesService.pagesMap[pageId]?pageId!==PagesService.currentPageId&&(PagesService.setCurrentPageId(pageId),changePage&&($rootScope.$emit(PreviewEnums.ADDING_COMMENT,!1),$rootScope.$emit(PreviewEnums.LOADING_COMMENTS,!0),CommentsService.getComments().then(function(){$rootScope.$emit(PreviewEnums.LOADING_COMMENTS,!1)}))):(PagesService.setCurrentPageId(PagesService.getRootPage()),$scope.gotoPage(PagesService.currentPageId,!0))}else PagesService.setCurrentPageId(PagesService.getRootPage()),$scope.gotoPage(PagesService.currentPageId,!0);$rootScope.$on(PreviewEnums.NAVIGATE_TO_PAGE,function(e,pageId){$scope.gotoPage(pageId)}),$rootScope.$on(PreviewEnums.NAVIGATE_HISTORY_BACK,function(){$scope.previousPageId&&$scope.gotoPage($scope.previousPageId)})}]),angular.module("core").controller("PlanUpgradeController",["$scope","$modalInstance","$transition","$window","localStorageService",function($scope,$modalInstance,$transition,$window,localStorageService){"use strict";var videoElem=null,onYoutubePlayerReady=null,videoId="DN81evKgaW8",movieOnClass="movie-on",moviePartSelector="section.movie-part";$scope.upgradePlanURL=ApplicationConfiguration.upgradePlanURL,$scope.video={id:videoId,player:null},onYoutubePlayerReady=$scope.$on("youtube.player.ready",function($event,player){$scope.video.player=player,videoElem=angular.element(document.querySelector(moviePartSelector))}),$scope.playMovie=function($event){$transition(videoElem,movieOnClass).then(function(){$scope.video.player.playVideo()})},$scope.closeMovie=function($event){$transition(videoElem,videoElem.removeClass(movieOnClass)).then(function(){$scope.video.player.stopVideo()})},$scope.closeModal=function($event){$modalInstance.close()},$scope.upgradePlan=function($event){var dstUrl=$event.target.getAttribute("href"),re=new RegExp("^"+$window.location.origin),relativeURI=$window.location.href.replace(re,"");$event.preventDefault(),localStorageService.cookie.set("ba_cb",relativeURI),$modalInstance.close(),$window.location.href=dstUrl},$scope.$on("$destroy",function(){onYoutubePlayerReady()})}]),angular.module("core").controller("SettingsBarController",["$rootScope","$scope","$state","LiveShareService","UsabilityTestService",function($rootScope,$scope,$state,LiveShareService,UsabilityTestService){"use strict";$scope.isLiveShareSession=LiveShareService.isSession();var liveSessionStarted=function(){$scope.$apply(function(){$scope.isLiveShareSession=!0})};LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.START,liveSessionStarted.bind(this)),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,liveSessionStarted.bind(this));var liveSessionFinished=function(){$scope.isLiveShareSession=!1};LiveShareService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,liveSessionFinished.bind(this)),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.FINISH,liveSessionFinished.bind(this))}]),angular.module("core").controller("SettingsBarLiveShareController",["$rootScope","$scope","$state","$timeout","$modal","LiveSessionInstanceService",function($rootScope,$scope,$state,$timeout,$modal,LiveSessionInstanceService){"use strict";var LiveSessionInstance=LiveSessionInstanceService.get();$scope.isHostSession=LiveSessionInstance.isHostSession(),$scope.settingsPanelVisibilityModel=!1,$scope.muted=!1,$scope.inviteURL=LiveSessionInstance.getInviteURL(),$scope.collaborators=LiveSessionInstance.getCollaboratorsData(),$scope.isUserTestingMode=LiveSessionInstance.getType()===LiveShare.enums.SESSION_TYPES.TESTING,$scope.host=null;var SHOW_SETTINGS_AFTER=1e3;$timeout(function(){$scope.settingsPanelVisibilityModel=!0},SHOW_SETTINGS_AFTER),$scope.onClickMute=function(e){$scope.muted=LiveSessionInstance.muted=!LiveSessionInstance.muted,LiveSessionInstance.mute($scope.muted),updateCollaboratorsList(!0)},$scope.onClickRemoveUser=function($event,userID){$event.preventDefault(),LiveSessionInstance.removeCollaborator(userID)},$scope.onClickFinishSession=function($event){$event.preventDefault(),LiveSessionInstance.quit()},$scope.onClickInut=function($event){$event.target.select()};var updateCollaboratorsList=function(inScope){inScope?$scope.collaborators=LiveSessionInstance.getCollaboratorsData():$scope.$apply(function(){$scope.collaborators=LiveSessionInstance.getCollaboratorsData()})};LiveSessionInstance.registerObserverCallback("onMute",updateCollaboratorsList),LiveSessionInstance.registerObserverCallback("collaboratorJoin",updateCollaboratorsList.bind(this,!1)),LiveSessionInstance.registerObserverCallback("collaboratorLeft",updateCollaboratorsList.bind(this,!1)),LiveSessionInstance.registerObserverCallback("finish",function(data){$scope.collaborators=[],$state.go("home.page.live-share-finish",data)}),$scope.isHostSession||($scope.host=LiveSessionInstance.getHostData(),LiveSessionInstance.registerObserverCallback("followCursorOff",function(){$scope.$apply(function(){$scope.host=LiveSessionInstance.getHostData()})}),$scope.onClickFollowHost=function($event){$event.preventDefault(),$scope.host.isFollowed=!0,LiveSessionInstance.followCursor($scope.host.id)}),LiveSessionInstance.getConfigurationOptions().then(function(options){$scope.configuration=options}),$scope.setOption=function(option){LiveSessionInstance.setOption(option.param,option.value)},$scope.onClickCopy=function($event){var HIDE_COPY_MESSAGE_AFTER=1e3;$event.preventDefault(),$scope.isCopied=!0,$timeout(function(){$scope.isCopied=!1,$scope.settingsPanelVisibilityModel=!1},HIDE_COPY_MESSAGE_AFTER)}}]),angular.module("core").controller("SettingsBarPreviewController",["_","$rootScope","$scope","$state","$stateParams","$timeout","$modal","UsersService","Settings","ProjectsService","PagesService","DOMService","Engine",function(_,$rootScope,$scope,$state,$stateParams,$timeout,$modal,UsersService,Settings,ProjectsService,PagesService,DOMService,Engine){"use strict";$scope.params={showComments:Settings.showComments,showResolved:Settings.showResolvedComments,isResponsive:Settings.isResponsive,isLogged:!UsersService.me.is_anonymous,isDocument:ProjectsService.isDocument(),isUXTestDocument:ProjectsService.isUXTestDocument(),isOwner:ApplicationConfiguration.userData.is_owner,features:ApplicationConfiguration.project.features||{},includeSitemapComments:!Settings.disableComments&&!Settings.disableSitemap,isExport:Settings.isExport()},$scope.onClickHighlight=function(){Preview.highlightInteractive(Engine.getPage())},$scope.onClickPlanUpgrade=function($event){$event.preventDefault(),$modal.open({templateUrl:"/scripts/modules/core/views/planUpgrade/modal.view.html",controller:"PlanUpgradeController"})},$scope.onShowComments=function(){Settings.setShowComments($scope.params.showComments)},$scope.onShowResolved=function(){Settings.setShowResolvedComments(!Settings.showResolvedComments)},$scope.onResponsive=function(){var value=$scope.params.isResponsive;Settings.setResponsive(value),value&&PagesService.setPageResponsive(DOMService.getWindowWidth())},$scope.selectText=function($event){$event.target.select()},$scope.onClickCopy=function($event){$event.preventDefault(),$scope.isCopied=!0,$timeout(function(){$scope.isCopied=!1,$scope.params.shareOpen=!1},1e3)},$scope.onShareSettingsChanged=function($event){$scope.shareURL=getShareUrl()},$scope.$on("$destroy",function(){onSettingsChanged(),onStateChangeSuccess()});var onSettingsChanged=$rootScope.$on(PreviewEnums.ON_SHOW_COMMENTS_RESOLVED_SETTINGS_CHANGED,function(e,value){$scope.params.showResolved=value}),onStateChangeSuccess=$rootScope.$on("$stateChangeSuccess",function(){$scope.shareURL=getShareUrl()}),getShareUrl=function(){var id_page=$stateParams.pageId,id_comment=$stateParams.commentId,url=window.location.origin+window.location.pathname+"#";return id_page&&(url+="/pages/"+id_page),$scope.params.includeSitemapComments&&id_comment&&(url+="/comments/"+id_comment),$scope.params.includeSitemapComments||(url+="?mode=cm"),url};$scope.shareURL=getShareUrl()}]),angular.module("core").controller("SidebarController",["$scope","UsabilityTestService",function($scope,UsabilityTestService){"use strict";$scope.isUserTesting=UsabilityTestService.isSession();var usabilityTestSessionStarted=function(){$scope.isUserTesting=!0};UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,usabilityTestSessionStarted.bind(this))}]),angular.module("core").controller("SitemapController",["$scope","$state","$q","CommentsService","PagesService","UsabilityTestService","Settings","editorSocket",function($scope,$state,$q,CommentsService,PagesService,UsabilityTestService,Settings,editorSocket){"use strict";$scope.isVisible=function(){return $state.includes("**.sitemap.**")},$scope.getPageName=function(id){return PagesService.pagesMap[id].name},$scope.isActive=function(id){return PagesService.currentPageId===PagesService.getPageByBreakpoint(id)},$scope.isIndent=function(){var isIndent=!1;return PagesService.pagesTree.nodes?(PagesService.pagesTree.nodes.forEach(function(node){return node.nodes.length?(isIndent=!0,!1):void 0}),isIndent):isIndent},$scope.onClick=function(e,id){var newState,currentState=$state.current.name;newState=$state.includes("**.comment.**")?currentState.replace("home.page.comment","home.page"):currentState,$state.go(newState,{pageId:PagesService.getPageByBreakpoint(id)})},$scope.onSearchClick=function(e){$scope.focused=!0},$scope.keyDown=function(e){e.stopPropagation(),27===e.which&&(""!==$scope.searchFor?$scope.searchFor="":$scope.focused=!1)},$scope.comparatorSearch=function(actual){return""===$scope.searchFor?!0:recursiveSearch(actual)},$scope.init=function(id){-1!==Settings.minimized.indexOf(String(id))?$scope.minimized[id]=!0:"undefined"==typeof $scope.minimized[id]&&($scope.minimized[id]=!1)},$scope.toggleMinimized=function(id){if($scope.minimized[id])Settings.minimized.push(String(id));else{var index=Settings.minimized.indexOf(String(id));Settings.minimized.splice(index,1)}Settings.updateMinimized()};var recursiveSearch=function(id){var i,page=PagesService.pagesMap[id],children=PagesService.pagesChildrenMap[id];if(search(page.name,$scope.searchFor))return!0;if(children)for(i=0;i<children.length;i++)if(recursiveSearch(children[i]))return!0;return!1},search=function(where,what){return-1!==where.toLocaleLowerCase().indexOf(what.toLocaleLowerCase())};$scope.tree=PagesService.pagesTree.nodes,$scope.focused=!1,$scope.searchFor="",$scope.filterSearch={id:null},$scope.minimized={},$scope.isHost=UsabilityTestService.isSession()&&UsabilityTestService.isHostSession(),$scope.isSitemapAvailable=UsabilityTestService.isSession()&&UsabilityTestService.getMyData().settings[LiveShare.enums.ROOM_SETTINGS.SEE_SITEMAP],$scope.isMessageVisible=!0,$scope.message="Waiting for participant",UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.OPTIONS_CHANGED,function(data){data.key===LiveShare.enums.ROOM_SETTINGS.SEE_SITEMAP&&$scope.$apply(function(){$scope.isSitemapAvailable=data.val})}),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,function(){$scope.$apply(function(){$scope.isMessageVisible=!0,$scope.message="Waiting for participant"})}),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.TESTER_JOINED,function(){$scope.$apply(function(){$scope.isMessageVisible=!0,$scope.message="Waiting for participant to allow Camera access"})}),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.VIDEO_PARTICIPANT_JOINED,function(){$scope.$apply(function(){$scope.isMessageVisible=!1,$scope.message=""})}),UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.VIDEO_PARTICIPANT_LEFT,function(){$scope.$apply(function(){$scope.isMessageVisible=!0,$scope.message="Waiting for participant"})});var resetSitemap=function(){return PagesService.getPages().then(function(){var d=$q.defer();return $scope.tree=PagesService.pagesTree.nodes,d.resolve(),d.promise})};editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_CREATE,resetSitemap),editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_UPDATE,resetSitemap),editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_REORDER,resetSitemap),editorSocket.on(PreviewEnums.SOCKET.ON_PAGE_DELETE,function(){resetSitemap().then(function(){"undefined"==typeof PagesService.pagesMap[PagesService.currentPageId]&&$scope.onClick(null,PagesService.rootPageId)})})}]),angular.module("core").controller("UsabilityTestIntroductionController",["$rootScope","$scope","$sce","$filter","$modalInstance","UsabilityTestService","ProjectsService",function($rootScope,$scope,$sce,$filter,$modalInstance,UsabilityTestService,ProjectsService){"use strict";function formatNewLines(string){return $sce.trustAsHtml($filter("newLine")(string))}var testData=UsabilityTestService.getTestData();$scope.params={projectName:ProjectsService.currentProjectName,introduction:formatNewLines(angular.copy(testData.meta.introduction)),agreement:!1,activeStep:1,answerVideo:!1,blockVideo:!1},$scope.isActiveStep=function(number){return $scope.params.activeStep===number},$scope.onClickNextStep=function(number){$scope.params.activeStep=number},$scope.onClickStartSession=function(){var modalBoxWrapper=document.getElementById("modalBoxWrapper");$modalInstance.close(),document.body.removeChild(modalBoxWrapper),UsabilityTestService.startSession(LiveShare.enums.USER_TYPES.TESTER)},$scope.$on("$destroy",function(){onAllowCamera()});var onAllowCamera=$rootScope.$on(PreviewEnums.MEDIA_ACCESS,function(e,value){$scope.$apply(function(){$scope.params.answerVideo=!0,$scope.params.blockVideo=PreviewEnums.MEDIA_ACCESS_TYPE.DENIED===value})})}]),angular.module("core").controller("UsabilityTestTasksController",["$scope","$sce","$filter","UsabilityTestService",function($scope,$sce,$filter,UsabilityTestService){"use strict";function formatNewLines(string){if(!string||"string"!=typeof string)throw new TypeError("String param required");return $sce.trustAsHtml($filter("newLine")(string))}function formatTasks(tasksCollection){function formatTask(task){return task.content=formatNewLines(task.content),task}return Array.isArray(tasksCollection)?tasksCollection.map(function(task){return formatTask(task)}):formatTask(tasksCollection)}var EVENTS=LiveShare.enums.EVENTS,ROOM_SETTINGS=LiveShare.enums.ROOM_SETTINGS;UsabilityTestService.registerObserverCallback(EVENTS.UPDATE_TASKS,function(tasks){$scope.$apply(function(){$scope.params.tasks=formatTasks(tasks)})}),$scope.isResolveButton=UsabilityTestService.getMyData().settings[ROOM_SETTINGS.CAN_CLOSE_TASKS],UsabilityTestService.registerObserverCallback(EVENTS.OPTIONS_CHANGED,function(data){data.key===ROOM_SETTINGS.CAN_CLOSE_TASKS&&$scope.$apply(function(){$scope.isResolveButton=data.val})}),UsabilityTestService.fetch().then(function(data){$scope.params={tasks:formatTasks(angular.copy(data.meta.tasks))}}),$scope.onClickResolveTask=function($event,task){$event.preventDefault(),UsabilityTestService.resolveTask(task.id)},UsabilityTestService.isHostSession()&&UsabilityTestService.startSession(LiveShare.enums.USER_TYPES.HOST)}]),angular.module("core").controller("UsabilityTestWizardController",["$q","_","$scope","$rootScope","$state","$timeout","$translate","$stateParams","UsabilityTestService","PagesService","ProjectsService","BreakpointsService","UsersService","animate",function($q,_,$scope,$rootScope,$state,$timeout,$translate,$stateParams,UsabilityTestService,PagesService,ProjectsService,BreakpointsService,UsersService,animate){"use strict";var newTaskTitleInput;$scope.forms={},$scope.params={loading:!1,projectName:ProjectsService.currentProjectName,activeStepIndex:0,steps:[{breadcrumbs:!0,label:"Introduction",introduction:""},{breadcrumbs:!0,label:"Tasks",tasks:[],newTask:{title:"",content:""},onStart:function(){setFocusToNewTaskTitle()}},{breadcrumbs:!0,label:"Settings",options:[],breakpoints:{name:"Display selected breakpoints",enabled:!1,list:PagesService.getCurrentPageBreakpoints().map(function(breakpoint){return breakpoint.value=0,breakpoint})}},{breadcrumbs:!0,label:"Participant",inviteURL:"",onStart:function(){var step=$scope.getStep(3);step.inviteURL||UsabilityTestService.makeRoomReservation().then(function(){step.inviteURL=UsabilityTestService.getInviteURL()})}},{breadcrumbs:!1,label:"Finish"}]},$translate("UT_INTRODUCTION_TEXT").then(function(UT_INTRODUCTION_TEXT){$scope.params.steps[0].introduction=UT_INTRODUCTION_TEXT}),UsabilityTestService.getConfigurationOptions().then(function(options){$scope.getStep(2).options=options}.bind(this)),$scope.getStepsWithBreadcrumbs=function(){return _.filter($scope.params.steps,"breadcrumbs")},$scope.getStep=function(index){var value;if(value="next"===index?$scope.params.steps[$scope.params.activeStepIndex+1]:"prev"===index?$scope.params.steps[$scope.params.activeStepIndex-1]:"undefined"!=typeof index?$scope.params.steps[index]:$scope.params.steps[$scope.params.activeStepIndex],!value)throw new RangeError('"'+index+'" is out of range');return value},$scope.getStepFormObject=function(index){return"undefined"==typeof index?$scope.forms["step"+$scope.params.activeStepIndex]:$scope.forms["step"+index]},$scope.isActiveStep=function(stepIndex){if("undefined"==typeof stepIndex)throw new TypeError("stepIndex argument is required.");return $scope.params.activeStepIndex===stepIndex},$scope.onClickNextStep=function(){var breakpoints=$scope.getStep().breakpoints;breakpoints&&breakpoints.enabled&&breakpoints.list&&checkIfCurrentBreakpointIsLocked(breakpoints.list,PagesService.currentBreakpointId)&&PagesService.setCurrentBreakpointId(getFirstUnlockedBreakpointId(breakpoints.list)),goToStep($scope.params.activeStepIndex+2)},$scope.onClickPrevStep=function(){goToStep($scope.params.activeStepIndex)},$scope.onClickAddNewTask=function(model){$scope.getStep(1).tasks.push(angular.copy(model)),model.title="",model.content="",scrollTaskListToBottom(),setFocusToNewTaskTitle()},$scope.onClickDeleteTask=function($event,$index){var DELETING_ANIMATION_DURATION=300,step=$scope.getStep(1);$event.preventDefault(),"number"==typeof $index?(step.tasks[$index].deleting=!0,$timeout(function(){step.tasks.splice($index,1)},DELETING_ANIMATION_DURATION)):step.tasks.length?($index=step.tasks.length-1,step.tasks[$index].deleting=!0,step.newTask.title=step.tasks[$index].title,step.newTask.content=step.tasks[$index].content,$timeout(function(){step.tasks.splice($index,1)},DELETING_ANIMATION_DURATION)):(step.newTask.title="",step.newTask.content="")};var scrollTaskListToBottom=function(){var contentWrapper=document.querySelector("#wizard-content"),ANIM_DURATION=(contentWrapper.scrollTop,contentWrapper.scrollHeight,1);animate(contentWrapper,ANIM_DURATION,{scrollTop:contentWrapper.scrollHeight-contentWrapper.scrollTop+contentWrapper.scrollTop})},setFocusToNewTaskTitle=function(){newTaskTitleInput||(newTaskTitleInput=document.getElementById("new-task-title")),newTaskTitleInput.focus()};$scope.onClickInput=function($event){$event.target.select()},$scope.onClickCopy=function($event){var COPY_MESSAGE_HIDE_DELAY=1e3;$event.preventDefault(),$scope.params.isCopied=!0,$timeout(function(){$scope.params.isCopied=!1},COPY_MESSAGE_HIDE_DELAY)};var getConfigurationOptions=function(){var options=[];return $scope.getStep(2).options.forEach(function(option){option.value&&options.push(option.param)}),options.join(",")};$scope.onClickSessionStart=function(){UsabilityTestService.startInitializing({testData:getStepsData(),options:getConfigurationOptions()})},$scope.$on("destroy",function(){onStateChangeSuccess()});var checkIfCurrentBreakpointIsLocked=function(breakpoints,breakpointId){var locked=!1;return _.forEach(breakpoints,function(breakpoint){return breakpoint.id!==breakpointId||breakpoint.value?void 0:(locked=!0,!1)}),locked},getFirstUnlockedBreakpointId=function(breakpoints){var breakpointId=null;return _.forEach(breakpoints,function(breakpoint){return breakpoint.value?(breakpointId=breakpoint.id,!1):void 0}),breakpointId},goToStep=function(stepNumber){$scope.params.activeStepIndex!==stepNumber-1&&$state.go("home.page.usability-test",_.extend($stateParams,{step:stepNumber,pageId:PagesService.getPageByBreakpoint($stateParams.pageId)}))},onStateChangeSuccess=$rootScope.$on("$stateChangeSuccess",function(e,toState,toParams){if($state.includes("**.usability-test.**")){var currentStepIndex=parseInt(toParams.step,10)-1;if(!isNaN(currentStepIndex)){$scope.params.activeStepIndex=currentStepIndex||0;var step=$scope.getStep();"function"==typeof step.onStart&&$timeout(step.onStart,100)}}}),getStepsData=function(){return{meta:{introduction:angular.copy($scope.getStep(0).introduction),tasks:function(){var step=$scope.getStep(1),tasks=angular.copy(step.tasks);return step.newTask.title.trim()&&step.newTask.content.trim()&&tasks.push(angular.copy(step.newTask)),tasks.map(function(task,index){return task.id=index+1,task})}()},user:{id:UsersService.me.id_user,is_trial:UsersService.me.is_trial},settings:function(){var options=[];return $scope.getStep(2).options.forEach(function(option){option.value&&options.push({param:option.param})}),options}(),project:{hash:ProjectsService.currentProjectHash,available_breakpoints:function(){var breakpoints=$scope.getStep(2).breakpoints;if(breakpoints.enabled&&breakpoints.list){var available=[];return breakpoints.list.forEach(function(breakpoint){breakpoint.value&&available.push({id:breakpoint.id})}),available}return null}()}}}}]),angular.module("core").directive("previewCloud",function($document){"use strict";var ACTIVE_CLASS="cloud-active",PreviewCloud=function($scope,$element){this.$scope=$scope,this.$element=$element,this.eventRefs={}};return PreviewCloud.prototype.start=function(){angular.element(this.$element[0].querySelector("[preview-cloud-trigger]")).on("click",this.onClickToggle.bind(this)),this.$scope.$watch("previewCloud",function(value){value?this.open():this.close()}.bind(this))},PreviewCloud.prototype.open=function(){this.$element[0].classList.add(ACTIVE_CLASS),this.attachEvents()},PreviewCloud.prototype.close=function(){this.$element[0].classList.remove(ACTIVE_CLASS),this.detachEvents()},PreviewCloud.prototype.clickOnDocument=function(e){e.target===this.$element[0]||this.$element[0].contains(e.target)||this.toggle(!1)},PreviewCloud.prototype.keyDown=function(e){27===e.keyCode&&this.toggle(!1)},PreviewCloud.prototype.attachEvents=function(){this.eventRefs.clickOnDocument=this.clickOnDocument.bind(this),this.eventRefs.keyDown=this.keyDown.bind(this),$document.on("click",this.eventRefs.clickOnDocument),$document.on("keydown",this.eventRefs.keyDown)},PreviewCloud.prototype.detachEvents=function(){$document.off("click",this.eventRefs.clickOnDocument),$document.off("keydown",this.eventRefs.keyDown)},PreviewCloud.prototype.onClickToggle=function(){this.toggle()},PreviewCloud.prototype.toggle=function(isOpen){var value=!this.$scope.previewCloud;"undefined"!=typeof isOpen&&(value=!!isOpen),this.$scope.$apply(function(){this.$scope.previewCloud=value}.bind(this))},{restrict:"A",scope:{previewCloud:"=?"},link:function(scope,element){var previewCloud=new PreviewCloud(scope,element);previewCloud.start()}}}),angular.module("core").directive("addComment",[function(){"use strict";var isChildOf=function(childElement,parentClass){for(;childElement.parentNode&&"#document"!==childElement.parentNode.nodeName;){if(childElement.parentNode.classList&&childElement.parentNode.classList.contains(parentClass))return!0;childElement=childElement.parentNode}return!1};return{restrict:"A",scope:!1,link:function(scope,element){var isValidCommentLocation=function(e){return!isChildOf(e.target,PreviewEnums.COMMENT_POINT_CLASS)};element.on("click",function(e){scope.commentMode&&isValidCommentLocation(e)&&(scope.onAddCommentClick(e),e.stopPropagation())})}}}]),angular.module("core").directive("adjustToViewportSize",function($timeout,$rootScope,$window,animate,LayoutStates){"use strict";return{restrict:"A",scope:{},link:function(scope,element,attrs){var ANIM_EASE="easeInOutPower2",ANIM_TIME=.3,NO_TIME=0,PANEL_WIDTH=326,SIDEBAR_WIDTH=100,rawElement=element[0],isPanelVisible=LayoutStates.isPanelVisible(),isToolbarVisible=LayoutStates.isToolbarVisible(),isNoToolbarMode=LayoutStates.isNoToolbarMode(),isUsabilityTestRunning=LayoutStates.getStateById("isUserTestingSession"),isLiveShareSession=LayoutStates.getStateById("isLiveShareSession"),isHostSession=LayoutStates.getStateById("isHostSession"),adjustWidth=function(instant){
var width,time=instant===!0?NO_TIME:ANIM_TIME,browserWidth=$window.innerWidth;isNoToolbarMode?width=browserWidth:isUsabilityTestRunning&&isHostSession?width=browserWidth-SIDEBAR_WIDTH-PANEL_WIDTH:isUsabilityTestRunning&&!isHostSession?width=browserWidth-PANEL_WIDTH:!isToolbarVisible&&isPanelVisible?width=browserWidth:isToolbarVisible||isPanelVisible?isToolbarVisible&&isPanelVisible?width=browserWidth-SIDEBAR_WIDTH-PANEL_WIDTH:isToolbarVisible&&!isPanelVisible&&(width=browserWidth-SIDEBAR_WIDTH):width=browserWidth,animate(rawElement,time,{ease:ANIM_EASE,width:width})};adjustWidth(!0),angular.element($window).bind("resize",function(){adjustWidth(!0),scope.$digest()}),scope.$watch(function(){return LayoutStates.isPanelVisible()+LayoutStates.isToolbarVisible()+LayoutStates.isNoToolbarMode()+LayoutStates.getStateById("isLiveShareSession")+LayoutStates.getStateById("isUserTestingSession")+LayoutStates.getStateById("isHostSession")},function(newVal,oldVal){newVal!==oldVal&&(isPanelVisible=LayoutStates.isPanelVisible(),isToolbarVisible=LayoutStates.isToolbarVisible(),isNoToolbarMode=LayoutStates.isNoToolbarMode(),isUsabilityTestRunning=LayoutStates.getStateById("isUserTestingSession"),isHostSession=LayoutStates.getStateById("isHostSession"),isLiveShareSession=LayoutStates.getStateById("isLiveShareSession"),adjustWidth())})}}}),angular.module("core").directive("onKeydown",function(){"use strict";return{restrict:"A",link:function(scope,elem,attrs){var functionToCall=scope.$eval(attrs.onKeydown);elem.on("keydown",function(e){functionToCall(e.which)})}}}),angular.module("core").directive("captureVideo",["$rootScope","$timeout",function($rootScope,$timeout){"use strict";navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var link=function($scope,$element,attrs){var localMediaStream,video=$element[0];attrs.width&&($element.width=attrs.width),attrs.height&&($element.height=attrs.height),$element.on("$destroy",function(){localMediaStream&&(localMediaStream.stop(),video.src="")}),navigator.getUserMedia&&navigator.getUserMedia({video:!0,audio:!0},function(stream){localMediaStream=stream,video.src=window.URL.createObjectURL(stream),$rootScope.$emit(PreviewEnums.MEDIA_ACCESS,PreviewEnums.MEDIA_ACCESS_TYPE.ALLOWED)},function(err){window.console.error(err.stack),$rootScope.$emit(PreviewEnums.MEDIA_ACCESS,PreviewEnums.MEDIA_ACCESS_TYPE.DENIED)})};return{restrict:"E",replace:!0,template:"<video autoplay></video>",link:link}}]),angular.module("core").directive("clickOutside",["$compile","$document",function($compile,$document){"use strict";var ClickOutside=function(scope,element){this._scope=scope,this._element=element,this._eventsRef={},this.attachEvents()};ClickOutside.prototype.attachEvents=function(){this._eventsRef.onClick=this.clickOutside.bind(this),document.addEventListener("click",this._eventsRef.onClick),this._element.on("$destroy",function(){this.detachEvents()}.bind(this))},ClickOutside.prototype.detachEvents=function(){document.removeEventListener("click",this._eventsRef.onClick)},ClickOutside.prototype.clickOutside=function(e){e.target===this._element[0]||this._element[0].contains(e.target)||this._scope.callback()};var link=function(scope,element,attrs){new ClickOutside(scope,element)};return{restrict:"A",scope:{callback:"&"},link:link}}]),angular.module("core").directive("compile",["$compile",function($compile){"use strict";var link=function(scope,element,attrs){scope.$watch("content",function(value){element.html(value),$compile(element.contents())(scope)})};return{restrict:"A",scope:{content:"="},link:link}}]),angular.module("core").directive("highlight",["$compile",function($compile){"use strict";var comparatorSearch=function(search,comment){return comment&&search?-1!==comment.toLocaleLowerCase().indexOf(search.toLocaleLowerCase()):!1},highlight=function(search,comment){return"string"==typeof comment&&(comment=comment.replace(/&#10;/g,"<br>").replace(/\n/g,"<br>")),comparatorSearch(search,comment)?comment.replace(new RegExp(search,"gi"),function(match){return'<span class="highlight">'+match+"</span>"}):comment},link=function(scope,element,attrs){scope.$watch("inputText",function(value){element.html(highlight(scope.searchFor,value)),$compile(element.contents())(scope)}),scope.$watch("searchFor",function(value){element.html(highlight(value,scope.inputText)),$compile(element.contents())(scope)})};return{restrict:"A",scope:{inputText:"=",searchFor:"="},link:link}}]),angular.module("core").directive("parseMentions",["$rootScope","UsersService","ValidationHelper",function($rootScope,UsersService,ValidationHelper){"use strict";var newMentionPattern=/(\W|^)@([\w]+)/gim,getUniqueId=function(){return _.uniqueId("mention-")},saveSelction=function(containerEl){var range=window.getSelection().getRangeAt(0),preSelectionRange=range.cloneRange();preSelectionRange.selectNodeContents(containerEl),preSelectionRange.setEnd(range.startContainer,range.startOffset);var start=preSelectionRange.toString().length;return{start:start,end:start+range.toString().length}},modifyRangeByOffset=function(range,offset){return offset=_.defaults(offset||{},{start:0,end:0}),0!==offset.start&&range.setStart(range.startContainer,range.startOffset+offset.start),0!==offset.end&&range.setStart(range.endContainer,range.endOffset+offset.end),range},restoreSelection=function(containerEl,savedSel,offset){var charIndex=0,range=document.createRange();range.setStart(containerEl,0),range.collapse(!0);for(var node,nodeStack=[containerEl],foundStart=!1,stop=!1;!stop&&(node=nodeStack.pop());)if(3===node.nodeType){var nextCharIndex=charIndex+node.length;!foundStart&&savedSel.start>=charIndex&&savedSel.start<=nextCharIndex&&(range.setStart(node,savedSel.start-charIndex),foundStart=!0),foundStart&&savedSel.end>=charIndex&&savedSel.end<=nextCharIndex&&(range.setEnd(node,savedSel.end-charIndex),stop=!0),charIndex=nextCharIndex}else for(var i=node.childNodes.length;i--;)nodeStack.push(node.childNodes[i]);range=modifyRangeByOffset(range,offset);var sel=window.getSelection();sel.removeAllRanges(),sel.addRange(range)},placeCaretAfterNode=function(node,position){if(position="undefined"==typeof position?1:position,"undefined"!=typeof window.getSelection){var range=document.createRange();range.setStart(node,position),range.setEnd(node,position),range.collapse(!0);var selection=window.getSelection();selection.removeAllRanges(),selection.addRange(range)}},getCaretPosition=function(element){var sel,caretOffset=0,doc=element.ownerDocument||element.document,win=doc.defaultView||doc.parentWindow;if("undefined"!=typeof win.getSelection){if(sel=win.getSelection(),sel.rangeCount>0){var range=win.getSelection().getRangeAt(0),preCaretRange=range.cloneRange();preCaretRange.selectNodeContents(element),preCaretRange.setEnd(range.endContainer,range.endOffset),caretOffset=preCaretRange.toString().length}}else if((sel=doc.selection)&&"Control"!==sel.type){var textRange=sel.createRange(),preCaretTextRange=doc.body.createTextRange();preCaretTextRange.moveToElementText(element),preCaretTextRange.setEndPoint("EndToEnd",textRange),caretOffset=preCaretTextRange.text.length}return caretOffset},parseElements=function(scope,html,id){return html.replace(newMentionPattern,parseElement.bind(null,id))},parseElement=function(id,match,part1,part2,offset,str){return part1+'<span id="'+id+'" class="mention-person">'+part2+"</span>&nbsp;"},isNewMention=function(html){return newMentionPattern.test(html)},getCloudOffset=function(element){var MARGIN_TOP=26;return{top:element.offsetTop+MARGIN_TOP+"px",left:element.offsetLeft+Math.round(element.offsetWidth/2)+"px"}},parseAllNodes=function(nodes){var text="";return _.forEach(nodes,function(node){text+=parseNode(node)}),text},parseNode=function(node){return"#text"===node.nodeName?parseTextNode(node):"INPUT"===node.nodeName?parseMentionNode(node):"BR"===node.nodeName?"\n":"DIV"===node.nodeName?"\n"+parseAllNodes(node.childNodes):""},parseTextNode=function(node){return-1===["<br/>","&nbsp;"].indexOf(node.nodeValue)?node.nodeValue:""},parseMentionNode=function(node){var text=node.value,email=node.getAttribute("data-email");return ValidationHelper.isEmail(email)&&(text="["+text+"](mailto:"+email+")"),text},clearContenteditableStyles=function(element){var savedSelection=saveSelction(element);element.innerHTML=element.innerHTML+"",restoreSelection(element,savedSelection)},createUneditableMentionElement=function(name,email){var mentionElement=document.createElement("input");return mentionElement.type="button",mentionElement.setAttribute("disabled","disabled"),mentionElement.value=name,mentionElement.setAttribute("data-email",email),mentionElement.classList.add("mention-person"),mentionElement};return{restrict:"A",scope:{focusValue:"=mySyncFocusWith",commentText:"=",commentId:"=",mentions:"="},link:function($scope,$element,attrs){var caretNode,caretNodePosition,setCaretPosition=function(){caretNode=document.getSelection().anchorNode,caretNodePosition=getCaretPosition(caretNode)},observer=new MutationObserver(function(mutations){mutations.forEach(function(mutation){1===mutation.removedNodes.length&&"SPAN"===mutation.removedNodes[0].nodeName&&(onRemoveMention(mutation.removedNodes[0]),clearContenteditableStyles($element[0]))})});observer.observe($element[0],{childList:!0});var onRemoveMention=function(element){var mention=$scope.mentions[element.id];mention&&delete $scope.mentions[element.id]},addMention=function(html){var element,id=getUniqueId();$element.html(parseElements($scope,html,id)),element=$element[0].querySelector("#"+id),placeCaretAfterNode(element),$scope.mentions[id]={editable:!0,element:element,email:null},$rootScope.$emit(PreviewEnums.ON_SHOW_MENTIONS_LIST,$scope.commentId,getCloudOffset(element))},getEditableElement=function(){return _.first(_.filter($scope.mentions,{editable:!0}))},isCarretIsideElement=function(element){if(window.getSelection){var caretContainer,range,selection=window.getSelection();return selection.rangeCount>0?(range=selection.getRangeAt(0),caretContainer=range.commonAncestorContainer,caretContainer&&(caretContainer=3===caretContainer.nodeType?caretContainer.parentNode:caretContainer),element===caretContainer):!1}},updateCommentText=function(){$scope.commentText=parseAllNodes($element[0].childNodes)},removeMentionDOMelement=function(element){element.parentNode&&element.parentNode.removeChild(element)},clearMentionsFromScope=function(){var mention=getEditableElement();mention&&delete $scope.mentions[mention.element.id],$rootScope.$emit(PreviewEnums.ON_HIDE_MENTIONS_LIST,$scope.commentId)},updateMention=function(element){return element.textContent.trim().length?isCarretIsideElement(element)?($rootScope.$emit(PreviewEnums.ON_UPDATE_MENTIONS_LIST_POSITION,$scope.commentId,getCloudOffset(element)),void $rootScope.$emit(PreviewEnums.SEARCH_MENTIONS_LIST,$scope.commentId,element.innerHTML)):void $rootScope.$emit(PreviewEnums.ON_HIDE_MENTIONS_LIST,$scope.commentId):(removeMentionDOMelement(element),void clearMentionsFromScope())},update=function(){var element,html=$element.html();isNewMention(html)?addMention(html):(element=$element[0].querySelector("span.mention-person"),element?updateMention(element):clearMentionsFromScope()),updateCommentText()};$rootScope.$on(PreviewEnums.ON_HIDE_MENTIONS_LIST,function(e,id){if(id===$scope.commentId){var mention=getEditableElement();if(mention){var selection=saveSelction($element[0]);mention.element.textContent.length&&$element[0].replaceChild(document.createTextNode(mention.element.innerHTML.replace(/&nbsp;/g," ")+" "),mention.element),delete $scope.mentions[mention.element.id],$element.html($element.html()+""),restoreSelection($element[0],selection,{start:1})}updateCommentText()}}),$rootScope.$on(PreviewEnums.ON_SELECT_MENTIONS_LIST,function(e,id,collaborator){if(id===$scope.commentId){var mention=getEditableElement();if(mention){mention.editable=!1,mention.email=collaborator.email;var newMentionElement=createUneditableMentionElement(collaborator.name,collaborator.email);mention.element.parentNode.replaceChild(newMentionElement,mention.element),mention.element=newMentionElement;var index=_.indexOf($element[0].childNodes,mention.element);placeCaretAfterNode(_.size($element[0].childNodes)>index+1?$element[0].childNodes[index+1]:mention.element)}updateCommentText()}});$scope.$on("$destroy",function(){observer.disconnect()}),$scope.$watch("commentText",function(currentValue,previousValue){""===currentValue&&$element.html("")}),$scope.$watch("focusValue",function(currentValue,previousValue){currentValue!==!0||previousValue?currentValue===!1&&previousValue&&$element[0].blur():$element[0].focus()}),$element.bind("click keyup input change",function(){$scope.$apply(update),setCaretPosition()}),$element.bind("focus",function(){caretNode&&$element[0].contains(caretNode)&&placeCaretAfterNode(caretNode,caretNodePosition)});var pasteUnformattedText=function(e){return e.preventDefault(),e.stopImmediatePropagation(),document.execCommand("insertText",!1,e.clipboardData.getData("text/plain")),$scope.$apply(update),!1};$element.bind("paste",pasteUnformattedText)}}}]),angular.module("core").directive("script",[function(){"use strict";var link=function(scope,element,attrs){if("text/javascript"===attrs.type&&"1"===attrs.evaluate){var code=element.text(),re=/(window.location.href)(\s*=\s*)([\w]+((\.)?[\w]+)*)/gim,subst="Preview.gotoPage($3)",codeParsed=code.replace(re,subst),f=new Function(codeParsed);f()}};return{restrict:"E",scope:!1,link:link}}]),angular.module("core").directive("syncFocusWith",function($timeout,$rootScope){"use strict";return{restrict:"A",scope:{focusValue:"=syncFocusWith"},link:function($scope,$element,attrs){$scope.$watch("focusValue",function(currentValue,previousValue){currentValue!==!0||previousValue?currentValue===!1&&previousValue&&$element[0].blur():$element[0].focus()})}}}),angular.module("core").directive("timeCounter",["moment",function(moment){"use strict";function startCounting(from){interval=setInterval(function(){var diff=moment(new Date).diff(moment(startTime));element.textContent=moment(diff).format("mm:ss")},1e3)}function stopCounting(){clearInterval(interval)}var startTime,element,interval,link=function($scope,$element,attrs){if(element=$element[0],attrs["class"]&&(element.className=attrs["class"]),!attrs.startTime)throw new Error("start-time attribute is required");startTime=attrs.startTime,startCounting(),$element.on("$destroy",function(){stopCounting()})};return{restrict:"E",replace:!0,template:"<time></time>",link:link}}]),angular.module("core").directive("toggleVisibility",function($timeout,$rootScope,animate,Engine){"use strict";return{restrict:"A",scope:{toggleFlag:"=",toggleWidthOpen:"@",toggleWidthClosed:"@"},link:function(scope,element,attrs){var ANIM_EASE="easeInOutPower2",ANIM_TIME=.3,rawElement=element[0],toggle=function(){scope.toggleFlag?animate(rawElement,ANIM_TIME,{ease:ANIM_EASE,width:parseInt(scope.toggleWidthOpen),onComplete:function(){rawElement.style.overflow="visible",Engine.updateOffset()},onUpdate:function(){Engine.updateOffset()}}):(rawElement.style.overflow="hidden",animate(rawElement,ANIM_TIME,{ease:ANIM_EASE,width:parseInt(scope.toggleWidthClosed),onComplete:function(){Engine.updateOffset()},onUpdate:function(){Engine.updateOffset()}}))};scope.$watch("toggleFlag",function(newVal,oldVal){newVal!==oldVal&&toggle()})}}}),angular.module("core").directive("toggleable",["$document",function($document){"use strict";var opened=[],Toggleable=function(scope,element){this._scope=scope,this._element=element,this.applyVisibility()};Toggleable.prototype.isOpen=function(){return this._scope.isOpen()},Toggleable.prototype.toggle=function(e){this._scope.toggle(e),this.applyVisibility()},Toggleable.prototype.hide=function(e){this._scope.hide(e),this.applyVisibility()},Toggleable.prototype.getElement=function(){return"string"==typeof this._scope.toggleElement?document.querySelector(this._scope.toggleElement):"function"==typeof this._scope.toggleElement?this._scope.toggleElement():this._element[0]},Toggleable.prototype.getPreventHideElements=function(){var elements=[];return"function"==typeof this._scope.getPreventHideElements&&(elements=this._scope.getPreventHideElements()),elements},Toggleable.prototype.applyVisibility=function(){var index=opened.indexOf(this);this.isOpen()&&-1===index?opened.push(this):!this.isOpen()&&index>-1&&opened.splice(index,1)},document.addEventListener("click",function(e){var toggleable,element,preventHideElements,i,notContainsTarget=function(el){return el!==e.target&&!el.contains(e.target)};for(i=opened.length-1;i>=0;i--)if(toggleable=opened[i],element=toggleable.getElement(),preventHideElements=toggleable.getPreventHideElements(),toggleable.isOpen()&&toggleable._element[0]!==e.target&&"undefined"!=typeof element&&element!==e.target&&!element.contains(e.target)&&preventHideElements.every(notContainsTarget)){toggleable.hide(e),e.stopPropagation();break}},!0);var link=function(scope,element){var el=new Toggleable(scope,element);element.on("click",function(e){el.toggle(e)})};return{restrict:"A",link:link}}]),function(global){"use strict";var PreviewEnums=function(){return{PIN_RADIUS:14,COMMENT_FORM_DELTA_X:40,COMMENT_FORM_DELTA_Y:-5,ADD_COMMENT:"addComment",COMMENT_POINT_CLASS:"comment-point",ADDING_COMMENT:"addingComment",SELECT_COMMENT:"selectComment",RESOLVE_COMMENT:"resolveComment",DELETING_COMMENT:"deletingComment",DELETE_COMMENT:"deleteComment",REPLYING_COMMENT:"replyingComment",DRAGGING_COMMENT:"draggingComment",SORT_COMMENTS:"sortComments",LOADING_COMMENTS:"loadingComments",OPEN_GROUP:"openGroup",ON_CHANGE_PAGE:"onChangePage",NAVIGATE_HISTORY_BACK:"navigateHistoryBack",NAVIGATE_TO_PAGE:"navigateToPage",ON_CONTENT_LOADED:"onContentLoaded",ON_SHOW_COMMENTS_SETTINGS_CHANGED:"onShowCommentsSettingsChanged",ON_SHOW_COMMENTS_RESOLVED_SETTINGS_CHANGED:"onShowCommentsResolvedSettingsChanged",ON_MODE_CHANGED:"onModeChanged",LOADING:"loading",MEDIA_ACCESS:"mediaAccess",SET_ANONYMOUS_NAME:"setAnonymousName",ANONYMOUS_ADD_COMMENT:"anonymousAddComment",ON_CHANGE_NOTIFICATIONS:"onChangeNotifications",ON_SHOW_MENTIONS_LIST:"onShowMentionsList",SELECT_MENTIONS_LIST:"selectMentionsList",SEARCH_MENTIONS_LIST:"searchMentionsList",ON_SELECT_MENTIONS_LIST:"onSelectMentionsList",ON_HIDE_MENTIONS_LIST:"onHideMentionsList",ON_UPDATE_MENTIONS_LIST_POSITION:"onUpdateMentionsListPosition",ON_APP_VIEW_PROMO_CLOSE:"appViewPromoClose",APP_VIEW_PROMO_VIEWED:"appViewPromoViewed",COMMENT_NOTIFY_ALL:2,COMMENT_NOTIFY_NONE:0,COMMENT_NOTIFY_CHOSEN:1,MEDIA_ACCESS_TYPE:{REQUEST:"request",ALLOWED:"allowed",DENIED:"denied"},SOCKET:{ON_CHANGE_PROPERTIES:"changeProperties",ON_DELETE_COMPONENT:"deleteComponent",ON_PAGE_CREATE:"addNewPage",ON_PAGE_UPDATE:"updatePage",ON_PAGE_DELETE:"deletePage",ON_PAGE_REORDER:"savePagesOrder",ON_COMMENT_CREATE:"createComment",ON_COMMENT_UPDATE:"updateComment",ON_COMMENT_DELETE:"deleteComment"}}}();global.PreviewEnums=PreviewEnums}(window),angular.module("core").filter("hexToRgba",function(){"use strict";return function(hex,alpha){if(!/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(hex))return window.console.error("Invalid hex color "+hex),hex;var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,newHex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b}),result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(newHex);if(result){var rgba=[parseInt(result[1],16),parseInt(result[2],16),parseInt(result[3],16),alpha];return"rgba("+rgba.join(",")+")"}return window.console.error("Cannot parse hex "+hex+" to rgb"),hex}}),angular.module("core").filter("moment",function(){"use strict";return function(dateString,format){return moment(dateString).format(format)}}),angular.module("core").filter("momentFromNow",function(){"use strict";return function(dateString){return moment(dateString).fromNow()}}),angular.module("core").filter("newLine",function(){"use strict";return function(text){return text.replace(/\n/g,"<br/>")}}),angular.module("core").filter("simpleMarkdown",function(){"use strict";function parseEmail(text){var pattern=/\[(.*?)\]\(mailto:(.*?)\)/g;return text.replace(pattern,'<a class="md-email" href="mailto:$2">$1</a>')}return function(text){return parseEmail(text)}}),angular.module("core").factory("CommentsHelper",[function(){"use strict";return{getDiscussionRootCommentId:function(comment){return comment._parent_comment?comment._parent_comment:comment._id},stripText:function(text){return text.replace(/(<([^>]+)>)/gi,"")},encodeMentions:function(text){var pattern=/\[(.*?)\]\(mailto:(.*?)\)/g,matches=text.match(pattern);if(matches){matches.forEach(function(string){text=text.replace(string,encodeURIComponent(string))})}return text},decodeMentions:function(text){var pattern=/%5B(.*?)%5D\(mailto%3A(.*?)\)/g,matches=text.match(pattern);if(matches){matches.forEach(function(string){text=text.replace(string,decodeURIComponent(string))})}return text}}}]),angular.module("core").factory("deviceDetectorHelper",["_","localStorageService",function(_,localStorageService){"use strict";var ua=new UAParser(navigator.userAgent);return _.extend(ua,{isAppViewAvailable:function(){var uaData=this.getResult();return"iOS"===uaData.os.name&&"Mobile Safari"===uaData.browser.name?!window.navigator.standalone&&!localStorageService.get(PreviewEnums.APP_VIEW_PROMO_VIEWED):"Android"===uaData.os.name&&"Chrome"===uaData.browser.name?!localStorageService.get(PreviewEnums.APP_VIEW_PROMO_VIEWED):!1}})}]),angular.module("core").factory("NotificationsHelper",["$cookies",function($cookies){"use strict";var getArrayForMap=function(map){var arr=[];return _.forEach(map,function(value,key){value&&arr.push(key)}),arr},notifySelectionCookieName="notifyselection";return{getNotificationsForComment:function(commentId,collaboratorsMap,collaboratorEmails,notifications){var arr=[],map={},notification=notifications[commentId];return _.forEach(collaboratorsMap,function(collaborator){arr.push({name:collaborator.name,email:collaborator.email,id:collaborator.id_user}),map[collaborator.email]=!0}),notification&&_.forEach(notification.emails,function(email){map[email.email]||(arr.push(this.getNotificationObjectForEmail(email.email)),map[email.email]=!0)}.bind(this)),_.forEach(this.getGuestEmails(collaboratorEmails,notifications),function(email){email&&!map[email]&&(arr.push(this.getNotificationObjectForEmail(email)),map[email]=!0)}.bind(this)),arr.sort(function(a,b){var a_name=(a.name||a.email).toLowerCase(),b_name=(b.name||b.email).toLowerCase();return b_name>a_name?-1:a_name>b_name?1:0})},getNotificationObjectForEmail:function(email){return{name:email.split("@")[0],email:email,id:MD5(email)}},getSelectedMapForComment:function(commentId,collaboratorsMap,notifications){var previousSelection,map={},isNew=!commentId,notification=notifications[commentId],isEmpty=!isNew&&!notification;return isNew||isEmpty?(previousSelection=this.remindSelection(),previousSelection?map=previousSelection:_.forEach(collaboratorsMap,function(collaborator){map[collaborator.email]=!0})):notification&&_.forEach(notification.emails,function(email){map[email.email]=!0}),map},getNumberOfSelectedNotifications:function(notifications){return _.filter(notifications,function(notification){return notification}).length},getAddedNotifications:function(old,updated){var o=getArrayForMap(old),u=getArrayForMap(updated);return _.difference(_.union(o,u),o)},getRemovedNotifications:function(old,updated){var o=getArrayForMap(old),u=getArrayForMap(updated);return _.difference(_.union(o,u),u)},getGuestEmails:function(collaboratorEmails,notifications){var emails=[];return _.forEach(notifications,function(notification){_.forEach(notification.emails,function(email){-1===collaboratorEmails.indexOf(email.email)&&emails.push(email.email)})}),emails},formatNotify:function(notifications,mentions){var map={};return _.forEach(notifications,function(notification){map[notification]={email:notification,is_mention:0}}),_.forEach(mentions,function(mention){mention.email&&(map[mention.email]?map[mention.email].is_mention=1:map[mention.email]={email:mention.email,is_mention:1})}),_.toArray(map)},rememberSelection:function(selection){$cookies[notifySelectionCookieName]=JSON.stringify(selection)},remindSelection:function(){var cookie=$cookies[notifySelectionCookieName];return cookie&&(cookie=JSON.parse(cookie)),cookie}}}]),angular.module("core").factory("ValidationHelper",[function(){"use strict";return{isEmail:function(email){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email)}}}]),angular.module("core").factory("ChromeExtensionService",[function(){"use strict";function checkInstallation(){"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.sendMessage(window.ApplicationConfiguration.extension.id,window.ApplicationConfiguration,function(response){response&&(window.ApplicationConfiguration.extension.isInstalled=!0,connect())})}function connect(){"undefined"!=typeof chrome&&chrome.runtime&&(port=chrome.runtime.connect(window.ApplicationConfiguration.extension.id)),port&&(port.postMessage(window.ApplicationConfiguration),port.onMessage.addListener(onMessage),isConnected=!0,port.onDisconnect.addListener(function(){isConnected=!1,setTimeout(connect,1e3)}))}function onMessage(data){nsp.log("Chrome extension message",data),listeners.forEach(function(cb){nsp.count("Fired chrome extension callback"),cb(data)})}var port,isConnected=!1,listeners=[],nsp=window.CHROME_EXTENSION;return connect(),{onMessage:function(callback){if(!isConnected)throw new Error("Chrome extension is disconnected");nsp.count("ChromeExtension add listener"),listeners.push(callback)},postMessage:function(message){if(!isConnected)throw new Error("Chrome extension is disconnected");port.postMessage(message)},isConnected:function(){return isConnected},isInstalled:function(){return window.ApplicationConfiguration.extension.isInstalled},recheckInstallation:function(){this.isInstalled()||checkInstallation()}}}]),angular.module("core").factory("LiveSessionInstanceService",[function(){"use strict";var instance=null;return{set:function(newInstance){instance=newInstance},get:function(){return instance}}}]),angular.module("core").factory("LocalDataService",["$window","$document","$q",function($window,$document,$q){"use strict";return{getData:function(file){var d=$q.defer(),scr=document.createElement("script");return scr.setAttribute("src",file),scr.setAttribute("type","text/javascript"),scr.addEventListener("load",function(){d.resolve($window.DATA),delete $window.DATA,$document[0].body.removeChild(scr)}),$document[0].body.appendChild(scr),d.promise}}}]),angular.module("core").factory("AnalyticsService",["$analytics",function($analytics){"use strict";var pageSwitchTimers={},designLoadTimer=null;return{startPageSwitchTrack:function(id){pageSwitchTimers[id]=+new Date},finishPageSwitchTrack:function(id){var time;pageSwitchTimers[id]&&(time=+new Date-pageSwitchTimers[id],pageSwitchTimers[id]=null,this.event("Page switch",{category:"Navigation",label:"Page switch",value:time})),this.finishDesignLoadTrack()},startDesignLoadTrack:function(){designLoadTimer=+new Date},finishDesignLoadTrack:function(){var time;designLoadTimer>0&&(time=+new Date-designLoadTimer,designLoadTimer=null,this.event("Design load",{category:"Navigation",label:"Design load",value:time}))},trackComment:function(comment){var properties={category:"Comments"};0===comment.notify.length?properties.value=PreviewEnums.COMMENT_NOTIFY_NONE:comment.notify.length===comment.collaborators_all?properties.value=PreviewEnums.COMMENT_NOTIFY_ALL:properties.value=PreviewEnums.COMMENT_NOTIFY_CHOSEN,this.event("appuse_addcomment",properties)},event:function(name,properties){$analytics.eventTrack(name,properties)}}}]),angular.module("core").service("animate",function(){"use strict";var getElements=function(selector){if("string"==typeof selector){var el=document.querySelectorAll(selector);if(el)return Array.prototype.slice.call(el)}else{if("undefined"!=typeof selector.tagName)return[selector];if(/NodeList|HTMLCollection/.test(Object.prototype.toString.call(selector)))return Array.prototype.slice.call(selector)}return null};return function(selector,duration,properties){var elements=getElements(selector);elements&&elements.forEach(function(el){TweenLite.to(el,duration,properties)})}}),angular.module("core").factory("BreakpointsService",["$q","_","$rootScope","Rest","ProjectsService","LocalDataService","Settings",function($q,_,$rootScope,Rest,ProjectsService,LocalDataService,Settings){"use strict";function _getBreakpoints(projectHash){return Settings.isExport()?LocalDataService.getData("data/breakpoints.js"):Rest.one("projects",projectHash).all("breakpoints").getList()}return{breakpointsMap:{},breakpointWidths:[],getBreakpoints:function(){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return _getBreakpoints(projectHash).then(function(breakpoints){this.generateBreakpointsMap(breakpoints),this.generateBreakpointWidths(breakpoints),d.resolve(breakpoints)}.bind(this),function(error){d.reject(error)}),d.promise},generateBreakpointsMap:function(breakpoints){_.forIn(this.breakpointsMap,function(value,key){delete this.breakpointsMap[key]}.bind(this)),breakpoints.forEach(function(breakpoint){breakpoint.name=breakpoint.name.replace("&infin;","∞"),this.breakpointsMap[breakpoint.version]=breakpoint}.bind(this))},generateBreakpointWidths:function(breakpoints){for(;this.breakpointWidths.length;)this.breakpointWidths.pop();breakpoints.forEach(function(breakpoint){this.breakpointWidths.push(breakpoint)}.bind(this)),this.breakpointWidths.sort(function(b1,b2){return 0===b1.version?1:0===b2.version?-1:b1.width<b2.width?-1:b1.width>b2.width?1:0})},getBreakpointName:function(id){return this.breakpointsMap[id].name}}}]),angular.module("core").controller("ChromeExtensionDownloadController",["$rootScope","$scope","$state","$stateParams","ChromeExtensionService",function($rootScope,$scope,$state,$stateParams,ChromeExtensionService){"use strict";$scope.isChrome=!!window.chrome,$scope.isInstalled=ChromeExtensionService.isInstalled(),$scope.downloadURL=null,$scope.helpPageURL="https://uxpin.desk.com/customer/portal/articles/1775664",$scope.onClickCreateSession=function($event){$event.preventDefault(),$state.go("home.page.usability-test",{pageId:$stateParams.pageId,page:1}),$scope.$close()},$scope.verifyInstall=function verifyInstallation(){return ChromeExtensionService.isInstalled()?void $scope.$apply(function(){$scope.isInstalled=!0}):(ChromeExtensionService.recheckInstallation(),setTimeout(verifyInstallation,1e3),!1)}}]),angular.module("core").factory("CommentsService",["$q","$rootScope","$analytics","Rest","UsersService","ProjectsService","PagesService","DocumentsService","AnalyticsService","Settings","socket",function($q,$rootScope,$analytics,Rest,UsersService,ProjectsService,PagesService,DocumentsService,AnalyticsService,Settings,socket){"use strict";function _getPageComments(projectHash,pageId){var collection,d;return Settings.isExport()?(d=$q.defer(),d.resolve([]),d.promise):(collection=Settings.showCurrentPageOnly?Rest.one("projects",projectHash).one("pages",pageId):Rest.one("projects",projectHash),collection.all("comments").getList())}return{commentsCached:null,comments:[],commentsMap:{},commentsTree:{},commentIdsInPage:{},pageId:null,selectedCommentId:null,selectedCommentShowNotificationPanel:!1,searchFor:"",groupToOpen:[],addComment:function(comment){var d=$q.defer();return this.getComments().then(function(comments){Rest.all("comments").post(comment).then(function(response){AnalyticsService.trackComment(comment),this.applyAddComment(response),d.resolve(response),socket.emit(PreviewEnums.SOCKET.ON_COMMENT_CREATE,response)}.bind(this),function(error){d.reject(error)})}.bind(this)),d.promise},getComments:function(isPageLimited){return ProjectsService.isDocument()?this.getDocumentComments():this.getPageComments(isPageLimited);
},getPageComments:function(isPageLimited){var pageId=PagesService.currentPageId,projectHash=ProjectsService.currentProjectHash;return this.isCached(isPageLimited,pageId)?this.commentsCached.promise:(this.pageId=pageId,Settings.setShowCurrentPageOnly(void 0===isPageLimited?Settings.showCurrentPageOnly:isPageLimited),this.commentsCached=$q.defer(),_getPageComments(projectHash,pageId).then(function(comments){for(;this.comments.length;)this.comments.pop();comments.forEach(function(comment){this.comments.push(comment)}.bind(this)),this.sort(this.comments),this.generateCommentsMap(this.comments),this.generateCommentsTree(this.comments),this.commentsCached.resolve(this.comments)}.bind(this)),this.commentsCached.promise)},getDocumentComments:function(){var collection,documentId=DocumentsService.currentDocumentId,projectHash=ProjectsService.currentProjectHash;return this.commentsCached?this.commentsCached.promise:(this.documentId=documentId,this.commentsCached=$q.defer(),collection=Rest.one("projects",projectHash).one("documents",documentId),collection.all("comments").getList().then(function(comments){for(;this.comments.length;)this.comments.pop();comments.forEach(function(comment){this.comments.push(comment)}.bind(this)),this.sort(this.comments),this.generateCommentsMap(this.comments),this.generateCommentsTree(this.comments),this.commentsCached.resolve(this.comments)}.bind(this)),this.commentsCached.promise)},getComment:function(id){var d=$q.defer();return this.getComments().then(function(comments){comments.forEach(function(comment){comment._id===id&&d.resolve(comment)})}),d.promise},updateComment:function(id,properties){var d=$q.defer();return this.getComment(id).then(function(comment){Rest.one("comments",id).customPUT(properties).then(function(response){socket.emit(PreviewEnums.SOCKET.ON_COMMENT_UPDATE,response),this.applyUpdateComment(id,response).then(function(){d.resolve(response)})}.bind(this),function(error){d.reject(error)})}.bind(this)),d.promise},deleteComment:function(id){var d=$q.defer();return this.getComment(id).then(function(comment){this.getComments().then(function(comments){Rest.one("comments",id).remove().then(function(response){this.applyDeleteComment(response),socket.emit(PreviewEnums.SOCKET.ON_COMMENT_DELETE,response),d.resolve(response)}.bind(this))}.bind(this))}.bind(this)),d.promise},applyAddComment:function(data){this.addToCommentsTree(data),this.addToCommentsMap(data),this.addToCommentIdsInPage(data),this.comments.push(data),$rootScope.$emit(PreviewEnums.ADD_COMMENT,data._id,data._parent_comment)},applyUpdateComment:function(id,data){var d=$q.defer();return this.getComment(id).then(function(comment){var changeResolved=comment.resolved.is!==data.resolved.is;_.forIn(data.originalElement,function(value,key){comment[key]=value}),changeResolved&&(this.getComments().then(function(comments){this.sort(comments),$rootScope.$emit(PreviewEnums.SORT_COMMENTS)}.bind(this)),$rootScope.$emit(PreviewEnums.RESOLVE_COMMENT,id,data.resolved.is)),d.resolve(comment)}.bind(this),function(error){d.reject(error)}),d.promise},applyDeleteComment:function(comment){this.removeFromCommentsMap(comment),this.removeFromCommentIdsInPage(comment),this.removeFromCommentsTree(comment),this.removeById(comment._id),$rootScope.$emit(PreviewEnums.DELETE_COMMENT,comment._id,!!comment._parent_comment)},getIndex:function(pageId,id){return id?this.commentIdsInPage[pageId].indexOf(id)+1:this.commentIdsInPage[pageId]?this.commentIdsInPage[pageId].length+1:1},isLoved:function(comment){var isLoved=!1;return _.forEach(comment.lovers,function(lover){return lover.id_user===UsersService.me.id_user?(isLoved=!0,!1):void 0}),isLoved},canEdit:function(comment){return comment.user.id===UsersService.me.id_user||UsersService.me.is_owner},isCached:function(isPageLimited,pageId){return this.commentsCached&&(pageId===this.pageId||!Settings.showCurrentPageOnly)&&(void 0===isPageLimited||isPageLimited===Settings.showCurrentPageOnly)},isGroup:function(id){return!!this.commentsTree[id]},sort:function(comments){comments.sort(function(c1,c2){return c1.resolved.is&&!c2.resolved.is?1:!c1.resolved.is&&c2.resolved.is?-1:moment(c1.created_at)<moment(c2.created_at)?-1:1}),this.generateCommentIdsInPage(comments)},generateCommentsTree:function(comments){_.forIn(this.commentsTree,function(value,key){delete this.commentsTree[key]}.bind(this)),comments.forEach(function(comment){this.addToCommentsTree(comment)}.bind(this))},addToCommentsTree:function(comment){var pageId=comment.id_page?comment.id_page:comment.id_document;(PagesService.pagesMap[pageId]||ProjectsService.isDocument())&&comment._parent_comment&&(this.commentsTree[comment._parent_comment]||(this.commentsTree[comment._parent_comment]=[]),this.commentsTree[comment._parent_comment].push(comment._id))},removeFromCommentsTree:function(comment){if(comment._parent_comment){var comments=this.commentsTree[comment._parent_comment],index=comments.indexOf(comment._id);comments.splice(index,1),comments.length||delete this.commentsTree[comment._parent_comment]}else this.commentsTree[comment._id]&&(_.forEach(this.commentsTree[comment._id],function(id){this.removeFromCommentsMap(this.commentsMap[id])}.bind(this)),delete this.commentsTree[comment._id])},generateCommentIdsInPage:function(comments){_.forIn(this.commentIdsInPage,function(value,key){for(;value.length;)value.pop()}),comments.forEach(function(comment){this.addToCommentIdsInPage(comment)}.bind(this))},addToCommentIdsInPage:function(comment){var pageId=comment.id_page?comment.id_page:comment.id_document;(PagesService.pagesMap[pageId]||ProjectsService.isDocument())&&(comment._parent_comment||(this.commentIdsInPage[pageId]||(this.commentIdsInPage[pageId]=[]),this.commentIdsInPage[pageId].push(comment._id)))},removeFromCommentIdsInPage:function(comment){if(!comment._parent_comment){var pageId=comment.id_page?comment.id_page:comment.id_document,index=this.commentIdsInPage[pageId].indexOf(comment._id);this.commentIdsInPage[pageId].splice(index,1)}},generateCommentsMap:function(comments){_.forIn(this.commentsMap,function(value,key){delete this.commentsMap[key]}.bind(this)),comments.forEach(function(comment){this.addToCommentsMap(comment)}.bind(this))},addToCommentsMap:function(comment){var pageId=comment.id_page?comment.id_page:comment.id_document;(PagesService.pagesMap[pageId]||ProjectsService.isDocument())&&(this.commentsMap[comment._id]=comment)},removeFromCommentsMap:function(comment){delete this.commentsMap[comment._id]},markAsRead:function(id){this.updateComment(id,{is_read:!0})},getRedirectId:function(commentId){return this.commentsMap[commentId]?this.commentsMap[commentId]._parent_comment?this.commentsMap[commentId]._parent_comment:commentId:null},checkGroupToOpen:function(commentId){var index=this.groupToOpen.indexOf(commentId);return-1!==index?(this.groupToOpen.splice(index,1),!0):!1},findById:function(commentId,returnIndex){var index;return this.comments.some(function(comment,i){return index=i,comment._id===commentId}),returnIndex?index:this.comments[index]},removeById:function(commentId){this.comments.splice(this.findById(commentId,!0),1)}}}]),angular.module("core").factory("DocumentsService",["$q","$rootScope","$state","Rest","ProjectsService","BreakpointsService",function($q,$rootScope,$state,Rest,ProjectsService,BreakpointsService){"use strict";return{currentDocumentId:null,currentDocumentProperties:null,getDocuments:function(){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return Rest.one("projects",projectHash).all("documents").getList().then(function(documents){this.currentDocumentId=documents[0].id_document,d.resolve(documents)}.bind(this),function(error){d.reject(error)}),d.promise},getDocument:function(id){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return Rest.one("projects",projectHash).one("documents",id).get().then(function(document){this.currentDocumentProperties=document,d.resolve(document)}.bind(this)),d.promise}}}]),angular.module("core").factory("DOMService",["$rootScope","$window",function($rootScope,$window){"use strict";return{container:null,getContainerDimensions:function(){this.container||(this.container=document.querySelector("main > section.scrolled-container > section.scrolled-content"));var w=0,h=0;if(this.container){var style=window.getComputedStyle(this.container);w=parseInt(style.width),h=parseInt(style.height)}return{width:w,height:h}},getWindowWidth:function(){return $window.innerWidth}}}]),angular.module("core").factory("editorSocket",["$rootScope",function($rootScope){"use strict";return SocketServiceHelper(ApplicationConfiguration.socketEditorServerURL,$rootScope)}]),angular.module("core").factory("Engine",["$rootScope","$window",function($rootScope,$window){"use strict";function initPage(container,content){return _content=content,_container=container,_page=new window.uxpinEngine({mode:window.ApplicationConfiguration.mode||uxpinEngine.Modes.PREVIEW,userContentPrefix:window.ApplicationConfiguration.userContentPrefix,userContentPrefixCached:window.ApplicationConfiguration.userContentPrefixCached,staticContentPrefixCached:window.ApplicationConfiguration.staticContentPrefixCached}),_page.on(window.uxpinEngine.Events.NAVIGATE,function(action,data){var target=data&&data.target||"_self";"link_back"===action?$rootScope.$emit(PreviewEnums.NAVIGATE_HISTORY_BACK):"link_page"===action?"_blank"===data.target?window.open(window.location.href.split("/pages/")[0]+"/pages/"+data.id_page,target):$rootScope.$emit(PreviewEnums.NAVIGATE_TO_PAGE,data.id_page):"link_url"===action&&window.open(data.url,target)}),_page.on(window.uxpinEngine.Events.SCROLL_TO_Y,function(y,animation,delay){InteractionsAnimations.processScroll(_container,y,animation.duration,animation)}),_page.on(window.uxpinEngine.Events.LOAD_FUNCTION_FINISHED,function(){setTimeout(function(){updateOffset()},0)}),window.addEventListener("resize",updateOffset),window.addEventListener("keydown",onKeyDown),container.addEventListener("scroll",onScroll),_page}function getPage(){return _page}function updateOffset(){if(_page){var rect=_content.getClientRects()[0];_page.setOffset(rect.left+_container.scrollLeft,rect.top+_container.scrollTop)}}function onKeyDown(e){_page&&_page.triggerKeyDown(e)}function onScroll(e){_page&&_page.triggerScroll(e)}var _page,_content,_container;return{initPage:initPage,getPage:getPage,updateOffset:updateOffset}}]),angular.module("core").factory("EscapeHtmlService",[function(){"use strict";function htmlentities(string,quote_style,charset,double_encode){var hash_map=get_html_translation_table("HTML_ENTITIES",quote_style),symbol="";if(string=null===string?"":string+"",!hash_map)return!1;if(quote_style&&"ENT_QUOTES"===quote_style&&(hash_map["'"]="&#039;"),double_encode||null===double_encode)for(symbol in hash_map)hash_map.hasOwnProperty(symbol)&&(string=string.split(symbol).join(hash_map[symbol]));else string=string.replace(/([\s\S]*?)(&(?:#\d+|#x[\da-f]+|[a-zA-Z][\da-z]*);|$)/g,function(ignore,text,entity){for(symbol in hash_map)hash_map.hasOwnProperty(symbol)&&(text=text.split(symbol).join(hash_map[symbol]));return text+entity});return string}function html_entity_decode(string,quote_style){var hash_map={},symbol="",tmp_str="",entity="";if(tmp_str=string.toString(),!1===(hash_map=get_html_translation_table("HTML_ENTITIES",quote_style)))return!1;delete hash_map["&"],hash_map["&"]="&amp;";for(symbol in hash_map)entity=hash_map[symbol],tmp_str=tmp_str.split(entity).join(symbol);return tmp_str=tmp_str.split("&#039;").join("'")}function get_html_translation_table(table,quote_style){var decimal,entities={},hash_map={},constMappingTable={},constMappingQuoteStyle={},useTable={},useQuoteStyle={};if(constMappingTable[0]="HTML_SPECIALCHARS",constMappingTable[1]="HTML_ENTITIES",constMappingQuoteStyle[0]="ENT_NOQUOTES",constMappingQuoteStyle[2]="ENT_COMPAT",constMappingQuoteStyle[3]="ENT_QUOTES",useTable=isNaN(table)?table?table.toUpperCase():"HTML_SPECIALCHARS":constMappingTable[table],useQuoteStyle=isNaN(quote_style)?quote_style?quote_style.toUpperCase():"ENT_COMPAT":constMappingQuoteStyle[quote_style],"HTML_SPECIALCHARS"!==useTable&&"HTML_ENTITIES"!==useTable)throw new Error("Table: "+useTable+" not supported");"HTML_ENTITIES"===useTable&&(entities[160]="&nbsp;",entities[161]="&iexcl;",entities[162]="&cent;",entities[163]="&pound;",entities[164]="&curren;",entities[165]="&yen;",entities[166]="&brvbar;",entities[167]="&sect;",entities[168]="&uml;",entities[169]="&copy;",entities[170]="&ordf;",entities[171]="&laquo;",entities[172]="&not;",entities[173]="&shy;",entities[174]="&reg;",entities[175]="&macr;",entities[176]="&deg;",entities[177]="&plusmn;",entities[178]="&sup2;",entities[179]="&sup3;",entities[180]="&acute;",entities[181]="&micro;",entities[182]="&para;",entities[183]="&middot;",entities[184]="&cedil;",entities[185]="&sup1;",entities[186]="&ordm;",entities[187]="&raquo;",entities[188]="&frac14;",entities[189]="&frac12;",entities[190]="&frac34;",entities[191]="&iquest;",entities[192]="&Agrave;",entities[193]="&Aacute;",entities[194]="&Acirc;",entities[195]="&Atilde;",entities[196]="&Auml;",entities[197]="&Aring;",entities[198]="&AElig;",entities[199]="&Ccedil;",entities[200]="&Egrave;",entities[201]="&Eacute;",entities[202]="&Ecirc;",entities[203]="&Euml;",entities[204]="&Igrave;",entities[205]="&Iacute;",entities[206]="&Icirc;",entities[207]="&Iuml;",entities[208]="&ETH;",entities[209]="&Ntilde;",entities[210]="&Ograve;",entities[211]="&Oacute;",entities[212]="&Ocirc;",entities[213]="&Otilde;",entities[214]="&Ouml;",entities[215]="&times;",entities[216]="&Oslash;",entities[217]="&Ugrave;",entities[218]="&Uacute;",entities[219]="&Ucirc;",entities[220]="&Uuml;",entities[221]="&Yacute;",entities[222]="&THORN;",entities[223]="&szlig;",entities[224]="&agrave;",entities[225]="&aacute;",entities[226]="&acirc;",entities[227]="&atilde;",entities[228]="&auml;",entities[229]="&aring;",entities[230]="&aelig;",entities[231]="&ccedil;",entities[232]="&egrave;",entities[233]="&eacute;",entities[234]="&ecirc;",entities[235]="&euml;",entities[236]="&igrave;",entities[237]="&iacute;",entities[238]="&icirc;",entities[239]="&iuml;",entities[240]="&eth;",entities[241]="&ntilde;",entities[242]="&ograve;",entities[243]="&oacute;",entities[244]="&ocirc;",entities[245]="&otilde;",entities[246]="&ouml;",entities[247]="&divide;",entities[248]="&oslash;",entities[249]="&ugrave;",entities[250]="&uacute;",entities[251]="&ucirc;",entities[252]="&uuml;",entities[253]="&yacute;",entities[254]="&thorn;",entities[255]="&yuml;"),"ENT_NOQUOTES"!==useQuoteStyle&&(entities[34]="&quot;"),"ENT_QUOTES"===useQuoteStyle&&(entities[39]="&#39;"),entities[60]="&lt;",entities[62]="&gt;";for(decimal in entities)entities.hasOwnProperty(decimal)&&(hash_map[String.fromCharCode(decimal)]=entities[decimal]);return hash_map}function escapeRegExp(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}return{escape:function(value){return htmlentities(value,"ENT_QUOTES","UTF-8")},escapeRegExp:function(value){return escapeRegExp(value)},decode:function(value){return html_entity_decode(value,"ENT_QUOTES")}}}]),angular.module("core").factory("LayoutStates",["$rootScope","$state",function($rootScope,$state){"use strict";var states={isToolbarVisible:!1,isSitemapVisible:!1,isPanelVisible:!1,isUserTestingSession:!1,isLiveShareSession:!1,isHostSession:!1},api=($rootScope.$on("$stateChangeSuccess",function(e,toState,toParams,fromState,fromParams){states.isToolbarVisible=!$state.includes("**.nosidebar.**"),states.isSitemapVisible=$state.includes("**.sitemap.**"),states.isPanelVisible=$state.includes("**.panel.**")}),{enterState:function(state){$state.go($state.current.name+"."+state)},removeState:function(state){$state.includes("**."+state+".**")&&$state.go($state.current.name.replace("."+state,""))},isToolbarVisible:function(){return states.isToolbarVisible},isPanelVisible:function(){return states.isPanelVisible||states.isSitemapVisible},isNoToolbarMode:function(){return $state.params.mode&&"cm"===$state.params.mode},setStateById:function(id,value){"undefined"!=typeof states[id]&&(states[id]=value)},getStateById:function(id){return states[id]}});return api}]),angular.module("core").factory("LiveSessionService",["$q","$rootScope","$state","$location","$translate","Restangular","ProjectsService","PagesService","UsersService","LiveSessionInstanceService","ChromeExtensionService",function($q,$rootScope,$state,$location,$translate,Restangular,ProjectsService,PagesService,UsersService,LiveSessionInstanceService,ChromeExtensionService){"use strict";var EVENTS=LiveShare.enums.EVENTS,ROOM_SETTINGS=LiveShare.enums.ROOM_SETTINGS,LiveSession=function(type){this.type=type,this.liveShare=null,this.muted=!1,this.roomID=null,this.roomConfigurationOptions=null,this.onContentLoaded,this.onChangePageDuringSession,this.observerCallbacks=[],this.restangular=Restangular.withConfig(function(RestangularConfigurer){RestangularConfigurer.setBaseUrl("/api/live-presentation/")}),this.onChangePage=$rootScope.$on(PreviewEnums.ON_CHANGE_PAGE,function(e,id){this.roomId(null)}.bind(this))};return LiveSession.prototype.initializeLiveShare=function(){var liveShare=new LiveShare({socketURL:ApplicationConfiguration.socketServerURL+"/live-presentation",voicechatURL:ApplicationConfiguration.voicechatServerURL,scrolledElement:"main .scrolled-content",relativeElement:".preview-container"});liveShare.on(EVENTS.START,this.onLiveSessionStart.bind(this)),liveShare.on(EVENTS.FINISH,this.onLiveSessionFinish.bind(this)),liveShare.on(EVENTS.COLLABORATOR_JOIN,this.fireObserverCallback.bind(this,EVENTS.COLLABORATOR_JOIN)),liveShare.on(EVENTS.COLLABORATOR_LEFT,this.fireObserverCallback.bind(this,EVENTS.COLLABORATOR_LEFT)),liveShare.on(EVENTS.FOLLOW_CURSOR_ON,this.fireObserverCallback.bind(this,EVENTS.FOLLOW_CURSOR_ON)),liveShare.on(EVENTS.FOLLOW_CURSOR_OFF,this.fireObserverCallback.bind(this,EVENTS.FOLLOW_CURSOR_OFF)),liveShare.on(EVENTS.TESTER_JOINED,this.fireObserverCallback.bind(this,EVENTS.TESTER_JOINED)),liveShare.on(EVENTS.ALLOW_START,this.fireObserverCallback.bind(this,EVENTS.ALLOW_START)),liveShare.on(EVENTS.VIDEO_PARTICIPANT_JOINED,this.fireObserverCallback.bind(this,EVENTS.VIDEO_PARTICIPANT_JOINED)),liveShare.on(EVENTS.VIDEO_PARTICIPANT_LEFT,this.fireObserverCallback.bind(this,EVENTS.VIDEO_PARTICIPANT_LEFT)),liveShare.on(EVENTS.MUTE,this.fireObserverCallback.bind(this,EVENTS.MUTE)),liveShare.on(EVENTS.DOM,this.onDOMEvent.bind(this)),liveShare.on(EVENTS.MEDIA_ACCESS,this.onMediaAccess.bind(this));try{ChromeExtensionService.onMessage(this.onChromeExtensionCallback.bind(this))}catch(e){}return liveShare},LiveSession.prototype.onChromeExtensionCallback=function(data){window.console.log("onChromeExtension",data,data.action),"startRecording"===data.action&&this.fireObserverCallback(EVENTS.ALLOW_START)},LiveSession.prototype.getType=function(){return this.type},LiveSession.prototype.onDOMEvent=function(data){Interactions.dispatchEvent(data.serializedEvent,data.id)},LiveSession.prototype.onMediaAccess=function(value){$rootScope.$emit(PreviewEnums.MEDIA_ACCESS,value)},LiveSession.prototype.onLiveSessionStart=function(){"function"==typeof Interactions.handleFormEvents&&Interactions.handleFormEvents(),this.onChangePageDuringSession=$rootScope.$on(PreviewEnums.ON_CHANGE_PAGE,function(e,id){var newURL=document.URL.split("#")[0]+$state.href("home.page",{pageId:id});try{this.liveShare.eventDispatcher.handleEvent({},{eventCategory:"HashChangeEvent",selector:"window",type:"hashchange",newURL:newURL,oldURL:document.URL})}catch(e){return void console.error(e)}this.liveShare.onPageChangeStart()}.bind(this)),this.fireObserverCallback(LiveShare.enums.EVENTS.START),this.onContentLoaded=$rootScope.$on(PreviewEnums.ON_CONTENT_LOADED,function(){this.liveShare.onPageChangeFinish()}.bind(this))},LiveSession.prototype.onLiveSessionFinish=function(data){"function"==typeof Interactions.unhandleFormEvents&&Interactions.unhandleFormEvents(),this.onChangePageDuringSession(),this.onContentLoaded(),this.fireObserverCallback("finish",data)},LiveSession.prototype.getCurrentPortForUrl=function(){var port=$location.port();return port&&80!==port?":"+port:""},LiveSession.prototype.roomId=function(id){return id?void(this.roomID=id):this.roomID},LiveSession.prototype.registerObserverCallback=function(event,callback){this.observerCallbacks[event]||(this.observerCallbacks[event]=[]),window.console.count("Registering callback for "+event),this.observerCallbacks[event].push(callback)},LiveSession.prototype.fireObserverCallback=function(event,data){window.console.count("Fire: "+event),window.console.log("Data",data),this.observerCallbacks[event]?(window.console.log("Callbacks count: "+this.observerCallbacks[event].length),this.observerCallbacks[event].forEach(function(callback){window.console.count("Callback for "+event+" fired"),callback(data)})):window.console.log("Callbacks count: 0")},LiveSession.prototype.makeRoomReservation=function(){var d=$q.defer(),queryParams={sessionId:UsersService.me.id_session,url:this.getDestinationUrl(),name:ProjectsService.currentProjectName,type:this.type};return this.restangular.one("").post("make-room-reservation",queryParams).then(function(data){this.roomId(JSON.parse(data)),d.resolve(this.roomId())}.bind(this),function(err){window.console.error(err),d.reject(err)}),d.promise},LiveSession.prototype.startInitializing=function(data){LiveSessionInstanceService.set(this);var queryParams={};data.options&&(queryParams.options=data.options),data.type&&(queryParams.type=data.type),$state.go("home.page.live-share-start",queryParams)},LiveSession.prototype.create=function(settings,userData){return this.liveShare=this.initializeLiveShare(),this.liveShare.create(settings,userData)},LiveSession.prototype.join=function(sessionId,userData){return this.liveShare=this.initializeLiveShare(),this.liveShare.join({roomID:sessionId},userData)},LiveSession.prototype.quit=function(){this.liveShare.quit()},LiveSession.prototype.isSession=function(){return this.liveShare?this.liveShare.isSession():!1},LiveSession.prototype.isHostSession=function(){return this.liveShare.isHostSession()},LiveSession.prototype.getInviteURL=function(){return $location.protocol()+"://"+$location.host()+this.getCurrentPortForUrl()+"/live-presentation/"+this.roomId()},LiveSession.prototype.getDestinationUrl=function(){return $state.href("home.page",{pageId:PagesService.currentPageId},{absolute:!0})},LiveSession.prototype.getCollaboratorsData=function(){return this.liveShare.getCollaboratorsData()},LiveSession.prototype.getHostData=function(){return this.liveShare.getHostData()},LiveSession.prototype.removeCollaborator=function(id){return this.liveShare.removeCollaborator(id)},LiveSession.prototype.getConfigurationOptions=function(){},LiveSession.prototype.setOption=function(key,val){var option=this.translateOption(key,val),optionName=Object.keys(option)[0];this.liveShare.setOption(optionName,option[optionName])},LiveSession.prototype.translateOption=function(key,val){var option={};return key===ROOM_SETTINGS.ALLWAYS_FOLLOW_HOST?option.toggleFollow=!val:key===ROOM_SETTINGS.SHOW_CURSOR?option.showCursor=val?"all":"host":key===ROOM_SETTINGS.CAN_CLOSE_TASKS?option[ROOM_SETTINGS.CAN_CLOSE_TASKS]=val?"all":"host":key===ROOM_SETTINGS.SEE_SITEMAP?option[ROOM_SETTINGS.SEE_SITEMAP]=val?"all":"host":option[key]=val,option},LiveSession.prototype.followCursor=function(id){this.liveShare.followCursor(id)},LiveSession.prototype.executeEventsQueue=function(){return this.liveShare.collaboration.executeEventsQueue()},LiveSession.prototype.mute=function(value){this.liveShare.mute(value)},LiveSession.prototype.getMyData=function(){return this.liveShare.getMyData()},LiveSession}]),angular.module("core").factory("LiveShareService",["_","$translate","LiveSessionService",function(_,$translate,LiveSessionService){"use strict";var LiveShareService=function(){LiveSessionService.apply(this,arguments)},proto=LiveShareService.prototype;return proto=_.extend(proto,LiveSessionService.prototype),proto.constructor=LiveShareService,proto.getConfigurationOptions=function(){return $translate(["LS_OPTION_SHOW_CURSOR","LS_OPTION_FOLLOW_CURSOR"]).then(function(translations){return this.roomConfigurationOptions||(this.roomConfigurationOptions=[{name:translations.LS_OPTION_SHOW_CURSOR,value:!1,param:"showCursor"},{name:translations.LS_OPTION_FOLLOW_CURSOR,value:!1,param:"alwaysFollowHost"}]),this.roomConfigurationOptions}.bind(this))},new LiveShareService(LiveShare.enums.SESSION_TYPES.SHARING)}]),angular.module("core").factory("_",[function(){"use strict";return window._}]),angular.module("core").service("moment",function(){"use strict";return window.moment}),angular.module("core").factory("NotificationsService",["$q","_","$sce","$rootScope","Rest","ProjectsService",function($q,_,$sce,$rootScope,Rest,ProjectsService){"use strict";return{notificationsMap:{},getNotifications:function(){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return Rest.one("projects",projectHash).all("notifications").getList().then(function(notifications){this.generateNotificationsMap(notifications),d.resolve(notifications)}.bind(this),function(error){d.reject(error)}),d.promise},addToNotifications:function(emails,commentId,forceEmpty){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return _.isEmpty(emails)&&!forceEmpty?d.reject():Rest.one("projects",projectHash).all("notifications").customPOST({commentId:commentId,emails:emails},"add").then(function(notification){this.addToNotificationsMap(notification),d.resolve(notification)}.bind(this),function(error){d.reject(error)}),d.promise},removeFromNotificationList:function(emails,commentId,forceEmpty){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return _.isEmpty(emails)&&!forceEmpty?d.reject():Rest.one("projects",projectHash).all("notifications").customPOST({commentId:commentId,emails:emails},"remove").then(function(notification){this.addToNotificationsMap(notification),d.resolve(notification)}.bind(this),function(error){d.reject(error)}),d.promise},generateNotificationsMap:function(notifications){_.forIn(this.notificationsMap,function(value,key){delete this.notificationsMap[key]}.bind(this)),notifications.forEach(function(notification){this.addToNotificationsMap(notification)}.bind(this))},addToNotificationsMap:function(notification){this.notificationsMap[notification._id]=notification}}}]),angular.module("core").factory("PagesService",["$q","$rootScope","$state","Rest","ProjectsService","BreakpointsService","LocalDataService","Settings",function($q,$rootScope,$state,Rest,ProjectsService,BreakpointsService,LocalDataService,Settings){"use strict";function _getPage(projectHash,pageId){return Settings.isExport()?LocalDataService.getData("data/page_size_"+pageId+".js"):Rest.one("projects",projectHash).one("pages",pageId).get()}function _getPageContent(projectHash,pageId){return Rest.one("projects",projectHash).one("pages",pageId).one("content").get()}function _getPageCanvasData(projectHash,pageId){return Settings.isExport()?LocalDataService.getData("data/page_"+pageId+".js"):Rest.one("projects",projectHash).one("pages",pageId).one("canvasData").get()}function _getPages(projectHash){return Settings.isExport()?LocalDataService.getData("data/pages.js"):Rest.one("projects",projectHash).all("pages").getList()}var AUTO_RESIZE_MARGIN=200;return{rootPageId:null,currentPageId:null,defaultBreakpointId:null,currentBreakpointId:null,currentPageProperties:null,pagesMap:{},pagesChildrenMap:{},pagesTree:{},pagesBreakpoints:{},breakpointIds:{},setCurrentPageId:function(id){this.currentPageId=id,"undefined"!=typeof this.pagesMap[id]&&"undefined"!=typeof this.pagesMap[id].version_type&&(this.currentBreakpointId=this.pagesMap[id].version_type),$rootScope.$emit(PreviewEnums.ON_CHANGE_PAGE,id)},setCurrentBreakpointId:function(id){this.currentBreakpointId=id},setPageResponsive:function(width){if(_.size(this.breakpointIds)>1){var b,breakpointId=0,last=!1;_.forEach(BreakpointsService.breakpointWidths,function(breakpoint){-1!==this.breakpointIds.indexOf(breakpoint.version)&&(breakpoint.width<=width&&0!==breakpoint.version||last===!0&&0===breakpoint.version&&width>b.width+AUTO_RESIZE_MARGIN?(breakpointId=breakpoint.version,b=breakpoint,last=!0):last=!1)}.bind(this)),"undefined"!=typeof breakpointId&&this.currentBreakpointId!==breakpointId&&this.changePageBreakpoint(breakpointId)}},changePageBreakpoint:function(id){var newState,currentState=$state.current.name;newState=$state.includes("**.comment.**")?currentState.replace("home.page.comment","home.page"):currentState,$rootScope.$emit(PreviewEnums.ADDING_COMMENT,!1),this.setCurrentBreakpointId(id),$state.go(newState,{pageId:this.getPageByBreakpoint(this.currentPageId)})},getCanvasData:function(pageId){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return _getPage(projectHash,pageId).then(function(page){return this.currentPageProperties=page,_getPageCanvasData(projectHash,pageId)}.bind(this)).then(function(data){d.resolve(data)}.bind(this)),d.promise},getPages:function(){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return _getPages(projectHash).then(function(pages){this.generatePagesMap(pages),this.generatePagesTree(pages),this.generatePagesBreakpoints(pages),this.breakpointIds=this.getBreakpoints(pages),this.rootPageId=this.pagesTree.nodes[0].id,this.defaultBreakpointId=this.getDefaultBreakpointId(pages),d.resolve(pages)}.bind(this),function(error){d.reject(error)}),d.promise},getPage:function(id){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return _getPage(projectHash,id).then(function(page){this.currentPageProperties=page,d.resolve(page)}.bind(this)),d.promise},getPageContent:function(id){var projectHash=ProjectsService.currentProjectHash,d=$q.defer();return _getPageContent(projectHash,id).then(function(content){d.resolve(content)}.bind(this)),d.promise},getPageByBreakpoint:function(id){if(!this.pagesMap[id])return{};this.pagesMap[id].version_of&&(id=this.pagesMap[id].version_of);var breakpointId=null!==this.currentBreakpointId?this.currentBreakpointId:this.defaultBreakpointId,pId=this.pagesBreakpoints[id][breakpointId];return pId?pId:this.pagesBreakpoints[id][parseInt(_.findKey(this.pagesBreakpoints[id]))]},getRootPage:function(){return this.getPageByBreakpoint(this.rootPageId)},getContentWidth:function(){var breakpointId=this.pagesMap[this.currentPageId].version_type;return 0!==breakpointId?BreakpointsService.breakpointsMap[breakpointId].width:this.currentPageProperties.size.width},getContentCropping:function(){var scrollSize={};return this.currentPageProperties?{x:this.currentPageProperties.size.scrollx,y:this.currentPageProperties.size.scrolly}:scrollSize},generatePagesMap:function(pages){_.forIn(this.pagesMap,function(value,key){delete this.pagesMap[key]}.bind(this)),pages.forEach(function(page){this.pagesMap[page.id_page]=page}.bind(this))},generatePagesTree:function(pages){_.forIn(this.pagesTree,function(value,key){delete this.pagesTree[key]}.bind(this)),_.forIn(this.pagesChildrenMap,function(value,key){delete this.pagesChildrenMap[key]}.bind(this)),this.pagesTree=this.getChildren(null,pages)},getChildren:function(id,pages){var node={id:id,nodes:[]};return this.pagesChildrenMap[node.id]=[],pages.forEach(function(page){page.parent===id&&null===page.version_of&&(this.pagesChildrenMap[node.id].push(page.id_page),node.nodes.push(this.getChildren(page.id_page,pages)))}.bind(this)),node},generatePagesBreakpoints:function(pages){_.forIn(this.pagesBreakpoints,function(value,key){delete this.pagesBreakpoints[key]}.bind(this));var breakpoints;pages.forEach(function(page){page.version_of||(breakpoints=this.pagesBreakpoints[page.id_page]={},pages.forEach(function(breakpointPage){breakpointPage.version_of===page.id_page&&(breakpoints[breakpointPage.version_type]=breakpointPage.id_page)}),breakpoints[page.version_type]=page.id_page)}.bind(this))},getBreakpoints:function(pages){
var breakpoints=[];return pages.forEach(function(page){-1===breakpoints.indexOf(page.version_type)&&breakpoints.push(page.version_type)}),breakpoints},getPageBreakpoints:function(id){var p=this.pagesMap[id];if(!p)return[];var pId=p.version_of?p.version_of:id,pageBreakpoints=this.pagesBreakpoints[pId],b=[];return _.forEach(pageBreakpoints,function(pageId,breakpointId){if("null"!==breakpointId){var id=parseInt(breakpointId,10);b.push({id:id,name:BreakpointsService.getBreakpointName(id)})}}),b},getCurrentPageBreakpoints:function(){return this.getPageBreakpoints(this.currentPageId)},getDefaultBreakpointId:function(pages){return pages.length?0===pages[0].main_version&&null===pages[0].version_type?this.breakpointIds[1]:pages[0].main_version:null}}}]),angular.module("core").factory("ProjectsService",["$q",function($q){"use strict";return{currentProjectId:ApplicationConfiguration.project.id_project,currentProjectHash:ApplicationConfiguration.project.hash,currentProjectName:ApplicationConfiguration.project.name,currentProjectType:ApplicationConfiguration.project.type,currentCollectionId:ApplicationConfiguration.project.id_collection,currentDocumentType:ApplicationConfiguration.project.type,currentProjectFeatures:ApplicationConfiguration.project.features||{},DOCUMENT_TYPE_UXTEST:"DUXTEST",DOCUMENT_TYPE_PERSONA:"DPERSONA",DOCUMENT_TYPE_BMC:"DBMC",DOCUMENT_TYPE_PC:"DPC",DOCUMENT_TYPE_WIREFRAME:"W",isDocument:function(){return this.currentProjectType!==this.DOCUMENT_TYPE_WIREFRAME},isUXTestDocument:function(){return this.DOCUMENT_TYPE_UXTEST===this.currentProjectType},getType:function(){return this.currentDocumentType}}}]),angular.module("core").factory("Rest",["Restangular",function(Restangular){"use strict";return Restangular.withConfig(function(RestangularConfigurer){RestangularConfigurer.setBaseUrl("/api"),RestangularConfigurer.setResponseExtractor(function(response){var newResponse=response;return angular.isArray(response)?angular.forEach(newResponse,function(value,key){newResponse[key].originalElement=angular.copy(value)}):newResponse.originalElement=angular.copy(response),newResponse})})}]),angular.module("core").factory("Settings",["$rootScope","$state","localStorageService","ProjectsService",function($rootScope,$state,localStorageService,ProjectsService){"use strict";var getValue=function(value,defaultValue){return"string"==typeof value?"true"===value:defaultValue};return{showComments:getValue(localStorageService.get("showComments"),!0),showResolvedComments:getValue(localStorageService.get("showResolvedComments"),!0),showCurrentPageOnly:getValue(localStorageService.get("showCurrentPageOnly"),!0),isResponsive:!1,disableComments:!1,disableSitemap:!1,disableLiveChanges:!1,minimized:localStorageService.get("minimized")?localStorageService.get("minimized").split(","):[],setShowComments:function(value){localStorageService.set("showComments",value),this.showComments=value,$rootScope.$emit(PreviewEnums.ON_SHOW_COMMENTS_SETTINGS_CHANGED,value)},setShowCurrentPageOnly:function(value){localStorageService.set("showCurrentPageOnly",value),this.showCurrentPageOnly=value},setShowResolvedComments:function(value){localStorageService.set("showResolvedComments",value),this.showResolvedComments=value,$rootScope.$emit(PreviewEnums.ON_SHOW_COMMENTS_RESOLVED_SETTINGS_CHANGED,value)},setResponsive:function(value){this.isResponsive=value},toggleSidebar:function(){var newState,currentState=$state.current.name;$state.includes("**.nosidebar.**")?(newState=currentState.replace(".nosidebar",""),$state.go(newState)):$state.go(currentState+".nosidebar"),localStorageService.set("showSidebar",!$state.includes("**.nosidebar.**"))},updateMinimized:function(){localStorageService.set("minimized",this.minimized.join(","))},getModeSettings:function(mode){return mode=mode||"",{comments:-1===mode.indexOf("c"),sitemap:-1===mode.indexOf("m"),liveChanges:-1===mode.indexOf("d")}},setMode:function(mode){var settings=this.getModeSettings(mode);mode&&"string"==typeof mode?(this.disableComments=!settings.comments,this.disableSitemap=!settings.sitemap,this.disableLiveChanges=!settings.liveChanges):(this.disableComments=!1,this.disableSitemap=!1,this.disableLiveChanges=!1),ProjectsService.isDocument()&&(this.disableSitemap=!0),ProjectsService.isUXTestDocument()&&(this.disableComments=!0),$rootScope.$emit(PreviewEnums.ON_MODE_CHANGED)},isExport:function(){return"export"===ApplicationConfiguration.mode},isMenuEnabled:function(){return ApplicationConfiguration.menuEnabled}}}]),angular.module("core").factory("socket",["$rootScope",function($rootScope){"use strict";return SocketServiceHelper(ApplicationConfiguration.socketServerURL,$rootScope)}]),angular.module("core").factory("UsabilityTestService",["_","$q","$translate","LiveSessionService",function(_,$q,$translate,LiveSessionService){"use strict";var EVENTS=LiveShare.enums.EVENTS,STATUS_FINISHED=2,UsabilityTestService=function(){LiveSessionService.apply(this,arguments),this.isWizardOpen=!1,this.testDataId=null,this.testData=null,this.fetchPromise=null,this.getIdDefer=$q.defer()},proto=UsabilityTestService.prototype;return proto=_.extend(proto,LiveSessionService.prototype),proto.constructor=UsabilityTestService,proto.startInitializing=function(data){var config={};data.options&&(config.options=data.options),this.storeData(data.testData),LiveSessionService.prototype.startInitializing.call(this,config)},proto.initializeLiveShare=function(data){var liveShare=LiveSessionService.prototype.initializeLiveShare.apply(this);return liveShare.on(EVENTS.UPDATE_TASKS,this.fireObserverCallback.bind(this,EVENTS.UPDATE_TASKS)),liveShare.on(EVENTS.OPTIONS_CHANGED,this.fireObserverCallback.bind(this,EVENTS.OPTIONS_CHANGED)),liveShare.on(EVENTS.TESTER_JOINED,this.onTesterJoined.bind(this)),liveShare},proto.storeData=function(data){this.testData=data},proto.getTestData=function(){return this.testData},proto.save=function(){var d=$q.defer();return this.restangular.one("").post("usability-test",this.testData).then(function(testData){this.testData=testData,d.resolve(testData)}.bind(this),function(err){d.reject(new Error(err))}),d.promise},proto.getConfigurationOptions=function(){return $translate(["UT_OPTION_CAN_CLOSE_TASK","UT_OPTION_SEE_SITEMAP"]).then(function(translations){return this.roomConfigurationOptions||(this.roomConfigurationOptions=[{name:translations.UT_OPTION_CAN_CLOSE_TASK,value:!1,param:"canCloseTasks"},{name:translations.UT_OPTION_SEE_SITEMAP,value:!1,param:"seeSitemap"}]),this.roomConfigurationOptions}.bind(this))},proto.setDataId=function(dataId){this.testDataId=dataId,this.getIdDefer.resolve(dataId)},proto.getDataId=function(){return this.getIdDefer.promise},proto.fetch=function(){if(this.fetchPromise)return this.fetchPromise;var d=$q.defer();return this.testData?d.resolve(this.testData):this.getDataId().then(function(dataId){this.restangular.one("usability-test",this.testDataId).get().then(function(data){this.testData=data,d.resolve(data)}.bind(this),function(err){d.reject(err)})}.bind(this)),this.fetchPromise=d.promise,d.promise},proto.resolveTask=function(id){this.liveShare.resolveTask(id)},proto.startSession=function(userType){this.liveShare.startUTSession(userType)},proto.onTesterJoined=function(data){this.testData.started_at=data.started_at,this.fireObserverCallback(EVENTS.TESTER_JOINED,data)},proto.finishTestingSession=function(){return this.restangular.one("usability-test",this.testData._id).customPUT({started_at:this.testData.started_at,finished_at:new Date,status:STATUS_FINISHED})},new UsabilityTestService(LiveShare.enums.SESSION_TYPES.TESTING)}]),angular.module("core").factory("UsersService",["$q","Rest","ProjectsService","localStorageService","Settings",function($q,Rest,ProjectsService,localStorageService,Settings){"use strict";function _getCollaborators(projectHash,collectionId){var d;return Settings.isExport()?(d=$q.defer(),d.resolve([]),d.promise):Rest.one("projects",projectHash).one("collections",collectionId).all("collaborators").getList()}return{collaboratorsMap:{},collaboratorEmails:[],me:function(userData){return userData.is_anonymous&&localStorageService.get("anonymousName")&&(userData.name=localStorageService.get("anonymousName")),userData}(ApplicationConfiguration.userData),getCollaborators:function(){var projectHash=ProjectsService.currentProjectHash,collectionId=ProjectsService.currentCollectionId,d=$q.defer();return _getCollaborators(projectHash,collectionId).then(function(collaborators){this.generateCollaboratorsMap(collaborators),this.generateCollaboratorEmails(collaborators),d.resolve(collaborators)}.bind(this),function(error){d.reject(error)}),d.promise},generateCollaboratorsMap:function(collaborators){_.forIn(this.collaboratorsMap,function(value,key){delete this.collaboratorsMap[key]}.bind(this)),collaborators.forEach(function(collaborator){this.collaboratorsMap[collaborator.id_user]=collaborator}.bind(this))},generateCollaboratorEmails:function(collaborators){collaborators.forEach(function(collaborator){this.collaboratorEmails.push(collaborator.email)}.bind(this))},isAnonymous:function(){return this.me.is_anonymous},isAnonymousNameSet:function(){return"anonymous"!==this.me.name},setAnonymousName:function(name){this.me.name=name,localStorageService.set("anonymousName",name)},getCollaboratorByEmail:function(email){var collaborator=null;return _.forIn(this.collaboratorsMap,function(value,key){return value.email===email?(collaborator=value,!1):void 0}.bind(this)),collaborator}}}]),angular.module("core").factory("UXPinService",["ProjectsService","PagesService","DocumentsService",function(ProjectsService,PagesService,DocumentsService){"use strict";var uxpinURL=ApplicationConfiguration.uxpinURL,wireframeURL=uxpinURL;return wireframeURL+=ApplicationConfiguration.project.features.new_editor?"/edit/":"/dms/Desktop/Default/",{applicationURL:uxpinURL,collectionURL:uxpinURL+"/dms/Collections/Show/",wireframeURL:wireframeURL,documentURL:uxpinURL+"/dms/Documents/Default/",dashboardURL:uxpinURL+"/dms/Dashboard/Default/",getCurrentDocumentURL:function(){switch(ProjectsService.currentProjectType){case ProjectsService.DOCUMENT_TYPE_WIREFRAME:return this.wireframeURL+ProjectsService.currentProjectId+"#?id_page="+PagesService.currentPageId;case ProjectsService.DOCUMENT_TYPE_PERSONA:case ProjectsService.DOCUMENT_TYPE_BMC:case ProjectsService.DOCUMENT_TYPE_PC:return this.documentURL+DocumentsService.currentDocumentId;default:return null}},getCurrentCollectionURL:function(){return this.collectionURL+ProjectsService.currentCollectionId},getDashboardURL:function(){return this.dashboardURL}}}]),angular.module("core").run(["$templateCache",function($templateCache){$templateCache.put("/scripts/modules/core/views/breadcrumbs.view.html",'<li ng-repeat="breadcrumb in breadcrumbs">\n    <span>{{breadcrumb}}</span>\n    <span ng-if="$last" class="breakpoint" ng-bind-html="breakpoint"></span>\n</li>\n'),$templateCache.put("/scripts/modules/core/views/breakpoints.view.html",'<li ng-repeat="breakpoint in params.breakpoints" class="tab item" ng-if="isUnlocked(breakpoint.id)">\n    <a ng-href="" ng-class="{\'active\' : isActive(breakpoint.id)}" ng-click="onClick($event,breakpoint.id)">{{breakpoint.name}}</a>\n</li>\n'),$templateCache.put("/scripts/modules/core/views/canvas.view.html",'<main class="canvas-main-container" ng-class="{\'no-logo\': firstTimeLoaded}" adjust-to-viewport-size>\n    <section class="scrolled-container">\n        <section id="canvas-wrapper" class="scrolled-content">\n            <section class="canvas-container" ng-style="dimensions" ng-class="{\'document-uxtest\': isUXTestDocument}">\n                <section class="preview-container" add-comment>\n                    <div ng-if="!isDocument" class="ng-canvas-container" ng-style="overflow">\n                      <div class="ng-canvas"></div>\n                      <div class="ng-overlay"></div>\n                    </div>\n                    <div ng-if="isDocument" ng-include="contentPath" onload="onContentLoaded()" class="canvas-content" ng-style="overflow"></div>\n                    <preview-pin ng-show="addingComment" comment x="{{clickX}}" y="{{clickY}}"></preview-pin>\n                    <preview-pin\n                        ng-repeat="comment in list"\n                        comment="comment"\n                        x="{{comment.position.x}}"\n                        y="{{comment.position.y}}">\n                    </preview-pin>\n                </section>\n            </section>\n        </section>\n    </section>\n\n    <usability-test-plugin-tip ng-if="isUTSession"></usability-test-plugin-tip>\n    <media-access-tip ng-if="isLiveSession || isUTSession"></media-access-tip>\n</main>\n'),$templateCache.put("/scripts/modules/core/views/comments-notes.view.html",'<section class="left-panel" id="comments-notes"> <!--ng-class="{\'visible\' : isVisible()}"-->\n    <input type="radio" class="tab-radio" name="tab" id="comments-tab" checked>\n    <label for="comments-tab">{{\'LBL_COMMENTS\' | translate}} <span class="notification-bubble">2</span></label>\n    <section id="comments-panel" class="tab-container" ng-class="{\'loading\' : loading}">\n        <header>\n            <div class="filter fake-checkbox">\n                <input type="checkbox" id="show-resolved-only-comments" ng-model="showResolved" ng-change="onShowResolved()">\n                <label for="show-resolved-only-comments">{{\'LBL_SHOW_RESOLVED\' | translate}}</label>\n            </div>\n            <div class="filter fake-checkbox">\n                <input type="checkbox" id="show-current-page-only-comments" ng-model="showCurrentPageOnly" ng-change="onShowCurrentPageOnly()" ng-disabled="isDocument">\n                <label for="show-current-page-only-comments">{{\'LBL_CURRENT_PAGE\' | translate}}</label>\n            </div>\n            <form action="#" class="search">\n                <label for="comments-list-search" class="icon-font-search only-icon-font" ng-click="onSearchClick($event)">Search</label>\n                <input type="text" placeholder="{{\'INFO_SEARCH\' | translate}}" id="comments-list-search" ng-class="{\'active\' : searchFor}" ng-model="searchFor" ng-keydown="keyDown($event)" sync-focus-with="focused">\n                <span class="reset-search" ng-click="searchFor=\'\'; focused=false;">Reset search</span>\n            </form>\n        </header>\n        <section class="scrolled-container">\n            <section id="comments-list" class="scrolled-content" ng-if="showCurrentPageOnly">\n                <preview-comment-container ng-repeat="comment in list" type="panel" comment="comment"></preview-comment-container>\n                <section class="empty-list" ng-class="{\'hidden\' : comments.length}">\n                    <h1>{{\'INFO_NO_COMMENTS\' | translate}}</h1>\n                    <a ng-href="" class="add-new-comment" ng-click="addNewComment()">{{\'INFO_ENTER_COMMENT_MODE\' | translate}}</a>\n                </section>\n            </section>\n            <section id="comments-list" class="scrolled-content" ng-if="!showCurrentPageOnly">\n                <section class="page-grouped-comments" ng-repeat="(pageId, page) in tree" ng-class="{\'all-page-comments-hidden\' : isPageHidden(pageId)}">\n                    <h3 highlight search-for="searchFor" input-text="getPageName(pageId)" ng-click="togglePageHidden($event, pageId)"></h3>\n                    <section class="page-grouped-breakpoints" ng-repeat="(breakpointId, comments) in page">\n                        <h4 ng-if="showBreakpoints()" ng-bind-html="getBreakpointName(breakpointId)"></h4>\n                        <preview-comment-container ng-repeat="comment in comments" type="panel" comment="comment"></preview-comment-container>\n                    </section>\n                </section>\n                <section class="empty-list" ng-class="{\'hidden\' : comments.length}">\n                    <h1>{{\'INFO_NO_COMMENTS\' | translate}}</h1>\n                    <a ng-href="" class="add-new-comment" ng-click="addNewComment()">{{\'INFO_ENTER_COMMENT_MODE\' | translate}}</a>\n                </section>\n            </section>\n        </section>\n    </section>\n\n    <input type="radio" class="tab-radio" name="tab" id="notes-tab">\n    <label for="notes-tab">{{\'LBL_NOTES\' | translate}}</label>\n    <section id="notes-panel" class="tab-container" ng-if="0">\n        <header>\n            <div class="filter fake-checkbox">\n                <input type="checkbox">\n                <label for="">{{\'LBL_SHOW_RESOLVED\' | translate}}</label>\n            </div>\n            <div class="filter fake-checkbox">\n                <input type="checkbox">\n                <label for="">{{\'LBL_CURRENT_PAGE\' | translate}}</label>\n            </div>\n            <form action="#" class="search">\n                <label for="notes-list-search" class="icon-font-search only-icon-font">{{\'LBL_SEARCH\' | translate}}</label>\n                <input type="text" placeholder="Search in notes" id="notes-list-search">\n            </form>\n        </header>\n        <section class="scrolled-container">\n            <section id="notes-list" class="scrolled-content">\n                <section class="single-note add-new-note">\n                    <input type="text" placeholder="New note">\n                    <button class="btn-flat ghost-style icon-enter-only-icon-font"></button>\n                </section>\n                <section class="single-note">\n                    <input type="checkbox">\n                    <label for=""><span>We\'ll never post anything to facebook. By Signing up you are agreeing to the PinMatch Terms of Use and Privacy Policy. *this needs to be stated here*</span></label>\n                </section>\n                <section class="single-note">\n                    <input type="checkbox">\n                    <label for=""><span>whats the two pictures for, and also facebook doesnt have an email address - david to type in what we need</span></label>\n                </section>\n\n                <h3>{{\'LBL_RESOLVED\' | translate}}</h3>\n                <section class="single-note resolved">\n                    <input type="checkbox" checked>\n                    <label for=""><span>progress bar needs to be up top to be consistant also for dots also title needs to be Matching info</span></label>\n                </section>\n\n\n                <section class="empty-list" style="display: none;">\n                    <h1>{{\'INFO_NO_NOTES\' | translate}}</h1>\n                    <a ng-href="" class="add-new-note" ng-click="addNewNote()">{{\'INFO_ADD_FIRST_NOTE\' | translate}}</a>\n                </section>\n            </section>\n        </section>\n    </section>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/home.view.html",'<script type="text/ng-template" id="notify-users.view.html">\n    <section class="notify-users cloud top-arrow active">\n        <section class="standard-list-container multi-line-options">\n            <h3>\n                {{\'BTN_NOTIFY\' | translate}}\n                <span class="selection-trigger">\n                    <a ng-href="" ng-class="{\'active\' : params.isAll}" ng-click="selectAll();">All</a> &bull; <a ng-href="" ng-class="{\'active\' : params.isNone}" ng-click="selectNone();">None</a>\n                </span>\n            </h3>\n\n            <ul>\n                <li ng-repeat="notification in notifications" class="fake-checkbox dark-style">\n                    <input type="checkbox" id="check-{{notification.id}}" ng-model="selected[notification.email]" ng-change="onChange();">\n                    <label for="check-{{notification.id}}">\n                        <strong>{{notification.name}}</strong>\n                        <small>{{notification.email}}</small>\n                    </label>\n                </li>\n            </ul>\n        </section>\n\n        <h3>{{\'BTN_ADD_USER\' | translate}}</h3>\n        <textarea name="" id="" cols="30" rows="3" placeholder="hi@uxpin.com, hello@uxpin.com" ng-model="params.emailsCSV" ng-change="onChangeCustomEmails();" ng-keydown="onKeyDown($event);" class="dark-style"></textarea>\n    </section>\n</script>\n\n<script type="text/ng-template" id="mentions-list.view.html">\n    <ul class="mention-people-list">\n        <li ng-repeat="collaborator in collaborators" ng-mousedown="onMouseDown($event, collaborator)" ng-class="{\'highlight\' : selected == collaborator.email}"><a ng-href="">{{collaborator.name}}</a></li>\n    </ul>\n    <span ng-if="collaborators.length == 0" class="no-users">No users found</span>\n    <fieldset class="mention-add-email">\n        <input type="text" class="dark-style">\n        <button>add email</button>\n    </fieldset>\n</script>\n\n<ui-view></ui-view>\n'),$templateCache.put("/scripts/modules/core/views/nav.view.html",'<section id="main-toolbar" ng-if="params.toolbarEnabled" toggle-visibility toggle-flag="isToolbarVisible()" toggle-width-open="100" toggle-width-closed="0">\n    <nav>\n        <ul ng-if="isUserTesting && isHostSession && sessionStartTime">\n            <li>\n                <a ng-href="#" class="only-icon-font icon-stop" data-show-node="tiny-tooltip" ng-click="onClickFinishSession($event)">\n                    <span class="tiny-tooltip">{{\'TIP_FINISH_SESSION\' | translate}}</span>\n                    <time-counter start-time="{{sessionStartTime}}"></time-counter>\n                </a>\n            </li>\n        </ul>\n\n        <ul ng-if="!isUserTesting">\n            <li ng-repeat="item in items | filter : {section: 1}">\n                <a ng-class="isActive(item.state) ? \'active \' + item.classes : item.classes" class="only-icon-font" data-show-node="tiny-tooltip" ng-click="onClick(item)">\n                    <span class="tiny-tooltip">{{item.tooltip | translate}}</span>\n                </a>\n            </li>\n        </ul>\n\n        <ul ng-if="!isUserTesting">\n            <li ng-repeat="item in items | filter : {section: 2}">\n                <a ng-class="isActive(item.state) ? \'active \' + item.classes : item.classes" class="only-icon-font" data-show-node="tiny-tooltip" ng-click="onClick(item)">\n                    <span class="tiny-tooltip">{{item.tooltip | translate}}</span>\n                </a>\n                <nav style="display: none;">\n                  <ul>\n                    <li>\n                      <a href="#" class="chat-all only-icon-font">\n                        Chat all\n                        <span class="tiny-tooltip">Open team chat</span>\n                      </a>\n                    </li>\n                    <li>\n                      <a href="#" class="call-all only-icon-font">\n                        Call all\n                        <span class="tiny-tooltip">Open team call</span>\n                      </a>\n                    </li>\n                  </ul>\n\n                  <ul class="users-list">\n                    <li>\n                      <a href="#" class="user avatar" data-show-node="tiny-tooltip">\n                        <img src="" alt="">\n                        <strong>KZ</strong>\n                        <span class="tiny-tooltip">Click to chat</span>\n                      </a>\n                    </li>\n                    <li>\n                      <a href="#" class="user avatar" data-show-node="tiny-tooltip">\n                        <img src="" alt="">\n                        <strong>KZ</strong>\n                        <span class="tiny-tooltip">Click to chat</span>\n                      </a>\n                    </li>\n                    <li>\n                        <a href="#" class="only-icon-font icon-font-workers add-user" data-show-node="tiny-tooltip">\n                            <span class="tiny-tooltip">Add another user</span>\n                        </a>\n                    </li>\n                  </ul>\n                </nav>\n            </li>\n        </ul>\n\n        <ul ng-if="!isUserTestingSession && !isLiveShareSession">\n            <!-- Usability Testing -->\n            <li ng-if="params.isLogged && params.features.user_testing && !params.isDocument && params.isOwner">\n                <a ng-click="onClickUsabilityTestSession()" class="only-icon-font icon-font-usability-testing" data-show-node="tiny-tooltip">\n                    <span class="tiny-tooltip">Usability testing <small>(beta)</small></span>\n                </a>\n            </li>\n            <li ng-if="params.isLogged && params.features.user_testing && !params.isDocument && !params.isOwner">\n                <div class="fake-button only-icon-font icon-font-usability-testing inactive" data-show-node="tiny-tooltip">\n                    <span class="tiny-tooltip">\n                        Usability testing <small>(beta)</small>. Only project owner can start session.\n                    </span>\n                </div>\n            </li>\n            <li ng-if="!params.isLogged && !params.isExport">\n                <div class="fake-button only-icon-font icon-font-usability-testing inactive" data-show-node="tiny-tooltip">\n                    <span class="tiny-tooltip">Usability testing <small>(beta)</small>. Please log in to create session.</span>\n                </div>\n            </li>\n            <li ng-if="params.isLogged && !params.features.user_testing" class="plan-feature">\n                <div class="fake-button only-icon-font icon-font-usability-testing inactive" data-show-node="tiny-tooltip">\n                    <span class="tiny-tooltip pro-tooltip">\n                        <small class="pro-label">Pro+</small>\n                        Usability testing is available in Pro+ Plan. <a href="{{upgradePlanURL}}" target="_blank">Upgrade now!</a></a>\n                    </span>\n                </div>\n            </li>\n\n            <!-- Live Share -->\n            <li ng-if="params.isLogged && params.features.live_share && !params.isDocument && params.isOwner">\n                <a ng-click="onConfigureLiveShareSession($event)" class="only-icon-font icon-font-live-share" data-show-node="tiny-tooltip">\n                    <span class="tiny-tooltip">Live Presentation</span>\n                </a>\n            </li>\n            <li ng-if="params.isLogged && params.features.live_share && !params.isDocument && !params.isOwner">\n                <div class="fake-button only-icon-font icon-font-live-share inactive" data-show-node="tiny-tooltip">\n                    <span class="tiny-tooltip">Live Presentation. Only project owner can start session.</span>\n                </div>\n            </li>\n            <li ng-if="params.isLogged && !params.features.live_share" class="plan-feature">\n                <div class="fake-button only-icon-font icon-font-live-share inactive" data-show-node="tiny-tooltip">\n                    <span class="tiny-tooltip pro-tooltip">\n                        <small class="pro-label">Pro+</small>\n                        Live Presentation is available in Pro+ Plan. <a href="#live-share-info" ng-click="onClickPlanUpgrade($event)">See more!</a>\n                    </span>\n                </div>\n            </li>\n            <li ng-if="!params.isLogged && !params.isExport">\n                <div class="fake-button only-icon-font icon-font-live-share inactive" data-show-node="tiny-tooltip">\n                    <span class="tiny-tooltip">Live Presentation. Please log in to create session.</span>\n                </div>\n            </li>\n        </ul>\n\n        <ul ng-if="params.isLogged">\n            <li ng-if="params.currentDocumentURL">\n                <a href="{{params.currentDocumentURL}}" data-show-node="tiny-tooltip" class="only-icon-font icon-font-edit-object">\n                    <span class="tiny-tooltip">Edit document</span>\n                </a>\n            </li>\n            <li>\n                <a href="{{params.dashboardURL}}" data-show-node="tiny-tooltip" class="only-icon-font icon-font-back">\n                    <span class="tiny-tooltip">Back to dashboard</span>\n                </a>\n            </li>\n        </ul>\n    </nav>\n\n    <a ng-click="closeToolbar()" data-show-node="tiny-tooltip" class="close-nav" ng-if="!isUserTestingSession && !isLiveShareSession">\n        <span class="tiny-tooltip">Close main toolbar</span>\n    </a>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/sidebar.view.html",'<script type="text/ng-template" id="sitemap.view.html">\n    <section id="sitemap-panel">\n        <header>\n            <h2>Sitemap</h2>\n            <form action="#" class="search">\n                <label for="pages-list-search" class="icon-font-search only-icon-font" ng-click="onSearchClick($event)">Search</label>\n                <input type="text" placeholder="{{\'INFO_SEARCH_SITEMAP\' | translate}}" id="pages-list-search" ng-class="{\'active\' : searchFor}" ng-model="searchFor" ng-keydown="keyDown($event)" sync-focus-with="focused">\n                <span class="reset-search" ng-click="searchFor=\'\'; focused=false;">Reset search</span>\n            </form>\n        </header>\n        <section class="scrolled-container">\n            <section class="pages-list scrolled-content" ng-class="{\'indent\' : isIndent()}">\n                <ul>\n                    <li ng-repeat="node in tree | filter : filterSearch : comparatorSearch" ng-include="\'node_template.html\'"></li>\n                </ul>\n            </section>\n        </section>\n    </section>\n</script>\n\n<script type="text/ng-template" id="tasks-sitemap.view.html">\n    <input type="radio" class="tab-radio" name="tab" id="tasks-tab" checked>\n    <label for="tasks-tab">Tasks</label>\n\n    <section id="tasks-panel" class="tab-container">\n        <section class="scrolled-container">\n            <section id="tasks-list" class="tasks-list scrolled-content" ng-controller="UsabilityTestTasksController">\n                <ul>\n                    <li class="task-container" ng-repeat="task in params.tasks" ng-class="{\'resolved\': task.resolved}">\n                        <h3><span>Task {{$index + 1}}:</span>{{task.title}}</h3>\n                        <section class="task-body">\n                            <p>{{task.content}}</p>\n\n                            <button class="btn-flat" ng-if="isResolveButton" ng-click="onClickResolveTask($event, task)" ng-disabled="task.resolved">Mark as resolved</button>\n                        </section>\n                    </li>\n                </ul>\n            </section>\n        </section>\n    </section>\n\n    <input ng-if="isSitemapAvailable" type="radio" class="tab-radio" name="tab" id="sitemap-tab">\n    <label ng-if="isSitemapAvailable" for="sitemap-tab">Sitemap</label>\n\n    <section ng-if="isSitemapAvailable" id="sitemap-panel" class="tab-container">\n        <section class="scrolled-container">\n            <section class="pages-list scrolled-content" ng-class="{\'indent\' : isIndent()}">\n                <ul>\n                    <li ng-repeat="node in tree | filter : filterSearch : comparatorSearch" ng-include="\'node_template.html\'"></li>\n                </ul>\n            </section>\n        </section>\n    </section>\n\n    <section ng-show="isHost" class="streaming-video" id="publisher"></section>\n    <section ng-show="isHost" class="streaming-video" id="subscribers">\n        <div class="waiting-for-transmission working" ng-if="isMessageVisible">\n            <p>{{message}}</p>\n        </div>\n    </section>\n</script>\n\n<script type="text/ng-template" id="node_template.html">\n    <a ng-href="" ng-init="init(node.id)" ng-class="{\'active\' : isActive(node.id)}" ng-click="onClick($event,node.id)"><span highlight search-for="searchFor" input-text="getPageName(node.id)"></span></a>\n    <input ng-if="node.nodes.length" type="checkbox" id="{{\'node-\'+node.id}}" ng-model="minimized[node.id]" ng-change="toggleMinimized(node.id)">\n    <label ng-if="node.nodes.length" for="{{\'node-\'+node.id}}"></label>\n    <ul>\n        <li ng-repeat="node in node.nodes | filter : filterSearch : comparatorSearch" ng-include="\'node_template.html\'"></li>\n    </ul>\n</script>\n\n<section class="left-panel"\n         id="tasks-sitemap"\n         ng-controller="SitemapController"\n         ng-include="\'tasks-sitemap.view.html\'"\n         ng-if="isUserTesting">\n</section>\n<section class="left-panel"\n         id="sitemap"\n         ng-controller="SitemapController"\n         ng-include="\'sitemap.view.html\'"\n         ng-if="!isUserTesting">\n</section>\n'),
$templateCache.put("/scripts/libs/uiBootstrapCustom/views/modal/window.view.html",'<section id="modalBoxWrapper" tabindex="-1" role="dialog" class="modal-box" ng-class="{\'visible\': animate}"> <!--ng-click="close($event)"-->\n    <section class="modal-box-wrapper">\n        <a href="#" class="close-modal-button icon-font-close only-icon-font" ng-click="close($event)">Close modal</a>\n        <div modal-transclude></div>\n    </section>\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/appViewPromo/appViewPromo.directive.html",'<section id="install-on-device" class="mobile-overlay" ng-class="{\'is-android\': isAndroid, \'is-ios\': !isAndroid}">\n    <div class="centering-container">\n        <div class="white-cloud" ng-if="!isAndroid">\n            <p>Add prototypes to your Home Screen <br>to view them  without browser toolbars.</p>\n            <p class="instruction">Tap<span class="mobile-share ios-share icon-font-ios-share only-icon-font"></span>then "Add to Home Screen"</p>\n\n            <a ng-click="close()" class="close-overlay only-icon-font icon-font-close">close</a>\n        </div>\n        <div class="white-cloud" ng-if="isAndroid">\n            <p>Add prototypes to your Home Screen <br>to view them  without browser toolbars.</p>\n            <p class="instruction">Tap<span class="mobile-share android-share icon-font-ellipsis only-icon-font"></span>then "Add to Home Screen"</p>\n\n            <a ng-click="close()" class="close-overlay only-icon-font icon-font-close">close</a>\n        </div>\n    </div>\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/mediaAccessTip/mediaAccessTip.directive.html",'<section ng-class="{\'visible\': isTipVisible, \'denied\': isDenied}" class="warning-tooltip access-rights">\n    <p ng-if="!isDenied">UXPin needs access to your microphone and camera to record audio or to embed a camera feed.</p>\n    <p ng-if="isDenied">You have denied access. You are not able to record Usability testing. Change your settings.</p>\n\n    <a ng-click="onClickClose()" class="icon-font-close only-icon-font close-info">close info</a>\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/preview-comment/notify-users.view.html",'<section class="notify-users cloud top-arrow active" click-outside callback="cb()">\n    adsdsad\n    <section class="standard-list-container multi-line-options">\n        <h3>{{\'BTN_NOTIFY\' | translate}} </h3>\n        <span class="selection-trigger">\n            <a href="#">All</a>/\n            <a href="#">None</a>\n        </span>\n        <ul>\n            <li ng-repeat="notification in notifications" class="fake-checkbox dark-style">\n                <input type="checkbox" id="check-{{notification.id}}" ng-model="selected[notification.email]">\n                <label for="check-{{notification.id}}">\n                    <strong>{{notification.name}}</strong>\n                    <small>{{notification.email}}</small>\n                </label>\n            </li>\n        </ul>\n    </section>\n\n    <h3>{{\'BTN_ADD_USER\' | translate}}</h3>\n    <textarea name="" id="" cols="30" rows="3" placeholder="Enter email addresses separated by commas" ng-model="params.emailsCSV" ng-change="onChange();" class="dark-style"></textarea>\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/preview-comment/preview-comment.directive.html",'<article class="single-comment" ng-class="{\'new-comment\' : isNew(), \'reply\' : reply, \'reply-form active\' : replyForm}"> <!-- selected, resolved [active, archived], delete -->\n    <figure class="avatar">\n        <strong ng-if="!avatarUrl">{{avatarInitials}}</strong>\n        <img ng-if="avatarUrl" ng-src="{{avatarUrl}}" alt="">\n    </figure>\n\n    <section class="comment-body" ng-click="newCommentClick($event)">\n        <form ng-show="isNew()">\n            <div\n                parse-mentions\n                comment-id="id"\n                comment-text="text"\n                mentions="mentions"\n                my-sync-focus-with="focused"\n                class="fake-textarea"\n                contenteditable="true"\n                cols="30"\n                rows="10"\n                placeholder="{{\'INFO_FEEDBACK\' | translate}}"\n                ng-class="{\'error\' : isError, \'active\' : isActive}"\n                ng-keyup="keyUp($event)"\n                ng-keydown="keyDown($event)"\n                ng-click="showNotificationPanel(false)"\n                ng-mousedown="onMouseDown($event)"\n                ng-disabled="inputDisabled"\n                ng-focus="focusMe(true, 0);"\n                ng-blur="focusMe(false, 0);"\n            ></div>\n\n            <div\n                ng-if="showMentionsList"\n                ng-style="mentionsListPosition"\n                ng-class="{\'visible\' : showMentionsList}"\n                class="cloud top-arrow mention-cloud"\n                ng-controller="MentionsListController"\n                ng-include="\'mentions-list.view.html\'">\n            </div>\n\n            <section class="notify-users-container" notify-users-container>\n                Send notification to <a ng-href="" ng-mousedown="onMouseDownShowNotificationPanel($event);" toggleable>{{numberOfNotifications}} people</a>.\n                <div\n                    ng-if="notificationPanel"\n                    ng-controller="NotifyUsersController"\n                    ng-include="\'notify-users.view.html\'">\n                </div>\n            </section>\n\n            <section class="submit-menu" ng-if="isNew()">\n                <button class="btn-flat add-comment" ng-mousedown="submitMe($event)" ng-class="{\'working\' : working}">{{\'BTN_ADD_COMMENT\' | translate}}</button>\n                <section class="add-attachement-container">\n                    <label for="attachement-uploader-1" class="btn-flat ghost-style add-attachement"></label>\n                    <input type="file" id="attachement-uploader-1">\n                    <span class="upload-progress"></span>\n                </section>\n            </section>\n        </form>\n        <p>\n            <strong>{{comment.user.name}}: </strong>\n            <span highlight search-for="searchFor" input-text="text"></span>\n        </p>\n    </section>\n\n    <footer class="comment-options" ng-if="!isNew()">\n        <span class="time-stamp">{{commentCreatedAt}}</span>\n        <a ng-href="" class="love-it icon-font-heart-outline" ng-class="{\'active\' : isLoved()}" ng-click="loveMe($event)" title="{{isLoved() ? \'DONT_LOVE_IT\' : \'LOVE_IT\' | translate}}"><span ng-if="comment.lovers.length">{{comment.lovers.length}}</span></a>\n\n        <section class="comment-menu cloud-active icon-font-ellipsis-horizontal">\n            <menu>\n                <li ng-if="!reply"><a ng-href="" class="mark-resolved icon-font-rounded-check only-icon-font" ng-click="resolveMe($event, !comment.resolved.is)" title="{{\'TIP_RESOLVE\' | translate}}">{{comment.resolved.is ? \'BTN_UNRESOLVE\' : \'BTN_RESOLVE\' | translate}}</a></li>\n                <li><a ng-href="" class="delete icon-font-rounded-close-outline only-icon-font" ng-class="{\'inactive\' : !canEdit}" ng-click="deleteMe($event)" title="{{canEdit ? \'TIP_DELETE\' : \'TIP_CANT_DELETE\' | translate}}">{{\'BTN_DELETE\' | translate}}</a></li>\n            </menu>\n        </section>\n\n        <a ng-href="" class="unresolve resolve-info" data-show-node="tooltip" ng-click="resolveMe($event, false)">\n            <span class="tooltip">\n                {{\'RESOLVED_BY\' | translate:\'{"name": comment.resolved.id_user}\'}}\n                <small>{{commentCreatedAt}}</small>\n            </span>\n        </a>\n    </footer>\n\n    <section class="drag-and-drop-upload" ng-if="0">\n\n    </section>\n\n</article>\n'),$templateCache.put("/scripts/modules/core/directives/preview-comment-container/preview-comment-container.directive.html",'<section class="comments-group all-comments-visible"\n         id="group-{{comment ? comment._id : \'new\'}}-{{type}}"\n         ng-class="classes"\n         ng-click="toggle($event)">\n    <!-- {\'selected\' : selected, \'all-comments-visible\' : open, \'resolved active\' : comment.resolved.is && justResolved, \'resolved archived\' : comment.resolved.is && !justResolved, \'delete\' : deleting} -->\n    <preview-comment-group ng-if="isNew()" type="{{type}}" reply comment x="{{x}}" y="{{y}}"></preview-comment-group>\n    <preview-comment-group ng-if="!isNew()" type="{{type}}" reply="selected" comment="comment"></preview-comment-group>\n    <section class="deleting-info" ng-if="deleting">\n        <p>{{\'INFO_DELETED\' | translate}} <a ng-href="" class="undo-delete" ng-click="onClickUndo($event)">{{\'BTN_UNDO\' | translate}}</a></p>\n    </section>\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/preview-comment-group/preview-comment-group.directive.html",'<section>\n    <span ng-if="!isNew() && isGroup()" class="toggle-replies icon-font-arrow only-icon-font" ng-click="onClick($event)">toggle replies</span>\n\n    <preview-comment-panel ng-if="!isNew() && isPanel()" comment="comment"></preview-comment-panel>\n    <preview-comment-panel ng-if="!isNew() && isPanel() && isChildOf(c._id, comment._id) && hasSearchFor(c.comment)" ng-repeat="c in comments track by $index" comment="c" reply="{{reply}}"></preview-comment-panel>\n    <preview-comment-panel ng-if="!isNew() && reply && isPanel()" comment parent-id="{{comment._id}}" reply-form="{{reply}}"></preview-comment-panel>\n\n    <preview-comment-canvas ng-if="isNew() && isCanvas()" comment x="{{x}}" y="{{y}}"></preview-comment-canvas>\n\n    <preview-comment-canvas ng-if="!isNew() && isCanvas()" comment="comment"></preview-comment-canvas>\n    <preview-comment-canvas ng-if="!isNew() && isCanvas() && isChildOf(c._id, comment._id) && hasSearchFor(c.comment)" ng-repeat="c in comments track by $index" comment="c" reply="{{reply}}"></preview-comment-canvas>\n    <preview-comment-canvas ng-if="!isNew() && reply && isCanvas()" comment parent-id="{{comment._id}}" reply-form="{{reply}}"></preview-comment-canvas>\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/preview-pin/preview-pin.directive.html",'<section class="comment-point pin"\n         ng-class="classes"\n         ng-dblclick="onDblclick($event)"\n         ng-style="getCommentPointStyle()">\n    <!-- {\'selected\' : selectedDelayed, \'adding-comment\' : isNew(), \'resolved\' : comment.resolved.is, \'dragging\' : isDragging, \'top\' : isTop, \'bottom\' : !isTop, \'left\' : isLeft, \'right\' : !isLeft, \'hide\': deleting} -->\n    <section class="comment-pin" ng-mousedown="startDrag($event)" ng-mouseup="endDrag($event)" toggleable>{{index}}</section>\n    <!--\n    <section class="comment-area">\n    	<section class="comment-pin">{{index}}</section>\n    </section>\n    -->\n    <preview-comment-container ng-if="selected" type="canvas" comment="comment" x="{{x}}" y="{{y}}"></preview-comment-container>\n</section>\n'),$templateCache.put("/scripts/modules/core/directives/usabilityTestPluginTip/usabilityTestPluginTip.directive.html",'<section ng-class="{\'visible\': isTipVisible}" class="user-testing-record-info">\n    <p>If you want to record the session, <br>please click <strong>"Start recording"</strong> button.</p>\n    <a ng-click="onClickClose()" class="icon-font-close only-icon-font close-info">close info</a>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/liveShare/configuration.view.html",'<section id="live-share-settings" class="modal-box-content">\n    <article>\n        <h2>Live Presentation</h2>\n        <section class="session-settings standard-list-container options-list">\n            <h3>Session settings</h3>\n            <ul>\n                <li class="fake-checkbox dark-gray-style" ng-repeat="option in liveShareOptions">\n                    <input id="initial-config-{{$index}}" ng-model="option.value" type="checkbox" checked>\n                    <label for="initial-config-{{$index}}">{{option.name}}</label>\n                </li>\n            </ul>\n        </section>\n        <h3>Link to session</h3>\n        <div ng-class="{\'working\': !inviteUrl}" class="invite-link-container no-button">\n            <input ng-click="onClickLink($event)" type="text" readonly ng-model="inviteUrl">\n        </div>\n        <button ng-click="start()" class="btn-flat light-blue-style">Start live session</button>\n    </article>\n    <aside>\n\n    </aside>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/liveShare/finish.view.html",'<section class="live-share-landing full-page-landing visible">\n    <div class="centering-block" ng-switch="type">\n        <img src="/img/uxpin-logo.svg" width="150" height="150" class="uxpin-logo" alt="UXPin">\n\n        <h2 translate translate-values="{\'projectName\': projectName}">{{message}}</h2>\n        <a ng-href="#" ng-if="backUrl" ng-click="onClickBackToPreview($event)" class="back-to-preview">{{ \'LS_BACK_TO_PREVIEW\' | translate }}</a>\n    </div>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/liveShare/initialize.view.html",'<section class="live-share-landing full-page-landing with-input visible">\n    <div class="centering-block">\n        <img src="/img/uxpin-logo.svg" width="150" height="150" class="uxpin-logo" alt="UXPin">\n        <section class="progressbar line">\n            <span class="progress" style="width: {{loadingProgress}}%"></span>\n        </section>\n\n        <h2>Loading <strong>{{projectName}}</strong> {{sessionTypeName|translate}}.</h2>\n        <form name="setNameForm" ng-if="loginUrl" ng-submit="onFormSubmit(name)">\n            <fieldset>\n                <p>My name is</p>\n                <input required autofocus type="text" ng-model="name" name="name"><em>*</em>\n                <button ng-disabled="setNameForm.$invalid" type="submit" class="btn-flat light-blue-style" ng-class="{\'working\': working}">That\'s me</button>\n                <small class="tip">* To join {{projectName}} live preview session you need to set your name.</small>\n            </fieldset>\n        </form>\n    </div>\n    <section ng-if="loginUrl" class="login-toolbar bottom-position visible">Are you registered UXPin user? <a href="{{loginUrl}}">Please login</a>.</section>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/planUpgrade/modal.view.html",'<section id="liveshare-dialogbox" class="visible dialogbox-container with-video modal-box-content">\n    <section class="movie-part">\n        <img src="/img/uxpin-logo.svg" width="72" height="72" alt="" class="logo">\n\n        <a ng-click="closeMovie($event)" class="close-movie action-close-movie">{{\'UM_CLOSE_MOVIE\'|translate}}</a>\n\n        <figure class="movie-cover">\n            <img width="394px" height="400px" src="/p/welcome-modal-pic.jpg" alt="">\n        </figure>\n\n        <youtube-video video-id="video.id" player="video.player" class="movie-container"></youtube-video>\n    </section>\n    <section class="content-part">\n        <h2 translate>{{\'UM_MODAL_HEADER\'|translate}}</h2>\n\n        <p>{{\'UM_MODAL_TEXT\'|translate}}</p>\n\n        <a ng-click="closeModal($event)" class="close-modal-button icon-font-close only-icon-font close-movie action-close-movie">{{\'UM_CLOSE_MODAL\'|translate}}</a>\n\n        <a ng-click="playMovie($event)" class="btn-flat dark-style icon-font-play action-close-dialogbox show-me">{{\'UM_HOW_IT_WORKS\'|translate}}</a>\n\n        <p class="small-tip"><span class="pro-label">{{\'UM_PRO_PLUS\'|translate}}</span> {{\'UM_PRO_PLUS_TEXT\'|translate}} <a ng-click="upgradePlan($event)" href="{{upgradePlanURL}}" class="btn-flat ghost-style upgrade-now small-size">{{\'UM_UPGRADE_NOW\'|translate}}</a></p>\n    </section>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/settingsBar/liveShare.view.html",'<li ng-if="isHostSession == true || isUserTestingMode == false" preview-cloud>\n    <a class="live-share-users only-icon-font icon-font-user cursor-follow" preview-cloud-trigger>\n        <span class="tooltip blue-style bottom-arrow">{{isUserTestingMode ? \'UT_USERS\' : \'LS_USERS\' | translate}}</span>\n    </a>\n    <ul class="users-list avatars-only horizontal cloud bottom-arrow collaborators-cloud">\n        <li ng-repeat="collaborator in collaborators">\n            <div class="user avatar" ng-class="{\'muted\' : collaborator.muted}">\n                <strong>{{collaborator.name | limitTo:1 | uppercase}}</strong>\n                <img ng-if="collaborator.customData.avatar" ng-src="{{collaborator.customData.avatar}}" alt="{{collaborator.name}}">\n                <span class="user-color" style="background: {{collaborator.color}};"></span>\n                <span class="mic-off icon-font-mic-off only-icon-font"></span>\n                <span ng-if="isHostSession && collaborator.type !== \'host\'" ng-click="onClickRemoveUser($event, collaborator.id)" class="delete-user icon-font-rounded-close-outline only-icon-font"></span>\n            </div>\n        </li>\n    </ul>\n</li>\n\n<li ng-if="isUserTestingMode == false && isHostSession == false">\n    <a ng-href="#" ng-click="onClickFollowHost($event)" ng-class="{\'active\': host.isFollowed}" style="background-color: {{host.color}};" class="cursor icon-font-cursor-default only-icon-font" data-show-node="tiny-tooltip">\n        <span class="tooltip blue-style bottom-arrow">{{\'LS_FOLLOW_CURSOR\' | translate}}</span>\n    </a>\n</li>\n\n<li ng-if="isHostSession == true" preview-cloud="settingsPanelVisibilityModel">\n    <a ng-click="onClickToggleSettingsPanel($event);" class="only-icon-font icon-font-gear" preview-cloud-trigger>\n        <span ng-if="isUserTestingMode" class="tooltip blue-style bottom-arrow right-float">{{\'UT_SETTINGS\' | translate}}</span>\n        <span ng-if="!isUserTestingMode" class="tooltip blue-style bottom-arrow">{{\'LS_SETTINGS\' | translate}}</span>\n    </a>\n    <div class="cloud bottom-arrow">\n        <section class="standard-list-container session-settings options-list-container">\n            <h3>{{\'LS_SESSION_SETTINGS\' | translate}}:</h3>\n            <ul class="options-list">\n                <li ng-repeat="option in configuration" class="fake-checkbox dark-style">\n                    <input ng-change="setOption(option)" ng-model="option.value" id="live-share-setting-{{$index}}" type="checkbox">\n                    <label for="live-share-setting-{{$index}}">{{option.name}}</label>\n                </li>\n            </ul>\n        </section>\n        <section class="live-share-link">\n            <h3>{{\'LS_LINK_TO_SESSION\' | translate}}</h3>\n            <div class="invite-link-container">\n                <input type="text" ng-click="onClickInut($event)" readonly ng-model="inviteURL" class="url-input dark-style">\n                <button clip-copy="inviteURL" ng-click="onClickCopy($event);" class="copy-link icon-font-link only-icon-font btn-bordered small-size light-blue-style">{{\'LS_COPY\' | translate}}</button>\n                <span class="information" ng-class="{\'visible\': isCopied}">{{\'LS_LINK_HAS_BEEN_COPIED\' | translate}}</span>\n            </div>\n        </section>\n    </div>\n</li>\n\n<li ng-if="isUserTestingMode == false">\n    <a class="mic-off only-icon-font icon-font-mic-off" ng-class="{\'active\' : muted}" ng-click="onClickMute($event)">\n        <span class="tooltip blue-style bottom-arrow">{{\'LS_TOGGLE_MUTE\' | translate}}</span>\n    </a>\n</li>\n\n<li ng-if="isHostSession == true || isUserTestingMode == false">\n    <a ng-click="onClickFinishSession($event)" class="exit-live-share only-icon-font icon-font-close">\n        <span class="tooltip blue-style bottom-arrow">{{\'LS_LEAVE_SESSION\' | translate}}</span>\n    </a>\n</li>\n'),$templateCache.put("/scripts/modules/core/views/settingsBar/preview.view.html",'<!-- Interactions -->\n<li ng-if="!params.isDocument">\n    <a class="only-icon-font icon-font-thunder" ng-click="onClickHighlight($event)">\n        Highlight interactions\n        <span class="tooltip blue-style bottom-arrow">Highlight interactions</span>\n    </a>\n</li>\n\n<!-- Settings -->\n<li ng-if="!params.isUXTestDocument && !params.isExport" class="settings" preview-cloud>\n    <a class="only-icon-font icon-font-gear" preview-cloud-trigger>\n        Settings\n        <span class="tooltip blue-style bottom-arrow">Settings</span>\n    </a>\n    <section class="settings cloud bottom-arrow standard-list-container options-list-container">\n        <h3>Settings</h3>\n        <ul class="options-list">\n            <li class="fake-checkbox dark-style">\n                <input type="checkbox" id="settings-show-comments" ng-model="params.showComments" ng-change="onShowComments()">\n                <label for="settings-show-comments">Show comments</label>\n            </li>\n            <li class="fake-checkbox dark-style">\n                <input type="checkbox" id="settings-show-resolved-comments" ng-model="params.showResolved" ng-change="onShowResolved()">\n                <label for="settings-show-resolved-comments">Show resolved comments</label>\n            </li>\n            <li class="fake-checkbox dark-style" ng-if="!params.isDocument">\n                <input type="checkbox" id="settings-responsive" ng-model="params.isResponsive" ng-change="onResponsive()">\n                <label for="settings-responsive">Auto resize</label>\n            </li>\n        </ul>\n    </section>\n</li>\n\n<!-- Share -->\n<li preview-cloud ng-if="!params.isExport">\n    <a class="only-icon-font icon-font-share" preview-cloud-trigger>\n        Share\n        <span class="tooltip blue-style bottom-arrow">Share</span>\n    </a>\n    <div class="share-settings-cloud cloud bottom-arrow">\n        <section class="standard-list-container share-settings options-list-container">\n            <h3>Share settings:</h3>\n            <div class="invite-link-container">\n                <input type="text" ng-click="selectText($event)" readonly ng-model="shareURL" class="url-input dark-style">\n                <button clip-copy="shareURL" ng-click="onClickCopy($event);" class="copy-link icon-font-link only-icon-font btn-bordered small-size light-blue-style">Copy</button>\n                <span class="information" ng-class="{\'visible\': isCopied}">{{\'LS_LINK_HAS_BEEN_COPIED\' | translate}}</span>\n            </div>\n            <ul class="options-list">\n                <li ng-if="!params.isDocument" class="fake-checkbox dark-style">\n                    <input id="share-settings-sitemap-and-comments" type="checkbox" ng-model="params.includeSitemapComments" ng-change="onShareSettingsChanged()">\n                    <label for="share-settings-sitemap-and-comments">Include sitemap and comments</label>\n                </li>\n                <!--\n                <li class="fake-checkbox dark-style password-option">\n                    <input id="share-settings-password" type="checkbox">\n                    <label for="share-settings-password">Set password for guest...</label>\n                    <form action="" class="password-form">\n                        <input type="text" class="dark-style">\n                        <button class="link-style">Set</button>\n                        <a href="#" class="cancel">Cancel</a>\n                    </form>\n                </li>\n                -->\n            </ul>\n        </section>\n    </div>\n</li>\n'),$templateCache.put("/scripts/modules/core/views/settingsBar/settings.view.html",'<menu id="preview-menu"\n      class="item settings-menu"\n      ng-controller="SettingsBarPreviewController"\n      ng-include="\'/scripts/modules/core/views/settingsBar/preview.view.html\'"\n      ng-if="!isLiveShareSession">\n</menu>\n\n<menu id="live-share-menu"\n      class="item settings-menu"\n      ng-controller="SettingsBarLiveShareController"\n      ng-include="\'/scripts/modules/core/views/settingsBar/liveShare.view.html\'"\n      ng-if="isLiveShareSession">\n</menu>\n'),$templateCache.put("/scripts/modules/core/views/usabilityTest/chromeExtensionDownload.view.html",'<section id="user-testing-plugin" class="modal-box-content" ng-if="isChrome">\n    <article>\n        <h2>UXPin Usability Testing (beta) extension for Chrome</h2>\n\n        <p>If you want to create Usability Testing session, you need to install Chrome extension. <br>Please go to Chrome Web Store to install it.</p>\n\n        <section class="plugin-false" ng-if="!isInstalled">\n            <a ng-click="verifyInstall()" href="https://chrome.google.com/webstore/detail/uxpin-usability-testing-b/bgibmbhbcdfckbcbdkihlclfildbaehc" target="_blank" class="btn-flat">Install extension from Chrome Web Store</a>\n            <a href="{{helpPageURL}}" target="_blank" class="help">Need help with plugin installation?</a>\n        </section>\n\n        <section class="plugin-true" ng-if="isInstalled">\n            <div class="extension-installed">Extension installed!</div>\n            <button class="btn-flat" ng-click="onClickCreateSession($event)">Create usability test</button>\n        </section>\n    </article>\n</section>\n<section id="user-testing-plugin" class="modal-box-content not-avaible" ng-if="!isChrome">\n    <article>\n        <h2>You need Chrome!</h2>\n        <p>Currently UXPin Usability Testing Beta is supported only by Google Chrome browser. You can download Google Chrome browser <a href="https://www.google.com/intl/en/chrome/browser/" target="_blank">here</a>, and Usability Testing plugin <a href="https://chrome.google.com/webstore/detail/uxpin-usability-testing-b/bgibmbhbcdfckbcbdkihlclfildbaehc" target="_blank">here</a>.</p>\n        <p>Enjoy your test!</p>\n    </article>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/usabilityTest/introduction.view.html",'<section id="user-testing-wizard" class="modal-box-content wizard subject-welcome" ng-if="!isActiveStep(4)">\n    <article class="wizard-content">\n        <div class="steps">\n            <section class="step" ng-class="{\'active\': isActiveStep(1)}">\n                <h2>Welcome to <strong>{{params.projectName}}</strong> Usability Testing </h2>\n                <section class="agreement" ng-bind-html="params.introduction"></section>\n                <section class="wizard-pagination">\n                    <div class="fake-checkbox agreement-checkbox">\n                        <input id="agreement" type="checkbox" ng-model="params.agreement">\n                        <label for="agreement">I grant permission to record this session</label>\n                    </div>\n                    <button ng-disabled="!params.agreement" ng-click="onClickNextStep(2)" class="btn-flat next">Next: <b>Tasks</b></button>\n                </section>\n            </section>\n\n            <section class="step" ng-class="{\'active\': isActiveStep(2)}">\n                <h2>Tasks list</h2>\n\n                <ul class="tasks-list" ng-controller="UsabilityTestTasksController">\n                    <li ng-repeat="task in params.tasks">\n                        <h3><span>Task {{$index + 1}}:</span>{{task.title}}</h3>\n                        <p>{{task.content}}</p>\n                    </li>\n                </ul>\n\n                <section class="wizard-pagination">\n                    <button ng-disabled="!params.agreement" ng-click="onClickNextStep(3)" class="btn-flat next">Next: <b>Set camera</b></button>\n                </section>\n            </section>\n\n            <section class="step camera-setup" ng-class="{\'active\': isActiveStep(3)}">\n                <h2>Set your face inside camera area</h2>\n                <section class="camera-access-info icon-font-mic-line-on" ng-class="{\'hidden\' : params.answerVideo}">\n                    <p>Google Chrome needs access to your <strong>microphone</strong> and <strong>camera</strong> <br>to record audio or to embed a camera feed.</p>\n                    <p>Please give access to start recording.</p>\n                </section>\n\n                <section class="camera-access-info icon-font-mic-line-on denied hidden" ng-class="{\'hidden\' : !params.blockVideo}">\n                    <p>You rejected giving media access. Recording usability test wouldn\'t be available.</p>\n\n                    <!-- <p><a href="#">Learn</a> how to enable media access.</p> -->\n                </section>\n\n                <capture-video ng-if="isActiveStep(3)" width="750" height="250"></capture-video>\n\n                <section class="wizard-pagination">\n                    Ready? <button ng-disabled="!params.answerVideo" ng-click="onClickStartSession()" class="btn-flat next">Start session!</button>\n                </section>\n            </section>\n        </div>\n    </article>\n</section>\n'),$templateCache.put("/scripts/modules/core/views/usabilityTest/pluginConfirm.view.html",""),$templateCache.put("/scripts/modules/core/views/usabilityTest/wizard.view.html",'<section id="user-testing-wizard" class="modal-box-content wizard">\n    <article ng-if="!isActiveStep(4)">\n        <h2>Create usability test: {{params.projectName}}</h2>\n\n        <ul class="wizard-breadcrumbs">\n            <li ng-repeat="step in getStepsWithBreadcrumbs()" ng-class="{\'active\': isActiveStep($index), \'completed\': $index < params.activeStepIndex}">\n                <span class="step-count">{{$index+1}}</span>\n                <span class="step-label">{{step.label}}</span>\n            </li>\n        </ul>\n\n        <section class="wizard-content" id="wizard-content">\n            <div novalidation class="step step-1" ng-class="{\'active\': isActiveStep(0)}" ng-form="forms.step0">\n                <textarea required ng-model="params.steps[0].introduction"></textarea>\n            </div>\n\n            <section class="step step-2" ng-class="{\'active\': isActiveStep(1)}" ng-form="forms.step1">\n                <ul>\n                    <li class="task-container" ng-repeat="task in getStep(1).tasks" ng-class="{\'visible\': !task.deleting}">\n                        <header class="title">\n                            <label for="task-{{$index}}">Task {{$index + 1}}:</label>\n                            <input required type="text" id="task-{{$index}}" ng-model="task.title">\n                            <a ng-href="#" ng-click="onClickDeleteTask($event, $index)" class="icon-font-trash only-icon-font delete"><span class="tooltip small-style">Delete this task</span></a>\n                        </header>\n                        <textarea required ng-model="task.content"></textarea>\n                    </li>\n                    <li class="task-container visible">\n                        <header class="title">\n                            <label for="new-task-title">Task {{getStep(1).tasks.length + 1}}:</label>\n                            <input required autofocus type="text" id="new-task-title" ng-model="getStep(1).newTask.title" placeholder="Enter task name">\n                            <a ng-if="getStep(1).tasks.length || getStep(1).newTask.title || getStep(1).newTask.content" ng-href="#" ng-click="onClickDeleteTask($event)" class="icon-font-trash only-icon-font delete"><span class="tooltip small-style">Delete this task</span></a>\n                        </header>\n                        <textarea required ng-model="getStep(1).newTask.content" placeholder="Enter task description"></textarea>\n                    </li>\n                </ul>\n            </section>\n\n            <section class="step step-3" ng-class="{\'active\': isActiveStep(2)}" ng-form="forms.step2">\n                <section class="standard-list-container options-list-container">\n                    <ul>\n                        <li class="fake-checkbox" ng-repeat="option in getStep(2).options">\n                            <input id="option-{{$index}}" type="checkbox" ng-model="option.value">\n                            <label for="option-{{$index}}">{{option.name}}</label>\n                        </li>\n                        <li class="fake-checkbox" >\n                            <input id="breakpoint-enable-option" type="checkbox" ng-model="getStep(2).breakpoints.enabled">\n                            <label for="breakpoint-enable-option">{{getStep(2).breakpoints.name}}</label>\n                        </li>\n                    </ul>\n                    <ul class="breakpoints-list">\n                        <li class="fake-checkbox" ng-repeat="breakpoint in getStep(2).breakpoints.list" ng-class="{\'inactive\': !getStep(2).breakpoints.enabled}">\n                            <input id="breakpoint-option-{{$index}}" ng-disabled="!getStep(2).breakpoints.enabled" type="checkbox" ng-model="breakpoint.value">\n                            <label for="breakpoint-option-{{$index}}" ng-bind-html="breakpoint.name"></label>\n                        </li>\n                    </ul>\n                </section>\n            </section>\n\n            <div class="step step-4" ng-class="{\'active\': isActiveStep(3)}" ng-form="forms.step3">\n                <label for="invite-link">Invite by sending a link</label>\n                <div class="invite-link-container no-button" ng-class="{\'working\': !getStep(3).inviteURL}">\n                    <input type="text" readonly id="invite-link" ng-click="onClickInput($event)" ng-model="getStep(3).inviteURL" class="url-input">\n                    <button clip-copy="getStep(3).inviteURL" ng-click="onClickCopy($event);" class="copy-link icon-font-link only-icon-font btn-bordered small-size light-gray-style">{{\'LS_COPY\' | translate}}</button>\n                    <span class="information" ng-class="{\'visible\': params.isCopied}">{{\'LS_LINK_HAS_BEEN_COPIED\' | translate}}</span>\n                </div>\n            </div>\n        </section>\n\n        <section class="wizard-pagination">\n            <button class="btn-flat ghost-style prev"\n                    ng-if="params.activeStepIndex > 0"\n                    ng-click="onClickPrevStep()">\n                Back to: {{getStep(\'prev\').label}}\n            </button>\n\n            <button class="btn-flat next"\n                    ng-if="params.activeStepIndex < params.steps.length - 1"\n                    ng-disabled="getStepFormObject().$invalid"\n                    ng-click="onClickNextStep()">\n                <strong>Next:</strong> {{getStep(\'next\').label}}\n            </button>\n\n			<button class="fake-link icon-font-plus add-task"\n			   ng-if="params.activeStepIndex == 1"\n			   ng-disabled="getStepFormObject().$invalid"\n			   ng-click="onClickAddNewTask(params.steps[1].newTask)">\n                Add another task\n            </button>\n        </section>\n\n    </article>\n\n    <article class="final-step" ng-if="isActiveStep(4)">\n        <h2>Usability testing is ready to be launched!</h2>\n        <button ng-class="{\'waiting\': params.loading}" class="btn-flat light-blue-style huge-size" ng-click="onClickSessionStart()">Start session!</button>\n    </article>\n</section>\n');
}]),angular.module("core").controller("AppViewPromoController",["$rootScope","$scope","localStorageService","deviceDetectorHelper",function($rootScope,$scope,localStorageService,deviceDetectorHelper){"use strict";$scope.isAndroid="Android"===deviceDetectorHelper.getOS().name,localStorageService.set(PreviewEnums.APP_VIEW_PROMO_VIEWED,1),$scope.close=function(){$rootScope.$emit(PreviewEnums.ON_APP_VIEW_PROMO_CLOSE)}}]),angular.module("core").directive("appViewPromo",[function(){"use strict";return{restrict:"E",replace:!0,scope:!0,controller:"AppViewPromoController",templateUrl:"/scripts/modules/core/directives/appViewPromo/appViewPromo.directive.html"}}]),angular.module("core").controller("MediaAccessTipController",["$rootScope","$scope",function($rootScope,$scope){"use strict";$scope.isTipVisible=!1,$scope.isDenied=!1;var showTip=function(){$scope.isTipVisible=!0},hideTip=function(){$scope.isTipVisible=!1},isTipOpen=function(){return $scope.isTipVisible};$scope.onClickClose=function(){hideTip()};var onMediaAccess=$rootScope.$on(PreviewEnums.MEDIA_ACCESS,function(e,value){switch(value){case PreviewEnums.MEDIA_ACCESS_TYPE.REQUEST:showTip();break;case PreviewEnums.MEDIA_ACCESS_TYPE.ALLOWED:hideTip();break;case PreviewEnums.MEDIA_ACCESS_TYPE.DENIED:$scope.$apply(function(){$scope.isDenied=!0}),isTipOpen()||showTip()}});$scope.$on("destroy",function(){onMediaAccess()})}]),angular.module("core").directive("mediaAccessTip",[function(){"use strict";return{restrict:"E",replace:!0,scope:!0,controller:"MediaAccessTipController",templateUrl:"/scripts/modules/core/directives/mediaAccessTip/mediaAccessTip.directive.html"}}]),angular.module("core").controller("NotifyUsersContainerController",["_","$rootScope","$scope","$controller",function(_,$rootScope,$scope,$controller){"use strict";$controller("PreviewCommentAbstractController",{$scope:$scope}),$scope.isOpen=function(){return $scope.notificationPanel},$scope.hide=function(){$scope.showNotificationPanel(!1)},$scope.toggle=function(){}}]),angular.module("core").directive("notifyUsersContainer",[function(){"use strict";var link=function(scope,element,attrs){scope.toggleElement=function(){return element[0].querySelector(".notify-users")}};return{restrict:"A",controller:"NotifyUsersContainerController",link:link}}]),angular.module("core").controller("MentionsListController",["_","$rootScope","$scope","$timeout","UsersService",function(_,$rootScope,$scope,$timeout,UsersService){"use strict";var search="";$scope.collaborators=null,$scope.selected=null,$scope.$on("$destroy",function(){selectMentionsList(),searchMentionsList()}),$scope.onMouseDown=function(e,collaborator){$scope.showMentionsList=!1,$rootScope.$emit(PreviewEnums.ON_SELECT_MENTIONS_LIST,$scope.id,collaborator)};var selectMentionsList=$rootScope.$on(PreviewEnums.SELECT_MENTIONS_LIST,function(e,id,which){if(id===$scope.id)if(13===which){var collaborator=getSelectedCollaborator();collaborator?$rootScope.$emit(PreviewEnums.ON_SELECT_MENTIONS_LIST,$scope.id,collaborator):$rootScope.$emit(PreviewEnums.ON_HIDE_MENTIONS_LIST,$scope.id)}else 38===which?selectCollaborator($scope.collaborators.indexOf(getSelectedCollaborator())-1):40===which&&selectCollaborator($scope.collaborators.indexOf(getSelectedCollaborator())+1)}),searchMentionsList=$rootScope.$on(PreviewEnums.SEARCH_MENTIONS_LIST,function(e,id,str){id===$scope.id&&str!==search&&(search=str,init())}),getSelectedCollaborator=function(){return _.first(_.filter($scope.collaborators,{email:$scope.selected}))},selectCollaborator=function(index){var length=$scope.collaborators.length;0>index?index=length-1:index>=length&&(index=0),$scope.selected=length?$scope.collaborators[index].email:null},update=function(){""!==search?($scope.collaborators=_.filter(_.toArray(UsersService.collaboratorsMap),function(collaborator){return-1!==collaborator.name.trim().toLowerCase().indexOf(search.replace(/&nbsp;/g," ").trim().toLowerCase())}).sort(function(a,b){var a_starts_with_search=0===a.name.toLowerCase().indexOf(search.toLowerCase()),b_starts_with_search=0===b.name.toLowerCase().indexOf(search.toLowerCase());return a_starts_with_search&&!b_starts_with_search?-1:!a_starts_with_search&&b_starts_with_search?1:a.name<b.name?-1:a.name>b.name?1:0}),getSelectedCollaborator()||selectCollaborator(0)):$scope.collaborators=_.toArray(UsersService.collaboratorsMap)},init=function(){update(),selectCollaborator(0)};init()}]),angular.module("core").controller("NotifyUsersController",["_","$rootScope","$scope","$timeout","UsersService","NotificationsService","CommentsHelper","NotificationsHelper","ValidationHelper",function(_,$rootScope,$scope,$timeout,UsersService,NotificationsService,CommentsHelper,NotificationsHelper,ValidationHelper){"use strict";var initialSelected,initialNotifications,initialEmails,container;$scope.params={emailsCSV:"",isAll:!1,isNone:!1},$scope.$on("$destroy",function(){onKeyDown(),$scope.parentId?$scope.isNotificationsEmpty?NotificationsHelper.getNumberOfSelectedNotifications($scope.selected)>0?NotificationsService.addToNotifications(NotificationsHelper.getAddedNotifications({},$scope.selected),$scope.parentId).then(onUpdate):NotificationsService.addToNotifications([],$scope.parentId,!0).then(onUpdate):(NotificationsService.addToNotifications(NotificationsHelper.getAddedNotifications(initialSelected,$scope.selected),$scope.parentId).then(onUpdate),NotificationsService.removeFromNotificationList(NotificationsHelper.getRemovedNotifications(initialSelected,$scope.selected),$scope.parentId).then(onUpdate)):onUpdate($scope.notifications)});var getEmails=function(notifications){return _.map(notifications,function(notification){return notification.email})},updateAllNone=function(){$scope.params.isAll=NotificationsHelper.getNumberOfSelectedNotifications($scope.selected)===_.size($scope.notifications),$scope.params.isNone=!NotificationsHelper.getNumberOfSelectedNotifications($scope.selected)};$scope.selectAll=function(){_.forEach($scope.notifications,function(notification){$scope.selected[notification.email]=!0}),updateAllNone(),$scope.isNew()&&NotificationsHelper.rememberSelection($scope.selected)},$scope.selectNone=function(){_.forEach($scope.notifications,function(notification){$scope.selected[notification.email]=!1}),updateAllNone(),$scope.isNew()&&NotificationsHelper.rememberSelection($scope.selected)},$scope.onChange=function(){updateAllNone(),$scope.isNew()&&NotificationsHelper.rememberSelection($scope.selected)},$scope.onKeyDown=function(e){e.stopPropagation()},$scope.onChangeCustomEmails=function(){var em,emails=_.uniq(_.without(_.map($scope.params.emailsCSV.split(","),function(email){return em=email.trim().toLowerCase(),ValidationHelper.isEmail(em)?em:null}),null)),length=$scope.notifications.length;$scope.notifications=_.union(initialNotifications,_.map(_.filter(emails,function(email){return-1===initialEmails.indexOf(email)}),function(email){return NotificationsHelper.getNotificationObjectForEmail(email)})),length!==$scope.notifications.length&&$timeout(function(){container.scrollTop=container.scrollHeight},0),updateAllNone()},$scope.isOpen=function(){return $scope.notificationPanel},$scope.hide=function(){$scope.showNotificationPanel(!1)},$scope.toggle=function(){};var onUpdate=function(notification){$rootScope.$emit(PreviewEnums.ON_CHANGE_NOTIFICATIONS,$scope.parentId,notification)},init=function(){initialNotifications=_.clone($scope.notifications),initialEmails=getEmails(initialNotifications),initialSelected=_.clone($scope.selected),$timeout(function(){container=document.querySelector("section.notify-users > section.standard-list-container > ul")},0),updateAllNone()},onKeyDown=$rootScope.$on("keyDown",function(e,kE){27!==kE.which&&13!==kE.which||$scope.showNotificationPanel(!1)});init()}]),angular.module("core").controller("PreviewCommentCanvasController",["$rootScope","$scope","$controller","CommentsService",function($rootScope,$scope,$controller,CommentsService){"use strict";if($controller("PreviewCommentAbstractController",{$scope:$scope}),$scope.type="canvas",$scope.onResolved=function(value){value&&$rootScope.$emit(PreviewEnums.SELECT_COMMENT,null)},$scope.isNew()){$scope.$on("$destroy",function(){onAddingComment()});var onAddingComment=$rootScope.$on(PreviewEnums.ADDING_COMMENT,function(e,value){$scope.focusMe(value,100)});$scope.parentId||$scope.focusMe(!0,300)}}]),angular.module("core").directive("previewCommentCanvas",[function(){"use strict";var link=function(scope,element,attrs){};return{restrict:"E",replace:!0,scope:{comment:"=",parentId:"@",reply:"@",replyForm:"@",x:"@",y:"@"},controller:"PreviewCommentCanvasController",templateUrl:"/scripts/modules/core/directives/preview-comment/preview-comment.directive.html",link:link}}]),angular.module("core").controller("PreviewCommentPanelController",["$rootScope","$scope","$controller","CommentsService",function($rootScope,$scope,$controller,CommentsService){"use strict";if($controller("PreviewCommentAbstractController",{$scope:$scope}),$scope.type="panel",$scope.searchFor=CommentsService.searchFor,$scope.onResolved=function(value){},!$scope.isNew()){$scope.$on("$destroy",function(){onSearchComments()});var onSearchComments=$rootScope.$on("searchComments",function(e){$scope.searchFor=CommentsService.searchFor})}}]),angular.module("core").directive("previewCommentPanel",[function(){"use strict";var link=function(scope,element,attrs){};return{restrict:"E",replace:!0,scope:{comment:"=",parentId:"@",reply:"@",replyForm:"@",x:"@",y:"@"},controller:"PreviewCommentPanelController",templateUrl:"/scripts/modules/core/directives/preview-comment/preview-comment.directive.html",link:link}}]),angular.module("core").controller("PreviewCommentAbstractController",["$rootScope","$scope","$state","$timeout","$filter","ProjectsService","PagesService","DocumentsService","CommentsService","UsersService","NotificationsService","NotificationsHelper","CommentsHelper",function($rootScope,$scope,$state,$timeout,$filter,ProjectsService,PagesService,DocumentsService,CommentsService,UsersService,NotificationsService,NotificationsHelper,CommentsHelper){"use strict";$scope.id="comment-"+MD5((new Date).getTime()),$scope.type=null,$scope.working=!1,$scope.focused=!1,$scope.isActive=!1,$scope.isReplying=!1,$scope.isError=!1,$scope.inputDisabled=!1,$scope.avatarUrl=null,$scope.avatarInitials=null,$scope.notificationPanel=!1,$scope.textElements={},$scope.showMentionsList=!1,$scope.mentionsListPosition=null,$scope.mentions={},$scope.focusMe=function(value,delay){value?$scope.isError=!1:$scope.showMentionsList&&$rootScope.$emit(PreviewEnums.ON_HIDE_MENTIONS_LIST,$scope.id),$scope.isActive=value,delay>0?$timeout(function(){$scope.focused=value},delay):$scope.focused=value},$scope.submitMe=function(e){e&&e.stopPropagation(),$scope.working||validate()&&($scope.working=!0,CommentsService.addComment(getCommentProperties()).then(function(comment){"function"==typeof window.Intercom&&window.Intercom("trackEvent","Added comment on preview"),$scope.working=!1,$scope.reset(),comment._parent_comment||(CommentsService.selectedCommentId=comment._id)},function(error){$scope.working=!1}))},$scope.loveMe=function(e){e.stopPropagation(),CommentsService.updateComment($scope.comment._id,{is_loved:!$scope.isLoved()})},$scope.replyMe=function(e){e.stopPropagation();var id=$scope.comment._parent_comment?$scope.comment._parent_comment:$scope.comment._id;$rootScope.$emit(PreviewEnums.REPLYING_COMMENT,id,$scope.type,!$scope.isReplying)},$scope.resolveMe=function(e,value){e.stopPropagation(),CommentsService.updateComment($scope.comment._id,{is_resolved:value}).then(function(comment){$scope.onResolved(comment.resolved.is)})},$scope.onResolved=function(value){},$scope.deleteMe=function(e){e&&e.stopPropagation(),CommentsService.canEdit($scope.comment)&&($state.includes("**.panel.**")&&!$scope.comment._parent_comment?$rootScope.$emit(PreviewEnums.DELETING_COMMENT,$scope.comment._id,!0):CommentsService.deleteComment($scope.comment._id))},$scope.update=function(comment){var text;text=CommentsHelper.encodeMentions(comment.comment),text=$filter("linky")(text,"_blank"),text=CommentsHelper.decodeMentions(text),text=$filter("simpleMarkdown")(text),$scope.text=text},$scope.reset=function(){$scope.text=""},$scope.isNew=function(){return void 0===$scope.comment},$scope.isGroupReplyForm=function(){return"true"===$scope.replyForm},$scope.isLoved=function(){return!$scope.isNew()&&CommentsService.isLoved($scope.comment)},$scope.isGroup=function(){return!$scope.isNew()&&!$scope.comment._parent_comment&&CommentsService.isGroup($scope.comment._id)},$scope.getGroupLength=function(){return CommentsService.commentsTree[$scope.comment._id].length},$scope.$on("$destroy",function(){$scope.isNew()?(onSetAnonymousName(),onChangeNotifications(),onShowMentionsList(),onHideMentionsList(),onUpdateMentionsListPosition(),onSelectMentionsList()):onReplyingComment()});var getCommentProperties=function(){var properties={project_hash:ProjectsService.currentProjectHash,comment:$scope.text,position:{x:$scope.x,y:$scope.y},notify:NotificationsHelper.formatNotify(NotificationsHelper.getAddedNotifications({},$scope.selected),$scope.mentions),collaborators_all:UsersService.collaboratorEmails.length};return ProjectsService.isDocument()?$scope.parentId?(properties.id_document=CommentsService.commentsMap[$scope.parentId].id_document,properties._parent_comment=$scope.parentId):properties.id_document=DocumentsService.currentDocumentId:$scope.parentId?(properties.id_page=CommentsService.commentsMap[$scope.parentId].id_page,properties._parent_comment=$scope.parentId):properties.id_page=PagesService.currentPageId,UsersService.isAnonymous()&&(properties.user={name:UsersService.me.name}),properties},validate=function(){return $scope.isError=!$scope.text,!$scope.isError},onKeyDownEnter=function(e){e.preventDefault(),$scope.showMentionsList?$rootScope.$emit(PreviewEnums.SELECT_MENTIONS_LIST,$scope.id,e.which):$scope.submitMe()},onKeyDownEsc=function(e){$scope.showMentionsList?$rootScope.$emit(PreviewEnums.ON_HIDE_MENTIONS_LIST,$scope.id):$scope.isGroupReplyForm()?$scope.focusMe(!1,100):$rootScope.$emit(PreviewEnums.SELECT_COMMENT,null)},onKeyDownArrowUp=function(e){$scope.showMentionsList&&(e.preventDefault(),$rootScope.$emit(PreviewEnums.SELECT_MENTIONS_LIST,$scope.id,e.which))},onKeyDownArrowDown=function(e){$scope.showMentionsList&&(e.preventDefault(),$rootScope.$emit(PreviewEnums.SELECT_MENTIONS_LIST,$scope.id,e.which))},onKeyDown=function(e){e.stopPropagation(),$scope.isError=!1,13!==e.which||e.shiftKey?27===e.which?onKeyDownEsc(e):38===e.which?onKeyDownArrowUp(e):40===e.which&&onKeyDownArrowDown(e):onKeyDownEnter(e)},getAvatarInitials=function(name){var i=name.split(" ");return(i[0][0]+(i.length>1?i[1][0]:"")).toUpperCase()};if($scope.isNew()){var updateNotifications=function(){NotificationsService.getNotifications().then(function(notifications){$scope.notifications=NotificationsHelper.getNotificationsForComment($scope.parentId,UsersService.collaboratorsMap,UsersService.collaboratorEmails,NotificationsService.notificationsMap),$scope.selected=NotificationsHelper.getSelectedMapForComment($scope.parentId,UsersService.collaboratorsMap,NotificationsService.notificationsMap),$scope.numberOfNotifications=NotificationsHelper.getNumberOfSelectedNotifications($scope.selected),$scope.isNotificationsEmpty=$scope.parentId?!NotificationsService.notificationsMap[$scope.parentId]:!1})};$scope.setActive=function(value){$scope.isActive=value||$scope.notificationPanel||$scope.text||$scope.isError},$scope.newCommentClick=function(e){e.stopPropagation()},$scope.onMouseDown=function(e){e.stopPropagation(),$scope.isError=!1,$scope.focused=!0,$scope.parentId&&$rootScope.$emit(PreviewEnums.OPEN_GROUP,$scope.parentId,$scope.type,!0),UsersService.isAnonymous()&&!UsersService.isAnonymousNameSet()&&($scope.inputDisabled=!0,$scope.focusMe(!1,1),$rootScope.$emit(PreviewEnums.ANONYMOUS_ADD_COMMENT))};var onChangeNotifications=$rootScope.$on(PreviewEnums.ON_CHANGE_NOTIFICATIONS,function(e,commentId,notification){commentId&&$scope.parentId===commentId?($scope.isNotificationsEmpty=!1,$scope.numberOfNotifications=notification.emails.length,$scope.notifications=NotificationsHelper.getNotificationsForComment($scope.parentId,UsersService.collaboratorsMap,UsersService.collaboratorEmails,NotificationsService.notificationsMap),$scope.selected=NotificationsHelper.getSelectedMapForComment($scope.parentId,UsersService.collaboratorsMap,NotificationsService.notificationsMap)):($scope.notifications=notification,$scope.numberOfNotifications=NotificationsHelper.getNumberOfSelectedNotifications($scope.selected))}),onShowMentionsList=$rootScope.$on(PreviewEnums.ON_SHOW_MENTIONS_LIST,function(e,id,position){id===$scope.id&&($scope.showMentionsList=!0,$scope.mentionsListPosition=position)}),onHideMentionsList=$rootScope.$on(PreviewEnums.ON_HIDE_MENTIONS_LIST,function(e,id){id===$scope.id&&($scope.showMentionsList=!1,$scope.mentionsListPosition=null)}),onSelectMentionsList=$rootScope.$on(PreviewEnums.ON_SELECT_MENTIONS_LIST,function(e,id,collaborator){id===$scope.id&&($scope.focusMe(!0,1),$scope.showMentionsList=!1,$scope.mentionsListPosition=null)}),onUpdateMentionsListPosition=$rootScope.$on(PreviewEnums.ON_UPDATE_MENTIONS_LIST_POSITION,function(e,id,position){id===$scope.id&&($scope.mentionsListPosition=position)}),onSetAnonymousName=$rootScope.$on(PreviewEnums.SET_ANONYMOUS_NAME,function(e,name){$scope.inputDisabled=!1,name&&$scope.focusMe(!0,1)});$scope.showNotificationPanel=function(value){$scope.notificationPanel=value,CommentsService.selectedCommentShowNotificationPanel=value,value?$timeout(function(){$scope.setActive(value)},0):$scope.focusMe(!value,1)},$scope.onMouseDownShowNotificationPanel=function(e){$scope.showNotificationPanel(!$scope.notificationPanel)},$scope.onClickShowNotificationPanel=function(e){e.stopPropagation()},$scope.avatarUrl=UsersService.me.avatar,$scope.avatarInitials=getAvatarInitials(UsersService.me.name),$scope.keyDown=onKeyDown,updateNotifications()}else{$scope.onOpenGroupClick=function(e){e.stopPropagation(),$rootScope.$emit(PreviewEnums.OPEN_GROUP,$scope.comment._id,$scope.type)};var onReplyingComment=$rootScope.$on(PreviewEnums.REPLYING_COMMENT,function(e,id,type,isReplying){$scope.comment._id!==id&&$scope.comment._parent_comment!==id||$scope.type!==type||($scope.isReplying=isReplying)});$scope.avatarUrl=$scope.comment.user.avatar,$scope.avatarInitials=getAvatarInitials($scope.comment.user.name),$scope.commentCreatedAt=moment($scope.comment.created_at).fromNow(),$scope.canEdit=CommentsService.canEdit($scope.comment),CommentsService.getComment($scope.comment._id).then(function(comment){$scope.update(comment)})}}]),angular.module("core").controller("PreviewCommentContainerController",["$rootScope","$scope","$timeout","CommentsService","UsersService",function($rootScope,$scope,$timeout,CommentsService,UsersService){"use strict";$scope.isPanel=function(){return"panel"===$scope.type},$scope.isCanvas=function(){return"canvas"===$scope.type},$scope.isNew=function(){return void 0===$scope.comment},$scope.toggle=function(){},$scope.hide=function(){$rootScope.$emit(PreviewEnums.SELECT_COMMENT,null)},$scope.isOpen=function(){return $scope.selected};var deletingTimeout=null;if($scope.open=!$scope.isNew()&&CommentsService.checkGroupToOpen($scope.comment._id),$scope.selected=!$scope.isNew()&&CommentsService.selectedCommentId===$scope.comment._id,$scope.justResolved=!1,$scope.deleting=!1,$scope.deleted=!1,$scope.classes=[],!$scope.isNew()){$scope.$on("$destroy",function(){onSelectComment(),onAddComment(),onReplyingComment(),onOpenGroup(),onKeyDown&&onKeyDown(),onResolveComment&&onResolveComment(),onDeletingComment&&onDeletingComment()});var onReplyingComment=$rootScope.$on(PreviewEnums.REPLYING_COMMENT,function(e,id,type,isReplying){$scope.comment._id===id&&type===$scope.type&&($scope.selected=isReplying,isReplying&&($scope.open=isReplying),updateClasses())}),onAddComment=$rootScope.$on(PreviewEnums.ADD_COMMENT,function(e,id,parentId){$scope.selected&&$scope.comment._id===parentId,$scope.comment._id===parentId&&($scope.open=!0,updateClasses())}),onSelectComment=$rootScope.$on(PreviewEnums.SELECT_COMMENT,function(e,id,type){$scope.selected&&$scope.comment._id!==id&&($scope.selected=!1,updateClasses()),$scope.selected||$scope.comment._id!==id||($scope.selected=!0,updateClasses())}),onOpenGroup=$rootScope.$on(PreviewEnums.OPEN_GROUP,function(e,id,type,value){$scope.comment._id===id&&$scope.type===type&&(void 0===value?$scope.open=!$scope.open:$scope.open=value,updateClasses())}),updateClasses=function(){$scope.isNew()||(setClass("selected",$scope.selected),setClass("all-comments-visible",$scope.open),setClass("resolved",$scope.comment.resolved.is),setClass("active",$scope.comment.resolved.is&&$scope.justResolved),setClass("archived",$scope.comment.resolved.is&&!$scope.justResolved),setClass("delete",$scope.deleting||$scope.deleted),setClass("hide",$scope.deleted))},setClass=function(className,value){var index=$scope.classes.indexOf(className);value&&-1===index?$scope.classes.push(className):value||-1===index||$scope.classes.splice(index,1)};if($scope.isPanel()){$scope.toggle=function(e){$rootScope.$emit(PreviewEnums.SELECT_COMMENT,$scope.selected?null:$scope.comment._id,$scope.type)};var onResolved=function(value){var SHOW_RESOLVED_TIMEOUT=5e3;value?($scope.justResolved=!0,updateClasses(),$timeout(function(){$scope.justResolved=!1,updateClasses()},SHOW_RESOLVED_TIMEOUT),$scope.selected&&$rootScope.$emit(PreviewEnums.SELECT_COMMENT,null)):updateClasses()},onClickUndo=function(e){e.stopPropagation(),deletingTimeout&&($timeout.cancel(deletingTimeout),deletingTimeout=null,$scope.onClickUndo=null,$scope.deleting=!1,updateClasses(),$rootScope.$emit(PreviewEnums.DELETING_COMMENT,$scope.comment._id,!1))},onDeletingComment=$rootScope.$on(PreviewEnums.DELETING_COMMENT,function(e,id,value){if($scope.comment._id===id&&value){$scope.onClickUndo=onClickUndo,$scope.deleting=!0,$scope.selected=!1,updateClasses();var UNDO_TIMEOUT=3e3;deletingTimeout=$timeout(function(){$scope.onClickUndo=null,$scope.deleting=!1,$scope.deleted=!0,updateClasses(),$timeout(function(){CommentsService.deleteComment($scope.comment._id)},0)},UNDO_TIMEOUT)}}),onKeyDown=$rootScope.$on("keyDown",function(e,kE){if($scope.selected&&8===kE.which){if($scope.comment.user.id!==UsersService.me.id_user)return;$rootScope.$emit(PreviewEnums.DELETING_COMMENT,$scope.comment._id,!0)}}),onResolveComment=$rootScope.$on(PreviewEnums.RESOLVE_COMMENT,function(e,id,value){$scope.comment._id===id&&onResolved(value)})}updateClasses()}}]),angular.module("core").directive("previewCommentContainer",[function(){"use strict";var link=function(scope,element,attrs){};return{restrict:"E",replace:!0,scope:{comment:"=",type:"@",x:"@",y:"@"},controller:"PreviewCommentContainerController",templateUrl:"/scripts/modules/core/directives/preview-comment-container/preview-comment-container.directive.html",link:link}}]),angular.module("core").controller("PreviewCommentGroupController",["$rootScope","$scope","CommentsService",function($rootScope,$scope,CommentsService){"use strict";if($scope.searchFor=CommentsService.searchFor,$scope.isNew=function(){return void 0===$scope.comment},$scope.isGroup=function(){return $scope.comment&&CommentsService.isGroup($scope.comment._id)},$scope.isPanel=function(){return"panel"===$scope.type},$scope.isCanvas=function(){return"canvas"===$scope.type},$scope.isChildOf=function(childId,parentId){var children=CommentsService.commentsTree[parentId];return children&&-1!==children.indexOf(childId)},$scope.hasSearchFor=function(text){return""===$scope.searchFor?!0:-1!==text.toLocaleLowerCase().indexOf($scope.searchFor)},$scope.getCheckboxId=function(){return $scope.comment._id+"-"+$scope.type},$scope.onClick=function(e){e.stopPropagation(),$rootScope.$emit(PreviewEnums.OPEN_GROUP,$scope.comment._id,$scope.type)},!$scope.isNew()){$scope.$on("$destroy",function(){onOpen(),onSearchComments()});var onOpen=$scope.$watch("open",function(currentValue,previousValue){!currentValue&&previousValue&&$scope.reply&&($scope.reply=!1,$rootScope.$emit(PreviewEnums.REPLYING_COMMENT,$scope.comment._id,$scope.type,$scope.reply))}),onSearchComments=$rootScope.$on("searchComments",function(e){$scope.searchFor=CommentsService.searchFor});CommentsService.getComments().then(function(comments){$scope.comments=comments})}}]),angular.module("core").directive("previewCommentGroup",[function(){"use strict";var link=function(scope,element,attrs){};return{restrict:"E",replace:!0,scope:{comment:"=",reply:"=",type:"@",x:"@",y:"@"},controller:"PreviewCommentGroupController",templateUrl:"/scripts/modules/core/directives/preview-comment-group/preview-comment-group.directive.html",link:link}}]),angular.module("core").controller("PreviewPinController",["$rootScope","$scope","$document","$timeout","CommentsService","PagesService","DocumentsService","ProjectsService","DOMService",function($rootScope,$scope,$document,$timeout,CommentsService,PagesService,DocumentsService,ProjectsService,DOMService){"use strict";var maxWidth=0,maxHeight=0;$scope.selected=$scope.selectedDelayed=$scope.comment&&CommentsService.selectedCommentId===$scope.comment._id,$scope.isDragging=!1,$scope.dragStartPos=null,$scope.dragClickPos=null,$scope.isTop=!0,$scope.isLeft=!0,$scope.deleting=!1,$scope.classes=[],$scope.toggle=function(e){$scope.isNew()||$scope.isDragging||($scope.selected=!$scope.selected,$scope.applyVisibility())},$scope.hide=function(){return $scope.selected?($scope.selected=!1,$scope.applyVisibility(),!0):void 0},$scope.getPreventHideElements=function(){var elements=[],loginToolbarEl=document.querySelector("section.login-toolbar");return loginToolbarEl&&elements.push(loginToolbarEl),elements},$scope.open=function(){$scope.selected=!0,this.applyVisibility()},$scope.isOpen=function(){return $scope.selected},$scope.applyVisibility=function(){updateClasses(),setSelectedDelayed($scope.selected),$rootScope.$emit(PreviewEnums.SELECT_COMMENT,$scope.selected?$scope.comment._id:null,"canvas")},$scope.startDrag=function(e){CommentsService.canEdit($scope.comment)&&($scope.dragClickPos={x:e.pageX,y:e.pageY},$scope.dragStartPos={x:$scope.comment.position.x,y:$scope.comment.position.y},$scope.dragClickPos&&$scope.dragStartPos&&$document.on("mousemove",onMouseMove))},$scope.endDrag=function(e){$document.unbind("mousemove",onMouseMove)},$scope.getCommentPointStyle=function(){return{left:$scope.x+"px",top:$scope.y+"px"}},$scope.isNew=function(){return void 0===$scope.comment},$scope.onDblclick=function(e){e.preventDefault()},$scope.$on("$destroy",function(){onAddingComment&&onAddingComment(),onSelectComment&&onSelectComment(),onDeleteComment&&onDeleteComment(),onSortComments&&onSortComments(),onSelected&&onSelected(),onDeletingComment&&onDeletingComment(),onResolveComment&&onResolveComment()});var initDrag=function(){maxWidth=getContentWidth()-PreviewEnums.PIN_RADIUS,maxHeight=getContentHeight(),$scope.isDragging=!0,updateClasses(),$document.on("mouseup",onMouseUp),$rootScope.$emit(PreviewEnums.DRAGGING_COMMENT,!0)},setSelectedDelayed=function(value){$timeout(function(){$scope.selectedDelayed=value,updateClasses()},0)},onMouseMove=function(e){var x=$scope.dragStartPos.x+e.pageX-$scope.dragClickPos.x,y=$scope.dragStartPos.y+e.pageY-$scope.dragClickPos.y;$scope.isDragging||initDrag(),x<-PreviewEnums.PIN_RADIUS&&(x=-PreviewEnums.PIN_RADIUS),x>maxWidth&&(x=maxWidth),y>maxHeight&&(y=maxHeight),$scope.$apply(function(){$scope.comment.position.x=x,$scope.comment.position.y=y})},onMouseUp=function(e){$scope.dragClickPos=null,$document.unbind("mousemove",onMouseMove),$document.unbind("mouseup",onMouseUp),$timeout(function(){$scope.isDragging=!1,updateClasses()},0),computePosition(),CommentsService.updateComment($scope.comment._id,{position:$scope.comment.position}).then(function(comment){$scope.dragStartPos=null},function(error){$scope.comment.position.x=$scope.dragStartPos.x,$scope.comment.position.y=$scope.dragStartPos.y,$scope.dragStartPos=null}),$rootScope.$emit(PreviewEnums.DRAGGING_COMMENT,!1)},getContentId=function(){return ProjectsService.isDocument()?DocumentsService.currentDocumentId:PagesService.currentPageId},getContentWidth=function(){return ProjectsService.isDocument()?parseInt(DocumentsService.currentDocumentProperties.size.width):PagesService.getContentWidth()},getContentHeight=function(){return ProjectsService.isDocument()?parseInt(DocumentsService.currentDocumentProperties.size.height):parseInt(PagesService.currentPageProperties.size.height)},updateIndex=function(){$scope.index=CommentsService.getIndex(getContentId(),$scope.comment._id)},computePosition=function(){$scope.selected&&$timeout(function(){var groupSelector,commentX,commentY;if($scope.isNew())commentX=parseInt($scope.x),commentY=parseInt($scope.y),groupSelector="section.pin > #group-new-canvas";else{var id=$scope.comment._id,comment=CommentsService.commentsMap[id];commentX=comment.position.x,commentY=comment.position.y,groupSelector="section.pin > #group-"+id+"-canvas"}var group=document.querySelectorAll(groupSelector)[0],bb=group.getBoundingClientRect(),commentW=bb.width+PreviewEnums.COMMENT_FORM_DELTA_X-PreviewEnums.PIN_RADIUS,commentH=bb.height+PreviewEnums.COMMENT_FORM_DELTA_Y-PreviewEnums.PIN_RADIUS,containerW=DOMService.getContainerDimensions().width,contentW=getContentWidth(),width=contentW+(containerW>contentW?(containerW-contentW)/2:0),height=getContentHeight();$scope.isLeft=width>commentX+commentW,$scope.isTop=height>commentY+commentH,updateClasses()},0)},updateClasses=function(){setClass("selected",$scope.selectedDelayed),setClass("adding-comment",$scope.isNew()),setClass("resolved",!$scope.isNew()&&$scope.comment.resolved.is),setClass("dragging",$scope.isDragging),setClass("top",$scope.isTop),setClass("bottom",!$scope.isTop),setClass("left",$scope.isLeft),setClass("right",!$scope.isLeft),setClass("hide",$scope.deleting)},setClass=function(className,value){var index=$scope.classes.indexOf(className);value&&-1===index?$scope.classes.push(className):value||-1===index||$scope.classes.splice(index,1)};if($scope.isNew()){$scope.selected=!1;var onAddingComment=$rootScope.$on(PreviewEnums.ADDING_COMMENT,function(e,value){$scope.selected=value,updateClasses(),setSelectedDelayed($scope.selected),value&&(computePosition(),$scope.index=CommentsService.getIndex(getContentId()))})}else{var onSelectComment=$rootScope.$on(PreviewEnums.SELECT_COMMENT,function(e,id){$scope.selected&&$scope.comment._id!==id&&($scope.selected=!1,setSelectedDelayed($scope.selected)),$scope.selected||$scope.comment._id!==id||($scope.selected=!0,setSelectedDelayed($scope.selected))}),onSelected=$scope.$watch("selected",function(newValue,oldValue){!oldValue&&newValue&&computePosition()}),onDeletingComment=$rootScope.$on(PreviewEnums.DELETING_COMMENT,function(e,id,value){$scope.comment._id===id&&($scope.selected=$scope.selectedDelayed=!1,$scope.deleting=value,updateClasses())}),onResolveComment=$rootScope.$on(PreviewEnums.RESOLVE_COMMENT,function(e,id,value){$scope.comment._id===id&&updateClasses()}),onDeleteComment=$rootScope.$on(PreviewEnums.DELETE_COMMENT,updateIndex),onSortComments=$rootScope.$on(PreviewEnums.SORT_COMMENTS,updateIndex);updateIndex(),computePosition(),updateClasses()}}]),angular.module("core").directive("previewPin",[function(){"use strict";var link=function(scope,element,attrs){scope.toggleElement=function(){var parent=element[0].parentNode;return parent?parent.querySelector(".comments-group"):void 0}};return{restrict:"E",replace:!0,scope:{comment:"=",x:"@",y:"@"},controller:"PreviewPinController",templateUrl:"/scripts/modules/core/directives/preview-pin/preview-pin.directive.html",link:link}}]),angular.module("core").controller("UsabilityTestPluginTipController",["$q","$scope","$rootScope","localStorageService","UsabilityTestService","ChromeExtensionService",function($q,$scope,$rootScope,localStorageService,UsabilityTestService,ChromeExtensionService){
"use strict";var PLUGIN_MESSAGE_KEY="pluginTipDisplayed";$scope.isTipVisible=UsabilityTestService.isHostSession();var showTipRequestDefer=$q.defer(),grantMediaAccessDefer=$q.defer();$q.all([showTipRequestDefer.promise,grantMediaAccessDefer.promise]).then(function(){showTip()}),UsabilityTestService.isHostSession()&&showTipRequestDefer.resolve();var setPluginMessageDisplayed=function(){localStorageService.set(PLUGIN_MESSAGE_KEY,1)},closeTip=function(){setPluginMessageDisplayed(),$scope.$$phase?$scope.isTipVisible=!1:$scope.$apply(function(){$scope.isTipVisible=!1})},showTip=function(){$scope.isTipVisible=!0};$scope.onClickClose=function(){closeTip()};try{ChromeExtensionService.onMessage(function(request){"startRecording"===request.action&&closeTip()})}catch(e){window.console.error(e)}UsabilityTestService.registerObserverCallback(LiveShare.enums.EVENTS.START,function(){UsabilityTestService.isHostSession()&&showTipRequestDefer.resolve()}),$rootScope.$on(PreviewEnums.MEDIA_ACCESS,function(e,value){value===PreviewEnums.MEDIA_ACCESS_TYPE.ALLOWED&&grantMediaAccessDefer.resolve()})}]),angular.module("core").directive("usabilityTestPluginTip",[function(){"use strict";return{restrict:"E",replace:!0,scope:!0,controller:"UsabilityTestPluginTipController",templateUrl:"/scripts/modules/core/directives/usabilityTestPluginTip/usabilityTestPluginTip.directive.html"}}]);
//# sourceMappingURL=maps/app.js.map
